<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Play Framework</title><meta name="author" content="Daniel Hinojosa"><link rel="stylesheet" href="node_modules/reveal.js/dist/reset.css"><link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css"><link rel="stylesheet" href="node_modules/reveal.js/dist/theme/black.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/v4-shims.min.css"><link rel="stylesheet" href="custom.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Play Framework</h1><p class="byline">
  <span class="author">Daniel Hinojosa</span>
  </p></section><section><section id="_introduction_to_play_framework"><h2>Introduction to Play Framework</h2></section><section id="_what_is_play"><h2>What is Play?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play is a high-productivity Java and Scala web application framework that integrates components and APIs for modern web application development.</p></li><li><p>Play was developed by web developers for web application development.</p></li></ul></div></div></section><section id="_play_mvc"><h2>Play MVC</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play’s Model-View-Controller (MVC) architecture familiar and easy to learn.</p></li><li><p>Play provides concise and functional programming patterns. And, the large community developing Play applications provides an excellent resource for getting your questions answered.</p></li><li><p>As a full-stack framework, Play includes all the components you need to build Web Applications and REST services, such as:</p><div class="ulist"><ul><li><p>An integrated HTTP server</p></li><li><p>Form handling</p></li><li><p>Cross-Site Request Forgery (CSRF) protection</p></li><li><p>A powerful routing mechanism</p></li><li><p>I18n support, and more.</p></li></ul></div></li></ul></div></div></section><section id="_play_hot_reloading"><h2>Play Hot Reloading</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play saves precious development time by directly supporting everyday tasks and hot reloading so that you can immediately view the results of your work</p></li></ul></div></div></section><section id="_play_under_the_hood"><h2>Play Under the Hood</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play’s lightweight, stateless, web-friendly architecture uses Akka and Akka Streams under the covers to provide predictable and minimal resource consumption (CPU, memory, threads).</p></li><li><p>Thanks to its reactive model, applications scale naturally–both horizontally and vertically. See Elasticity and Efficient Resource Usage for more information.</p></li></ul></div></div></section><section id="_database_agnostic"><h2>Database Agnostic</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play is non-opinionated about database access, and integrates with many object relational mapping (ORM) layers</p></li><li><p>It supports Anorm, Slick, and JPA out of the box, but many customers use NoSQL or other ORMs</p></li></ul></div></div></section></section>
<section><section id="_installation"><h2>Installation</h2></section><section id="_requirements"><h2>Requirements</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play requires:</p><div class="ulist"><ul><li><p>Java versions SE 8 through SE 11, inclusive</p></li><li><p>sbt - we recommend the latest version</p></li></ul></div></li></ul></div></div></section><section id="_verifying_java"><h2>Verifying Java</h2><div class="slide-content"><div class="paragraph"><p>To check that you have Java SE 1.8 or higher, enter the following in a terminal:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">java -version</code></pre></div></div>
<div class="paragraph"><p>You should see something like:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">openjdk version "1.8.0_222"
OpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_222-b10)
OpenJDK 64-Bit Server VM (AdoptOpenJDK)(build 25.222-b10, mixed mode)</code></pre></div></div></div></section><section id="_verifying_sbt"><h2>Verifying SBT</h2><div class="slide-content"><div class="paragraph"><p>To check the latest SBT, enter the following in a terminal:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">sbt sbtVersion</code></pre></div></div>
<div class="paragraph"><p>You should see something like:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">[warn] No sbt.version set in project/build.properties, base directory: /Users/danno/Development/mine/advanced_java
[info] welcome to sbt 1.7.1 (Oracle Corporation Java 11)
[info] loading settings for project global-plugins from idea.sbt,plugins.sbt ...
[info] loading global plugins from /Users/me/.sbt/1.0/plugins
[info] set current project to advanced_java (in build file:/Users/me/Development/mine/advanced_java/)</code></pre></div></div></div></section><section id="_bootstrapping_an_application"><h2>Bootstrapping an Application</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play expects a specific project structure</p></li><li><p>If you already have sbt installed, you can use a giter8 template, similar to a Maven archetype, to create a new Play project.</p></li><li><p>This gives you the advantage of setting up your project folders, build structure, and development environment — all with one command.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">sbt new playframework/play-scala-seed.g8</code></pre></div></div></li><li><p>After the template creates the project:</p><div class="ulist"><ul><li><p>Enter <code>sbt run</code> to download dependencies and start the system.</p></li><li><p>In a browser, enter <a href="http://localhost:9000/" class="bare">http://localhost:9000/</a> to view the welcome page.</p></li></ul></div></li></ul></div></div></section></section>
<section><section id="_intellij"><h2>IntelliJ</h2></section><section id="_getting_started_with_play_2_x"><h2>Getting started with Play 2.x</h2><div class="slide-content"><div class="ulist"><ul><li><p>Before you start generating your Play project, make sure that the Scala plugin is downloaded and enabled in IntelliJ IDEA.</p></li><li><p>IntelliJ IDEA supports Play versions 2.4 and later.</p></li></ul></div></div></section><section id="_common_scenarios_for_generating_a_play_2_project_in_intellijidea"><h2>Common scenarios for generating a Play 2 project in IntelliJ IDEA:</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you have an already existing Play 2 project, you can import it or check out from version control.</p></li><li><p>In this case you can follow the regular procedure for importing or cloning a project.</p></li><li><p>If you are not familiar with Play 2 framework and want to learn how to use it, create a Play project via IntelliJ IDEA that will generate an executable application.</p></li><li><p>If you want to manually add a support for <a href="https://www.playframework.com/documentation/2.6.x/NewApplication">Play 2 framework</a>, create an sbt project.</p></li></ul></div></div></section><section id="_create_a_new_play_2_project"><h2>Create a new Play 2 project</h2><div class="slide-content"><div class="ulist"><ul><li><p>Launch the New Project wizard.</p></li><li><p>If no project is currently opened in IntelliJ IDEA, click New Project on the welcome screen.</p></li><li><p>Otherwise, select menu: File[New &gt; Project] from the main menu.</p></li><li><p>From the options on the left, under the Play 2.x.</p><div class="imageblock" style="text-align: center"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/play_create.png" alt="image" width="706" height="498"></div><div class="title">Figure 1. New Project dialog</div></li></ul></div></div></section><section id="_follow_wizard_and_create"><h2>Follow Wizard and Create</h2><div class="slide-content"><div class="ulist"><ul><li><p>Follow the steps suggested in the wizard and click Create.</p></li><li><p>IntelliJ IDEA generates the Play 2 project with the appropriate structure, dependencies and an executable application.</p><div class="imageblock"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/ready_play_project.png" alt="image" width="887" height="525"></div><div class="title">Figure 2. Play 2 project editor and tool windows</div></li></ul></div></div></section><section id="_create_an_sbt_project_with_play_2_framework"><h2>Create an sbt project with Play 2 framework</h2><div class="slide-content"><div class="ulist"><ul><li><p>Create an sbt project.</p><div class="imageblock" style="text-align: center"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/sbt_project_create.png" alt="image" width="50%" height="50%"></div></li><li><p>Follow the steps suggested in the wizard and click <b class="button">Finish</b></p></li><li><p>IntelliJ IDEA creates an sbt project</p></li></ul></div></div></section><section id="_adding_play_dependencies"><h2>Adding Play Dependencies</h2><div class="slide-content"><div class="ulist"><ul><li><p>Open the <em>build.sbt</em> file in the editor and add Play as a project dependency.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies ++=Seq("com.typesafe.play" %% "play" % "2.7.3")</code></pre></div></div></li><li><p>Open the plugins.sbt file in the editor and add the Play 2 plugin.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">addSbtPlugin("com.typesafe.play" % "sbt-plugin" % "2.7.3")</code></pre></div></div></li></ul></div></div></section><section id="_automatic_dependencies"><h2>Automatic Dependencies</h2><div class="slide-content"><div class="ulist"><ul><li><p>IntelliJ IDEA downloads the appropriate dependencies and adds them to the sbt projects tool window.</p><div class="imageblock" style="text-align: center"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/sbt_dependency_node.png" alt="image" width="369" height="672"></div><div class="title">Figure 3. sbt tool window</div></li></ul></div></div></section><section id="_what_if_it_didnt_automatically_load_anything"><h2>What if it didn&#8217;t automatically load anything?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Please note that the Play 2 framework project structure is not generated and you need to add everything manually.</p></li><li><p>Check the <a href="https://www.playframework.com/documentation/2.6.x/Anatomy">Play 2</a> project structure</p></li><li><p>At this point you can start creating Play 2 templates since IntelliJ IDEA supports them as soon as support for Play 2 framework is added and develop your project further.</p></li><li><p>You can use code completion, navigation and on-the-fly code analysis features in your Play 2 files.</p></li><li><p>IntelliJ IDEA also supports code assistance for routes files and code inspections.</p></li></ul></div></div></section><section id="_open_an_existing_play_2_project"><h2>Open an existing Play 2 project</h2><div class="slide-content"><div class="ulist"><ul><li><p>On the welcome screen, select <b class="button">Open</b></p></li><li><p>Alternatively, from the main menu, select <span class="menuseq"><span class="menu">File</span>&#160;&#9656;&#32;<span class="menuitem">Open</span></span></p></li><li><p>In the dialog that opens, locate your project and if it is an sbt project, select the menu[Open]</p></li><li><p>In the dialog that opens, click <b class="button">Open as Project</b></p></li><li><p>IntelliJ IDEA opens the project and loads all the necessary dependencies.</p></li><li><p>If your project is not an sbt project, refer to the import project section.</p></li></ul></div></div></section><section id="_run_and_debug_play_2_application"><h2>Run and debug Play 2 application</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you want to run the application:</p><div class="ulist"><ul><li><p>In the project tool window, right-click the application.</p></li><li><p>In the context menu, select <b class="button">Run Play 2 App</b></p></li></ul></div></li><li><p>If you need to access the Run/Debug Configurations dialog:</p><div class="ulist"><ul><li><p>On the main menu, select <span class="menuseq"><span class="menu">Run</span>&#160;&#9656;&#32;<span class="menuitem">Edit Configurations</span></span></p></li><li><p>Click the <span class="image"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/app.general.add.svg" alt="app.general.add"></span> Play 2 App to create a new configuration.</p></li></ul></div></li></ul></div></div></section><section id="_specifying_rundebug_configurations"><h2>Specifying Run/Debug Configurations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Specify run/debug configuration settings.</p></li><li><p>The default settings are enough for running and debugging purposes.</p><div class="imageblock"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/play_run_debug.png" alt="image" width="1000" height="469"></div></li></ul></div></div></section><section id="_adding_the_browser"><h2>Adding the Browser</h2><div class="slide-content"><div class="ulist"><ul><li><p>On the main toolbar, click the <span class="image"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/app.toolwindows.toolWindowRun.svg" alt="App toolwindows tool window run" width="16" height="16"></span> icon to run or the <span class="image"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/app.actions.startDebugger.svg" alt="App actions start debugger" width="16" height="16"></span> icon to debug your application.</p></li><li><p>You can check the output of your application in the default browser <a href="http://localhost:9000" class="bare">http://localhost:9000</a></p></li><li><p>If you want to stop the server session, press <span class="keyseq"><kbd>Cmd</kbd>+<kbd>P</kbd></span> for macOS.</p></li></ul></div>
<div class="imageblock"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/play_server_display.png" alt="image" width="578" height="169"></div></div></section><section id="_work_with_play2_settings"><h2>Work with Play2 settings</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can use Play 2 settings to configure compiler options and configure formatting for route files.</p></li><li><p>You can also view and edit a list of default template imports.</p></li><li><p>Press <span class="menuseq"><span class="menu">Languages</span>&#160;&#9656;&#32;<span class="submenu">Frameworks</span>&#160;&#9656;&#32;<span class="menuitem">Play2</span></span></p></li><li><p>Depending on what settings you want to configure, on the Play2 settings page, select the appropriate tab and adjust the settings.</p></li><li><p>Use the <b class="button">Other</b> tab to check and edit the list of template imports that get retrieved from the descriptor when you refresh your project.</p></li></ul></div>
<div class="imageblock"><img src="https://resources.jetbrains.com/help/img/idea/2022.2/play_settings.png" alt="image" width="755" height="618"></div><div class="title">Figure 4. Play settings</div></div></section></section>
<section id="_lab_bootstrapping_your_application"><h2>Lab: Bootstrapping Your Application</h2></section>
<section><section id="_creating_a_basic_application"><h2>Creating a Basic Application</h2></section><section id="_exploring_the_basic_application"><h2>Exploring the Basic Application</h2><div class="slide-content"><div class="ulist"><ul><li><p>Let&#8217;s explore our application and get to know all the components</p></li><li><p>Ask questions about the layout, where everything is located</p></li><li><p>We can discuss the basics of routes, pages, and views</p></li></ul></div></div></section></section>
<section><section id="_design_principles"><h2>Design Principles</h2></section><section id="_why_do_we_need_to_discuss"><h2>Why do we need to discuss?</h2><div class="slide-content"><div class="ulist"><ul><li><p>If we don&#8217;t have a plan on how to organize our code, things can get messy</p></li><li><p>Everything should have a place, and everyone should know how to organize a code base</p></li><li><p>Every layer should be completely testable in isolation</p></li><li><p>This section is not about Play Framework per se, but how to organize code bases</p></li></ul></div></div></section><section id="_hexagonal_architecture"><h2>Hexagonal Architecture</h2><div class="slide-content"><div class="imageblock"><img src="./images/hexagonal_architecture.png" alt="hexagonal architecture"></div></div></section></section>
<section id="_unit_testing"><h2>Unit Testing</h2></section>
<section id="_lab_basic_application"><h2>Lab: Basic Application</h2></section>
<section><section id="_guice"><h2>Guice</h2></section><section id="_introduction_to_dependency_injection"><h2>Introduction to Dependency Injection</h2><div class="slide-content"><div class="ulist"><ul><li><p>In layman&#8217;s terms, a wiring framework.</p></li><li><p>The Art of "Componentizing" Software.</p></li><li><p>Bringing back the promise of "Code Reuse"</p></li><li><p>Ties into TDD (Test Driven Development)</p></li><li><p>Decoupling Components as a better strategy</p></li><li><p>Advantage of Testable, and Modular Code</p></li><li><p>Adherence to the Single Responsibility Principle</p></li></ul></div></div></section><section id="_the_single_responsibility_principle"><h2>The Single Responsibility Principle</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>The single responsibility principle states that every module or class should have responsibility over a single part of the functionality provided by the software,</p></div></blockquote></div></div></section><section id="_tight_coupling_as_an_example"><h2>Tight Coupling As An Example</h2><div class="slide-content"><div class="listingblock"><div class="title">Sample from "Guide to Writing Testable Code"</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">class House {
  Kitchen kitchen = <span class="mono-bold-red">new Kitchen();</span>
  Bedroom bedroom;

  House() {
    bedroom = <span class="mono-bold-red">new Bedroom();</span>
  }

  // ...
}</code></pre></div></div>
<div class="paragraph"><p><a href="http://misko.hevery.com/code-reviewers-guide/flaw-constructor-does-real-work/" class="bare">http://misko.hevery.com/code-reviewers-guide/flaw-constructor-does-real-work/</a></p></div></div></section><section id="_removing_that_coupling_as_an_example"><h2>Removing That Coupling As An Example</h2><div class="slide-content"><div class="listingblock"><div class="title">Removing the tight coupling</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">class House {
  Kitchen kitchen;
  Bedroom bedroom;

  // Have Guice create the objects
  //   and pass them in
  <span class="mono-bold-blue">@Inject</span>
  House(Kitchen k, Bedroom b) {
    kitchen = k;
    bedroom = b;
  }
  // ...
}</code></pre></div></div></div></section><section id="_bringing_in_a_heftier_example"><h2>Bringing in a Heftier Example</h2><div class="slide-content"><div class="listingblock"><div class="title">A Real World Example</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import java.time.LocalDate;
import java.util.List;

public class AlbumService {
    private final AlbumDAO dao;

    public AlbumService(AlbumDAO dao) {
        this.dao = dao;
    }

    public List&lt;Album&gt; findTop10AlbumsForTheWeek
                               (LocalDate localDate) {
        return this.dao.findTopAlbums(localDate, 10);
    }
}</code></pre></div></div></div></section><section id="_better_design_and_loose_coupling_makes_testable_software"><h2>Better Design and Loose Coupling Makes Testable Software</h2><div class="slide-content"><div class="listingblock"><div class="title">Running a test</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">@Test
public void testGettingTheTop10List() {
    AlbumDAO albumDAO = mock(AlbumDAO.class); //Using Mockito
    LocalDate date = LocalDate.of(2016, 7, 24);
    when(albumDAO.findTopAlbums(date, 10)).thenReturn(fakeList);

    //Subject Under Test
    AlbumService albumService = new AlbumService(albumDAO);
    albumService.findTop10AlbumsForTheWeek(date);
}</code></pre></div></div></div></section><section id="_wiring_the_classic_way_without_a_framework"><h2>Wiring the classic way without a framework</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public static void main(String[] args) {
  AlbumDAO albumDAO = new MySQLDAO("jdbc:mysql://localhost:3306", "scott", "tiger");
  AlbumService albumService = AlbumService.setAlbumDAO(albumDAO);
  //Tons of boilerplate code for setup afterwards
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">We can plugin a <code>MySQLDAO</code> or <code>PostgreSQLDAO</code> or a <code>MongoDBDAO</code></td></tr></table></div></div></section><section id="_downside_to_manually_injecting_dependencies"><h2>Downside to manually injecting dependencies</h2><div class="slide-content"><div class="ulist"><ul><li><p>Downside to this method:</p><div class="ulist"><ul><li><p>Can get real messy</p></li><li><p>Not flexible</p></li><li><p>Not maintainable over time</p></li></ul></div></li></ul></div></div></section><section id="_benefits_of_google_guice_and_dependency_injection_in_general"><h2>Benefits of Google Guice and Dependency Injection in General</h2><div class="slide-content"><div class="listingblock"><div class="title">Using Google Guice</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Runner {
    public static void main(String[] args) {
        <span class="mono-bold-blue">Injector injector = Guice.createInjector(new AlbumModule());</span>
        //Everything is already wired!
        AlbumService albumService = injector.getInstance(AlbumService.class);
        //0 or minimum of lines after this.
    }
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">DAO Code is wired in with annotations and Google Guice</td></tr></table></div></div></section><section id="_about_google_guice"><h2>About Google Guice</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dependency Inject Framework</p></li><li><p>Uses Code above Configuration</p></li><li><p>Uses Type Safety for Component Wiring</p></li><li><p>Applies the "Hollywood Principal", "Don&#8217;t call us we will call you"</p></li><li><p>Tries to avoid Factories</p></li><li><p>Billed as <code>@Inject</code> is the new <code>new</code></p></li><li><p>Adheres to JSR-330 (JSR-330 is the Dependency Injection Java Specification Request)</p></li></ul></div></div></section><section id="_installing_guice"><h2>Installing Guice</h2><div class="slide-content"><div class="listingblock"><div class="title">Including Guice in Maven</div><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.google.inject&lt;/groupId&gt;
    &lt;artifactId&gt;guice&lt;/artifactId&gt;
    &lt;version&gt;5.1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div>
<div class="listingblock"><div class="title">Including Guice in Gradle</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-noescape="true" data-lang="groovy">compile 'com.google.inject:guice:5.1.0'</code></pre></div></div>
<div class="listingblock"><div class="title">Including Guice in SBT</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies += "com.google.inject" % "guice" % "5.1.0"</code></pre></div></div></div></section><section id="_rules_about_dependency_injection"><h2>Rules about Dependency Injection</h2><div class="slide-content"><div class="ulist"><ul><li><p>Make the component injectable, naturally occurs with testable code</p></li><li><p>The framework usually should not be exposed within the code.</p></li><li><p>Other than annotations, the code should not about it&#8217;s wiring be it Spring or Guice.</p></li><li><p>Create your components based on requirements, there is a way to wire components, when those components are designed well.</p></li></ul></div></div></section><section id="_bootstrapping_a_guice_module"><h2>Bootstrapping a Guice Module</h2><div class="slide-content"><div class="ulist"><ul><li><p>Bootstrapping of a <code>Module</code> is done in an implementation of an <code>com.google.inject.AbstractModule</code></p></li><li><p>Once extended, implement as part of the module contract <code>configure</code></p></li><li><p>In the configure method, use <code>bind</code> to bind components to one another.</p></li></ul></div></div></section><section id="_example_module"><h2>Example Module</h2><div class="slide-content"><div class="listingblock"><div class="title">AlbumModule.java</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import com.google.inject.AbstractModule;

public class AlbumModule extends AbstractModule {
    @Override
    protected void configure() {

    }
}</code></pre></div></div></div></section><section id="_linked_bindings"><h2>Linked Bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Links a <em>type</em> to a concrete implementation.</p></li><li><p>Whenever an implementation is required it can now be found using the <em>type</em></p></li></ul></div>
<div class="listingblock"><div class="title">AlbumModule.java</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import com.google.inject.AbstractModule;
import com.xyzcorp.dao.AlbumDAO;
import com.xyzcorp.dao.StandardAlbumDAO;

public class AlbumModule extends AbstractModule {
    @Override
    protected void configure() {
        <span class="mono-bold-green">bind(AlbumDAO.class).to(StandardAlbumDAO.class);</span>
    }
}</code></pre></div></div></div></section><section id="_creating_an_injector"><h2>Creating an Injector</h2><div class="slide-content"><div class="ulist"><ul><li><p>The injector internally holds the dependency graphs described in your application.</p></li><li><p>When you request an instance of a given type, the injector figures out:</p><div class="ulist"><ul><li><p>What objects to construct</p></li><li><p>Resolves their dependencies</p></li><li><p>Wires everything together.</p></li></ul></div></li><li><p>To specify how dependencies are resolved, configure your injector with bindings!</p></li></ul></div></div></section><section id="_example_of_creating_an_injector_with_a_module"><h2>Example of creating an injector with a <code>Module</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import com.google.inject.Guice;
import com.google.inject.Injector;
import com.xyzcorp.dao.AlbumDAO;

public class Runner {
    public static void main(String[] args) throws SQLException {
        <span class="mono-bold-green">Injector injector = Guice.createInjector(new AlbumModule());</span>
        AlbumDAO dao = injector.getInstance(StandardAlbumDAO.class);
        dao.insert(new Album("Joshua Tree", "U2", 1987));
    }
}</code></pre></div></div></div></section><section id="_binding_annotations"><h2>Binding Annotations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Guice uses annotation to bind multiple components for the same type.</p></li><li><p>For example, as in our example, a Data Access Object (DAO) will have multiple bindings.</p></li><li><p>Doing so, will require creation of annotations that can bind via <code>FIELD</code>, <code>PARAMETER</code>, and <code>METHOD</code></p></li></ul></div></div></section><section id="_creating_binding_annotations"><h2>Creating Binding Annotations</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following is a standard approach for creating an annotation</p></li><li><p>You can create an <code>Oracle</code> and <code>MySQL</code> annotations for a well-rounded example.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp.annotations;

import com.google.inject.BindingAnnotation;

import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@BindingAnnotation
@Target({FIELD, PARAMETER, METHOD})
@Retention(RUNTIME)
public @interface H2 {}</code></pre></div></div></div></section><section id="_creating_binding_annotations_with_qualifier"><h2>Creating Binding Annotations with <code>@Qualifier</code></h2><div class="slide-content"><div class="ulist"><ul><li><p><code>Qualifier</code></p><div class="ulist"><ul><li><p>JSR-330 meta-annotation that tells Guice that this is a binding annotation</p></li><li><p>Guice will produce an error if multiple binding annotations are ever applied to the same member</p></li><li><p>Guice&#8217;s <code>@BindingAnnotation</code> is also used for this purpose in older code.</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp.annotations;

import com.google.inject.BindingAnnotation;

import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Qualifier
@Target({FIELD, PARAMETER, METHOD})
@Retention(RUNTIME)
public @interface H2 {}</code></pre></div></div></div></section><section id="_guice_provider"><h2>Guice <code>Provider</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>As it&#8217;s own limited capacity factory is the <code>Provider&lt;T&gt;</code></p></li><li><p><code>Provider</code> is parameterized to provide what the type of what it provides.</p></li><li><p><code>Provider</code> are injectable in of themselves, but can be used to provide custom made objects when necessary.</p></li><li><p>The signature of a <code>Provider</code> is the following:</p></li></ul></div>
<div class="listingblock"><div class="title">Guice&#8217;s Provider Signature</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public interface Provider&lt;T&gt; {
  T get();
}</code></pre></div></div></div></section><section id="_creating_a_provider"><h2>Creating a Provider</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import com.google.inject.AbstractModule;
import com.google.inject.name.Names;
import com.xyzcorp.dao.AlbumDAO;
import com.xyzcorp.dao.H2ConnectionProvider;
import com.xyzcorp.dao.StandardAlbumDAO;

import java.sql.Connection;

public class AlbumModule extends AbstractModule {
    @Override
    protected void configure() {
        <span class="mono-bold-green">bind(Connection.class).annotatedWith(H2.class)
                           .toProvider(H2ConnectionProvider.class);</span>
        bind(AlbumDAO.class).to(StandardAlbumDAO.class);
    }
}</code></pre></div></div></div></section><section id="_using_a_binding_annotation_injecting_the_h2_connection_to_our_dao"><h2>Using a Binding Annotation injecting the H2 Connection to our DAO</h2><div class="slide-content"><div class="ulist"><ul><li><p>This will inject the <code>java.sql.Connection</code> into this setter</p></li><li><p>Since there is binding annotation, it will inject a specific one the <code>H2</code> Connection</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">@Inject
public void setConnection(@H2 Connection connection) {
   this.connection = connection;
}</code></pre></div></div></div></section><section id="_named"><h2><code>@Named</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Guice comes with a built-in binding annotation <code>@Named</code> that uses a string to provide a name.</p></li><li><p>Use this method if you wish <em>not</em> to use an annotation to discriminate what objects you wish to inject.</p></li><li><p>For example, instead of an <code>@H2</code> annotation we could&#8217;ve used:</p></li></ul></div></div></section><section id="_binding_with_named"><h2>Binding with <code>@Named</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>If we used the following binding in the <code>AlbumModule</code>:</p></li><li><p>Here we are using a string <code>H2</code> as the binding</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">bind(Connection.class)
  .annotatedWith(Names.named("H2"))
  .toProvider(H2ConnectionProvider.class);</code></pre></div></div></div></section><section id="_using_named_annotation"><h2>Using <code>@Named</code> annotation</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">@Override
@Inject
public void setConnection(@Named("H2") Connection connection) {
    this.connection = connection;
}</code></pre></div></div></div></section><section id="_instance_bindings"><h2>Instance Bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can bind a type to a specific <em>instance</em> of that type using <code>toInstance</code>.</p></li><li><p>Doing an instance is considered a Singleton, only one instance available.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import com.google.inject.AbstractModule;
import com.google.inject.name.Names;
import com.xyzcorp.annotations.H2;
import com.xyzcorp.dao.AlbumDAO;
import com.xyzcorp.dao.H2ConnectionProvider;
import com.xyzcorp.dao.StandardAlbumDAO;

import java.sql.Connection;

public class AlbumModule extends AbstractModule {
    @Override
    protected void configure() {
        bind(String.class).annotatedWith(Names.named("url")).toInstance
                ("jdbc:h2:tcp://localhost/~/test");
        bind(String.class).annotatedWith(Names.named("userName")).toInstance
                ("sa");
        bind(String.class).annotatedWith(Names.named("password")).toInstance
                ("");
        ...
    }
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Using a <code>String</code> is horrible idea in general and it is better to use a <em>value object</em></td></tr></table></div></div></section><section id="_value_objects"><h2>Value Objects</h2><div class="slide-content"><hr>
<div class="paragraph"><p>Value Object is an object that represents a concept from your problem Domain.
It is important in DDD that Value Objects support and enrich Ubiquitous Language of your Domain.
They are not just primitives that represent some values - they are domain citizens that model behavior of your application.
<em>_</em></p></div></div></section><section id="_value_objects_in_java_and_scala"><h2>Value Objects in Java and Scala</h2><div class="slide-content"><div class="listingblock"><div class="title">Creating a value object with the new <code>record</code> syntax</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public record UserName(String name);</code></pre></div></div>
<div class="listingblock"><div class="title">Create a value object with a Scala <code>case class</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class UserName(name:String)</code></pre></div></div></div></section><section id="_instance_bindings_with_value_object"><h2>Instance Bindings with Value Object</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can bind a type to a specific <em>instance</em> of that type using <code>toInstance</code>.</p></li><li><p>Doing an instance is considered a Singleton, only one instance available.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">package com.xyzcorp;

import com.google.inject.AbstractModule;
import com.google.inject.name.Names;
import com.xyzcorp.annotations.H2;
import com.xyzcorp.dao.AlbumDAO;
import com.xyzcorp.dao.H2ConnectionProvider;
import com.xyzcorp.dao.StandardAlbumDAO;

import java.sql.Connection;

public class AlbumModule extends AbstractModule {
    @Override
    protected void configure() {
        <span class="mono-green-bold">bind(Url.class).annotatedWith(Names.named("url")).toInstance
                (new URL("jdbc:h2:tcp://localhost/~/test"));
        bind(UserName.class).annotatedWith(Names.named("userName")).toInstance
                (new UserName("user301212");
        bind(Password.class).annotatedWith(Names.named("password")).toInstance
                (new Password("30d</span>#201abq".toBytes());#
        ...
    }
}</code></pre></div></div></div></section><section id="_wire_the_named_items_into_our_provider"><h2>Wire the named items into our provider</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java"><span class="mono-bold-green">@Inject</span>
public H2ConnectionProvider(@Named("url") Url url,
                            @Named("userName") UserName userName,
                            @Named("password") Password password) {
    this.url = url;
    this.userName = userName;
    this.password = password;
}</code></pre></div></div></div></section><section id="_annotations_provides"><h2>Annotations <code>@Provides</code></h2><div class="slide-content"><div class="paragraph"><p>If we didn&#8217;t want to actually create an actual class for a Provider we could&#8217;ve used the <code>@Provides</code> annotation.</p></div>
<div class="paragraph"><p>With some caveats:</p></div>
<div class="ulist"><ul><li><p>The <code>Provider</code> must be declared in the <code>Module</code></p></li><li><p>Any <code>Exception</code> that is thrown inside of <code>@Provides</code> will in turn throw a <code>ProvisionException</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class AlbumModule extends AbstractModule {
    @Override
    protected void configure() {
      ...
    }

    @Provides
    Connection provideConnection() {
        JdbcConnectionPool cp = JdbcConnectionPool.create(
                "jdbc:h2:tcp://localhost/~/test", "sa", "");
        try {
            return cp.getConnection();
        } catch (SQLException e) {
            throw new RuntimeException("Unable to create a connection", e);
        }
    }
}</code></pre></div></div></div></section><section id="_just_in_time_bindings"><h2>Just-in Time Bindings</h2><div class="slide-content"><div class="paragraph"><p>There are two annotations that you can use that maps the abstraction and the implementation.</p></div>
<div class="ulist"><ul><li><p><code>@ProvidedBy</code></p></li><li><p><code>@ImplementedBy</code></p></li></ul></div>
<div class="paragraph"><p>These annotations do the binding without the mapping in the <code>AbstractModule</code></p></div></div></section><section id="_providedby"><h2><code>@ProvidedBy</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">@ProvidedBy(DatabaseTransactionLogProvider.class)
public interface TransactionLog {
  void logConnectException(UnreachableException e);
  void logChargeResult(ChargeResult result);
}</code></pre></div></div>
<div class="paragraph"><p>This is the equivalent of</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">bind(TransactionLog.class)
        .toProvider(DatabaseTransactionLogProvider.class);</code></pre></div></div></div></section><section id="_implementedby"><h2><code>@ImplementedBy</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">@ImplementedBy(PayPalCreditCardProcessor.class) <i class="conum" data-value="1"></i><b>(1)</b>
public interface CreditCardProcessor {
  ChargeResult charge(String amount, CreditCard creditCard)
      throws UnreachableException;
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>@ImplementedBy</code> shows the sole implementer of the <code>interface</code></td></tr></table></div>
<div class="paragraph"><p>This is the equivalent of:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">bind(CreditCardProcessor.class).to(PayPalCreditCardProcessor.class);</code></pre></div></div></div></section><section id="_scopes"><h2>Scopes</h2><div class="slide-content"><div class="ulist"><ul><li><p>By Default, <strong><em>Guice returns a new instance each time it supplies a value</em></strong></p></li><li><p>A Scope can be made by either the by the <code>bind</code> statement or annotation.</p></li><li><p>Classes annotated <code>@Singleton</code><strong><em>must be threadsafe</em></strong>`</p></li></ul></div>
<div class="paragraph"><p>Either annotated on the class.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@Singleton
public class InMemoryTransactionLog implements TransactionLog {
  /* everything here should be threadsafe! */
}</code></pre></div></div>
<div class="paragraph"><p>Bound in the <code>AbstractModule</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">bind(TransactionLog.class).to(InMemoryTransactionLog.class).in(Singleton.class);</code></pre></div></div>
<div class="paragraph"><p>This can also be annotation on a <code>Provider&lt;T&gt;</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@Provides @Singleton
TransactionLog provideTransactionLog() {
  ...
}</code></pre></div></div></div></section><section id="_integration_testing_using_a_module"><h2>Integration Testing Using a Module</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consider multiple <code>AbstractModule</code></p></li><li><p>One will be necessary for production code.</p></li><li><p>But the other can be used for integration testing.</p></li><li><p>For example, the production database is wired with Guice for Production while the test database is used for Testing and Development.</p></li></ul></div></div></section></section>
<section><section id="_modules"><h2>Modules</h2></section><section id="_dependency_injection"><h2>Dependency Injection</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dependency injection is a widely used design pattern that helps separate your components’ behaviour from dependency resolution. Play supports both runtime dependency injection based on <a href="https://jcp.org/en/jsr/detail?id=330">JSR 330</a> (described in this page) and compile time dependency injection in Scala.</p></li><li><p>Runtime dependency injection is so called because the dependency graph is created, wired and validated at runtime. If a dependency cannot be found for a particular component, you won’t get an error until you run your application.</p></li><li><p>Play supports <a href="https://github.com/google/guice">Guice</a> out of the box, but other JSR 330 implementations can be plugged in.</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Guice is a Java library and the examples in this documentation use Guice’s built-in Java API. If you prefer a Scala DSL you might wish to use the <a href="https://github.com/codingwell/scala-guice">scala-guice</a> or <a href="https://github.com/sptz45/sse-guice">sse-guice</a> library.</td></tr></table></div></div></section><section id="_motivation"><h2>Motivation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dependency injection achieves several goals:</p><div class="olist arabic"><ol class="arabic"><li><p>It allows you to easily bind different implementations for the same component. This is useful especially for testing, where you can manually instantiate components using mock dependencies or inject an alternate implementation.<br></p></li><li><p>It allows you to avoid global static state. While static factories can achieve the first goal, you have to be careful to make sure your state is set up properly. In particular Play’s (now deprecated) static APIs require a running application, which makes testing less flexible. And having more than one instance available at a time makes it possible to run tests in parallel.</p></li></ol></div></li><li><p>The <a href="https://github.com/google/guice/wiki/Motivation">Guice wiki</a> has some good examples explaining this in more detail.</p></li></ul></div></div></section><section id="_how_it_works"><h2>How it works</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play provides a number of built-in components and declares them in modules such as its <code>BuiltinModule</code></p></li><li><p>These bindings describe everything that’s needed to create an instance of <code>Application</code>, including, by default, a router generated by the routes compiler that has your controllers injected into the constructor.</p></li><li><p>These bindings can then be translated to work in Guice and other runtime DI frameworks.</p></li></ul></div></div></section><section id="_what_play_provides"><h2>What Play Provides</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Play team maintains the Guice module, which provides a <code>GuiceApplicationLoader</code> which does the binding conversion for Guice, creates the Guice injector with those bindings, and requests an <code>Application</code> instance from the injector</p></li><li><p>There are also third-party loaders that do this for other frameworks, including <a href="https://github.com/scaldi/scaldi-play">Scaldi</a> and <a href="https://github.com/remithieblin/play-spring-loader">Spring</a></p></li><li><p>Alternatively, Play provides a <code>BuiltInComponents</code> trait that allows you to create a pure Scala implementation that wires together your app at compile time</p></li></ul></div></div></section><section id="_declaring_runtime_di_dependencies"><h2>Declaring runtime DI dependencies</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you have a component, such as a controller, and it requires some other components as dependencies, then this can be declared using the <a href="https://docs.oracle.com/javaee/7/api/javax/inject/Inject.html">@Inject</a> annotation.</p></li><li><p>The <code>@Inject</code> annotation can be used on fields or on constructors.</p></li><li><p>Also, Guice does come with several other <a href="https://github.com/google/guice/wiki/Injections">types of injections</a>, but constructor injection is generally the most clear, concise, and testable in Scala, so we recommend using it.</p></li><li><p>Guice is able to automatically instantiate any class with an <code>@Inject</code> on its constructor without having to explicitly bind it. This feature is called <a href="https://github.com/google/guice/wiki/JustInTimeBindings">just in time bindings</a></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject._
import play.api.libs.ws._

class MyComponent @Inject() (ws: WSClient) {
  // ...
}</code></pre></div></div></div></section><section id="_dependency_injecting_controllers"><h2>Dependency injecting controllers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play’s routes compiler generates a router class that declares your controllers as dependencies in the constructor. This allows your controllers to be injected into the router.</p></li><li><p>Prefixing the controller name with an <code>@</code> symbol takes on a special meaning: instead of the controller being injected directly, a <code>Provider</code> of the controller will be injected.</p></li><li><p>This allows, for example, prototype controllers, as well as an option for breaking cyclic dependencies</p></li></ul></div></div></section><section id="_component_lifecycle"><h2>Component lifecycle</h2><div class="slide-content"><div class="ulist"><ul><li><p>The dependency injection system manages the lifecycle of injected components, creating them as needed and injecting them into other components.</p></li></ul></div></div></section><section id="_new_instances"><h2>New Instances</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>New instances are created every time a component is needed</strong></p></li><li><p>If a component is used more than once, then, by default, multiple instances of the component will be created</p></li><li><p>If you only want a single instance of a component then you need to mark it as a singleton</p></li></ul></div></div></section><section id="_instances_created_lazily"><h2>Instances Created Lazily</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Instances are created lazily when they are needed</strong></p></li><li><p>If a component is never used by another component, then it won’t be created at all</p></li><li><p>This is usually what you want. For most components there’s no point creating them until they’re needed</p></li><li><p>However, in some cases you want components to be started up straight away or even if they’re not used by another component</p></li><li><p>For example, you might want to send a message to a remote system or warm up a cache when the application starts</p></li><li><p>You can force a component to be created eagerly by using an eager binding</p></li></ul></div></div></section><section id="_non_automatic_cleanup"><h2>Non-Automatic Cleanup</h2><div class="slide-content"><div class="ulist"><ul><li><p>Instances are <em>not</em> automatically cleaned up* beyond normal garbage collection.</p></li><li><p>Components will be garbage collected when they’re no longer referenced, but the framework won’t do anything special to shut down the component, like calling a <code>close</code> method.</p></li><li><p>However, Play provides a special type of component, called the <code>ApplicationLifecycle</code> which lets you register components to shut down when the application stops</p></li></ul></div></div></section><section id="_singletons"><h2>Singletons</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sometimes you may have a component that holds some state, such as a cache, or a connection to an external resource, or a component might be expensive to create.</p></li><li><p>In these cases it may be important that there is only be one instance of that component.</p></li><li><p>This can be achieved using the <a href="https://docs.oracle.com/javaee/7/api/javax/inject/Singleton.html">@Singleton</a> annotation:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject._

@Singleton
class CurrentSharePrice {
  @volatile private var price = 0

  def set(p: Int) = price = p
  def get         = price
}</code></pre></div></div></div></section><section id="_stoppingcleaning_up"><h2>Stopping/cleaning up</h2><div class="slide-content"><div class="ulist"><ul><li><p>Some components may need to be cleaned up when Play shuts down, for example, to stop thread pools</p></li><li><p>Play provides an <code>ApplicationLifecycle</code> component that can be used to register hooks to stop your component when Play shuts down</p></li><li><p>The <code>ApplicationLifecycle</code> will stop all components in reverse order from when they were created.</p></li><li><p>This means any components that you depend on can still safely be used in your component’s stop hook.</p></li><li><p>Because you depend on them, they must have been created before your component was, and therefore won’t be stopped until after your component is stopped.</p></li></ul></div></div></section><section id="_stoppingcleaning_up_by_example"><h2>Stopping/cleaning up by example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import scala.concurrent.Future
import javax.inject._
import play.api.inject.ApplicationLifecycle

@Singleton
class MessageQueueConnection @Inject() (lifecycle: ApplicationLifecycle) {
  val connection = connectToMessageQueue()
  lifecycle.addStopHook { () =&gt;
    Future.successful(connection.stop())
  }

  //...
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">It’s very important to ensure that all components that register a stop hook are singletons. Any non singleton components that register stop hooks could potentially be a source of memory leaks, since a new stop hook will be registered each time the component is created.</td></tr></table></div></div></section><section id="_providing_custom_bindings"><h2>Providing custom bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>It is considered good practice to define a trait for a component, and have other classes depend on that trait, rather than the implementation of the component</p></li><li><p>By doing that, you can inject different implementations, for example you inject a mock implementation when testing your application.</p></li><li><p>In this case, the DI system needs to know which implementation should be bound to that trait.</p></li><li><p>The way we recommend that you declare this depends on whether you are writing a Play application as an end user of Play, or if you are writing library that other Play applications will consume.</p></li></ul></div></div></section><section id="_play_applications"><h2>Play applications</h2><div class="slide-content"><div class="ulist"><ul><li><p>We recommend that Play applications use whatever mechanism is provided by the DI framework that the application is using. Although Play does provide a binding API, this API is somewhat limited, and will not allow you to take full advantage of the power of the framework you’re using.</p></li><li><p>Since Play provides support for Guice out of the box, the examples below show how to provide bindings for Guice.</p></li></ul></div></div></section><section id="_binding_annotations_2"><h2>Binding annotations</h2><div class="slide-content"><div class="paragraph"><p>The simplest way to bind an implementation to an interface is to use the Guice <a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/ImplementedBy.html">@ImplementedBy</a> annotation.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import com.google.inject.ImplementedBy

@ImplementedBy(classOf[EnglishHello])
trait Hello {
  def sayHello(name: String): String
}

class EnglishHello extends Hello {
  def sayHello(name: String) = "Hello " + name
}</code></pre></div></div></div></section><section id="_programmatic_bindings"><h2>Programmatic bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>In some more complex situations, you may want to provide more complex bindings, such as when you have multiple implementations of the one trait, which are qualified by <a href="https://docs.oracle.com/javaee/7/api/javax/inject/Named.html">@Named</a> annotations.</p></li><li><p>In these cases, you can implement a custom Guice <a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Module.html">Module</a>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import com.google.inject.AbstractModule
import com.google.inject.name.Names

class Module extends AbstractModule {
  override def configure() = {
    bind(classOf[Hello])
      .annotatedWith(Names.named("en"))
      .to(classOf[EnglishHello])

    bind(classOf[Hello])
      .annotatedWith(Names.named("de"))
      .to(classOf[GermanHello])
  }
}</code></pre></div></div></div></section><section id="_placing_module_at_root"><h2>Placing <code>Module</code> at root</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you call this module <code>Module</code> and place it in the root package, it will automatically be registered with Play.</p></li><li><p>Alternatively, if you want to give it a different name or put it in a different package, you can register it with Play by appending its fully qualified class name to the <code>play.modules.enabled</code> list in <code>application.conf</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.modules.enabled += "modules.HelloModule"</code></pre></div></div></div></section><section id="_disabling_modules"><h2>Disabling Modules</h2><div class="slide-content"><div class="paragraph"><p>You can also disable the automatic registration of a module named <code>Module</code> in the root package by adding it to the disabled modules:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-prettyprint hljs" data-noescape="true" data-lang="prettyprint">play.modules.disabled += "Module"</code></pre></div></div></div></section><section id="_configurable_bindings"><h2>Configurable bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sometimes you might want to read the Play <code>Configuration</code> or use a <code>ClassLoader</code> when you configure Guice bindings.</p></li><li><p>You can get access to these objects by adding them to your module’s constructor.</p></li><li><p>In the example below, the <code>Hello</code> binding for each language is read from a configuration file.</p></li><li><p>This allows new <code>Hello</code> bindings to be added by adding new settings in your <code>application.conf</code> file.</p></li></ul></div></div></section><section id="_eager_bindings"><h2>Eager bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you only want to create these objects once, perhaps because they’re expensive to create, then you should use the <code>@Singleton</code> annotation.</p></li><li><p>If you want to create them once and also create them <em>eagerly</em> when the application starts up, rather than lazily when they are needed, then you can <a href="https://github.com/google/guice/wiki/Scopes#eager-singletons">Guice’s eager singleton binding</a>.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">  import com.google.inject.AbstractModule
  import com.google.inject.name.Names

// A Module is needed to register bindings
  class Module extends AbstractModule {
    override def configure() = {
      // Bind the `Hello` interface to the `EnglishHello` implementation as eager singleton.
      bind(classOf[Hello])
        .annotatedWith(Names.named("en"))
        .to(classOf[EnglishHello])
        .asEagerSingleton()

      bind(classOf[Hello])
        .annotatedWith(Names.named("de"))
        .to(classOf[GermanHello])
        .asEagerSingleton()
    }
  }</code></pre></div></div></div></section><section id="_applying_it_to_a_shutdown_hook"><h2>Applying it to a shutdown hook</h2><div class="slide-content"><div class="ulist"><ul><li><p>Eager singletons can be used to start up a service when an application starts.</p></li><li><p>They are often combined with a shutdown hook so that the service can clean up its resources when the application stops.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">  import scala.concurrent.Future
  import javax.inject._
  import play.api.inject.ApplicationLifecycle

// This creates an `ApplicationStart` object once at start-up and registers hook for shut-down.
  @Singleton
  class ApplicationStart @Inject() (lifecycle: ApplicationLifecycle) {
    // Shut-down hook
    lifecycle.addStopHook { () =&gt;
      Future.successful(())
    }
    //...
  }</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import com.google.inject.AbstractModule

class StartModule extends AbstractModule {
  override def configure() = {
    bind(classOf[ApplicationStart]).asEagerSingleton()
  }
}</code></pre></div></div></div></section><section id="_play_libraries"><h2>Play libraries</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you’re implementing a library for Play, then you probably want it to be DI framework agnostic, so that your library will work out of the box regardless of which DI framework is being used in an application. For this reason, Play provides a lightweight binding API for providing bindings in a DI framework agnostic way.</p></li><li><p>To provide bindings, implement a <code>Module</code> to return a sequence of the bindings that you want to provide.</p></li><li><p>The <code>Module</code> trait also provides a DSL for building bindings</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.inject._

class HelloModule extends Module {
  def bindings(environment: Environment, configuration: Configuration) = Seq(
    bind[Hello].qualifiedWith("en").to[EnglishHello],
    bind[Hello].qualifiedWith("de").to[GermanHello]
  )
}</code></pre></div></div>
<div class="listingblock"><div class="title">Enabling the Module</div><div class="content"><pre class="highlightjs highlight"><code class="language-prettyprint hljs" data-noescape="true" data-lang="prettyprint">play.modules.enabled += "com.example.HelloModule"</code></pre></div></div></div></section><section id="_environment_and_configuration"><h2><code>Environment</code> and <code>Configuration</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>Module</code> <code>bindings</code> method takes a Play <code>Environment</code> and <code>Configuration</code>.</p></li><li><p>You can access these if you want to configure the bindings dynamically</p></li><li><p>Module bindings support eager bindings.</p></li><li><p>To declare an eager binding, add <code>.eagerly</code> at the end of your <code>Binding</code>.</p></li></ul></div></div></section><section id="_things_to_keep_in_mind"><h2>Things to Keep in Mind</h2><div class="slide-content"><div class="ulist"><ul><li><p>Not all DI frameworks support just in time bindings. Make sure all components that your library provides are explicitly bound.</p></li><li><p>Try to keep binding keys simple - different runtime DI frameworks have very different views on what a key is and how it should be unique or not.</p></li></ul></div></div></section><section id="_excluding_modules"><h2>Excluding modules</h2><div class="slide-content"><div class="ulist"><ul><li><p>If there is a module that you don’t want to be loaded, you can exclude it by appending it to the <code>play.modules.disabled</code> property in <code>application.conf</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.modules.disabled += "play.api.db.evolutions.EvolutionsModule"</code></pre></div></div></div></section><section id="_identifying_circular_dependencies"><h2>Identifying circular dependencies</h2><div class="slide-content"><div class="ulist"><ul><li><p>Circular dependencies happen when one of your components depends on another component that depends on the original component (either directly or indirectly)</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject

class Foo @Inject() (bar: Bar)
class Bar @Inject() (baz: Baz)
class Baz @Inject() (foo: Foo)</code></pre></div></div></div></section><section id="_circular_dependency_remediation"><h2>Circular Dependency Remediation</h2><div class="slide-content"><div class="paragraph"><p>You can work around the circular dependency problem by using a <code>Provider</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject
import javax.inject.Provider

class Foo @Inject() (bar: Bar)
class Bar @Inject() (baz: Baz)
class Baz @Inject() (foo: Provider[Foo])</code></pre></div></div></div></section><section id="_dependency_recommendations"><h2>Dependency Recommendations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Generally, circular dependencies can be resolved by breaking up your components in a more atomic way, or finding a more specific component to depend on</p></li><li><p>A common problem is a dependency on <code>Application</code>.</p></li><li><p>When your component depends on <code>Application</code> it’s saying that it needs a complete application to do its job; typically that’s not the case.</p></li><li><p>Your dependencies should be on more specific components (e.g. <code>Environment</code>) that have the specific functionality you need.</p></li><li><p>As a last resort you can work around the problem by injecting a <code>Provider[Application]</code>.</p></li></ul></div></div></section></section>
<section id="_lab_creating_a_module"><h2>Lab: Creating a Module</h2></section>
<section><section id="_routes"><h2>Routes</h2></section><section id="_built_in_http_router"><h2>Built-in HTTP Router</h2><div class="slide-content"><div class="ulist"><ul><li><p>The router is the component in charge of translating each incoming HTTP request to an <code>Action</code></p></li><li><p>An HTTP request is seen as an event by the MVC framework. This event contains two major pieces of information:</p><div class="ulist"><ul><li><p>the request path (e.g. <code>/clients/1542</code>, <code>/photos/list</code>), including the query string</p></li><li><p>the HTTP method (e.g. <code>GET</code>, <code>POST</code>, …).</p></li></ul></div></li><li><p>Routes are defined in the <em>conf/routes</em> file, which is compiled.</p></li></ul></div></div></section><section id="_errors_when_routes_not_found"><h2>Errors when Routes not Found</h2><div class="slide-content"><div class="openblock center"><div class="content"><div class="paragraph"><p>When the route is not found you will get a screenshot like this:</p></div></div></div>
<div class="imageblock"><img src="./images/routesError.png" alt="routesError" width="75%" height="75%"></div></div></section><section id="_routes_dependency_injected"><h2>Routes Dependency Injected</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play’s default routes generator creates a router class that accepts controller instances in an <code>@Inject</code>-annotated constructor.</p></li><li><p>That means the class is suitable for use with dependency injection and can also be instantiated manually using the constructor.</p></li></ul></div></div></section><section id="_routes_syntax"><h2>Routes Syntax</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>conf/routes</em> is the configuration file used by the router</p></li><li><p>This file lists all of the routes needed by the application</p></li><li><p>Each route:</p><div class="ulist"><ul><li><p>consists of an HTTP method and URI pattern</p></li><li><p>is associated with a call to an Action generator</p></li></ul></div></li></ul></div></div></section><section id="_get_example"><h2><code>GET</code> example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala"># Display a client.
GET   /clients/:id          controllers.Clients.show(id: Long)</code></pre></div></div></div></section><section id="_all_http_methods_included"><h2>All <code>HTTP</code> Methods included</h2><div class="slide-content"><div class="ulist"><ul><li><p>The HTTP method can be any of the valid methods supported by HTTP:</p><div class="ulist"><ul><li><p><code>GET</code></p></li><li><p><code>PATCH</code></p></li><li><p><code>POST</code></p></li><li><p><code>PUT</code></p></li><li><p><code>DELETE</code></p></li><li><p><code>HEAD</code></p></li></ul></div></li></ul></div></div></section><section id="_the_uri_pattern"><h2>The URI pattern</h2><div class="slide-content"><div class="ulist"><ul><li><p>The URI pattern defines the route’s request path.</p></li><li><p>Parts of the request path can be dynamic.</p></li></ul></div>
<div class="listingblock"><div class="title">Static path - For example, to exactly match incoming GET /clients/all requests, you can define this route:</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /clients/all          controllers.Clients.list()</code></pre></div></div>
<div class="listingblock"><div class="title">Dynamic parts - If you want to define a route that retrieves a client by ID, you’ll need to add a dynamic part:</div><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">GET   /clients/:id          controllers.Clients.show(id: Long)</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">A URI pattern may have more than one dynamic part</td></tr></table></div></div></section><section id="_dynamic_parts_with_pattern_matching"><h2>Dynamic Parts with Pattern Matching</h2><div class="slide-content"><div class="ulist"><ul><li><p>The default matching strategy for a dynamic part is defined by the regular expression <code>[^/]+</code></p></li><li><p>Any dynamic part defined as <code>:id</code> will match exactly one URI path segment.</p></li><li><p>Unlike other pattern types, path segments are automatically URI-decoded in the route, before being passed to your controller, and encoded in the reverse route</p></li></ul></div></div></section><section id="_dynamic_parts_with_more_than_one"><h2>Dynamic Parts with More than one <code>/</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Using the <code>*id</code> syntax</p><div class="ulist"><ul><li><p>Can parse multiple URI path segments separated by <code>/</code></p></li><li><p>This is also known as a wildcard pattern</p></li><li><p>This will use the <code>.*</code> regular expression</p></li></ul></div></li></ul></div></div></section><section id="_example_of_dynamic_url_parsing"><h2>Example of dynamic URL parsing</h2><div class="slide-content"><div class="ulist"><ul><li><p>Here we can parse <code>GET /files/images/logo.png</code></p></li><li><p>The name dynamic part will capture the <code>images/logo.png</code> value</p></li><li><p>The dynamic parts spanning several <code>/</code> are not decoded by the router or encoded by the reverse router</p></li><li><p>It is your responsibility to validate the raw URI segment as you would for any user input</p></li><li><p>The reverse router simply does a string concatenation, so you will need to make sure the resulting path is valid, and does not, for example, contain multiple leading slashes or non-ASCII characters</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /files/*name          controllers.Application.download(name)</code></pre></div></div></div></section><section id="_dynamic_parts_with_a_regular_expression"><h2>Dynamic Parts with a Regular Expression</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also define your own regular expression for the dynamic part, using the <code>$id&lt;regex&gt;</code> syntax</p></li><li><p>Just like with wildcard routes, the parameter is not decoded by the router or encoded by the reverse router</p></li><li><p>You’re responsible for validating the input to make sure it makes sense in that context</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /items/$id&lt;[0-9]+&gt;    controllers.Items.show(id: Long)</code></pre></div></div></div></section><section id="_call_to_the_action_generator_method"><h2>Call to the <code>Action</code> generator method</h2><div class="slide-content"><div class="ulist"><ul><li><p>The last part of a route definition is the call.</p></li><li><p>This part must define a valid call to a method returning a <code>play.api.mvc.Action</code> value</p></li><li><p>Your <code>Action</code> will typically be in a controller as a method</p></li><li><p>If the method does not define any parameters, just give the fully-qualified method name</p></li></ul></div>
<div class="listingblock"><div class="title">The URL <code>/</code> will go to the <code>homePage()</code> method in the <code>Application</code> controller</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /  controllers.Application.homePage()</code></pre></div></div></div></section><section id="_extracting_uri_parameters"><h2>Extracting URI Parameters</h2><div class="slide-content"><div class="ulist"><ul><li><p>If the action method defines some parameters, all these parameter values will be searched for in the request URI</p></li><li><p>This will either extracted from:</p><div class="ulist"><ul><li><p>The URI path itself</p></li><li><p>The query string.</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="title">Extract the page parameter <code>:page</code> from the path</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /:page                controllers.Application.show(page)</code></pre></div></div>
<div class="listingblock"><div class="title">Extract the page parameter from the query string, note the URI doesn&#8217;t contain the parameter formally</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /                     controllers.Application.show(page)</code></pre></div></div></div></section><section id="_example_of_show_method_in_a_controller"><h2>Example of <code>show</code> method in a <code>Controller</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def show(page: String) = Action {
  loadContentFromDatabase(page)
    .map { htmlContent =&gt;
      Ok(htmlContent).as("text/html")
    }
    .getOrElse(NotFound)
}</code></pre></div></div></div></section><section id="_parameter_types"><h2>Parameter Types</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can transform any parameter into a Scala type</p></li><li><p>For example, take the Id and ensure that it is a type <code>Long</code></p></li><li><p>If the URL is called incorrectly then the client will receive a <code>404</code> not found</p></li></ul></div>
<div class="listingblock"><div class="title">The route with a typed parameter</div><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">GET   /clients/:id          controllers.Clients.show(id: Long)</code></pre></div></div>
<div class="listingblock"><div class="title">The corresponding <code>Action</code> code</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def show(id: Long) = Action {
  Client
    .findById(id)
    .map { client =&gt;
      Ok(views.html.Clients.display(client))
    }
    .getOrElse(NotFound)
}</code></pre></div></div></div></section><section id="_supporting_parameter_types"><h2>Supporting Parameter Types</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play supports the following Parameter Types:</p><div class="ulist"><ul><li><p><code>String</code></p></li><li><p><code>Int</code></p></li><li><p><code>Long</code></p></li><li><p><code>Double</code></p></li><li><p><code>Float</code></p></li><li><p><code>Boolean</code></p></li><li><p><code>UUID</code></p></li><li><p><code>AnyVal</code> wrappers for other supported types</p></li></ul></div></li></ul></div></div></section><section id="_parameters_with_fixed_values"><h2>Parameters with fixed values</h2><div class="slide-content"><div class="paragraph"><p>Sometimes you’ll want to use a fixed value for a parameter:</p></div>
<div class="listingblock"><div class="title">Extract the page parameter from the path, or fix the value for <code>/</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">GET   /        controllers.Application.show(page = "home")
GET   /:page   controllers.Application.show(page)</code></pre></div></div></div></section><section id="_parameters_with_default_values"><h2>Parameters with default values</h2><div class="slide-content"><div class="ulist"><ul><li><p>Parameters with default values</p></li><li><p>You can also provide a default value that will be used if no value is found in the incoming request:</p></li></ul></div>
<div class="listingblock"><div class="title">Calling a URL like <code>/clients?page=3</code> will override the default of <code>1</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /clients controllers.Clients.list(page: Int ?= 1)</code></pre></div></div></div></section><section id="_optional_parameters"><h2>Optional Parameters</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also specify an optional parameter that does not need to be present in all requests:</p></li></ul></div>
<div class="listingblock"><div class="title">The version parameter is optional but can be provided with <code>/api/list-all?version=3.0</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /api/list-all         controllers.Api.list(version: Option[String])</code></pre></div></div></div></section><section id="_list_parameters"><h2>List parameters</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also specify list parameters for repeated query string parameters:</p></li></ul></div>
<div class="listingblock"><div class="title">Reading in a single parameter in the list <code>/api/list-items?item=red&amp;item=new&amp;item=slippers</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /api/list-items      controllers.Api.listItems(item: List[String])</code></pre></div></div>
<div class="listingblock"><div class="title">Reading two parameters for <code>/api/list-int-items?item=1&amp;item=42</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /api/list-int-items  controllers.Api.listIntItems(item: List[Int])</code></pre></div></div></div></section><section id="_routing_priority"><h2>Routing priority</h2><div class="slide-content"><div class="ulist"><ul><li><p>Many routes can match the same request.</p></li><li><p>If there is a conflict, the first route (in declaration order) is used.</p></li></ul></div></div></section><section id="_reverse_routing"><h2>Reverse Routing</h2><div class="slide-content"><div class="ulist"><ul><li><p>The router can also be used to generate a URL from within a Scala call.</p></li><li><p>This makes it possible to centralize all your URI patterns in a single configuration file, so you can be more confident when refactoring your application!</p></li><li><p>For each controller used in the routes file, the router will generate a ‘reverse controller’ in the routes package</p></li><li><p>Every controller will have the same action methods, with the same signature, but returning a <code>play.api.mvc.Call</code> instead of a <code>play.api.mvc.Action</code></p></li><li><p>The <code>play.api.mvc.Call</code> defines an HTTP call, and provides both the HTTP method and the URI</p></li></ul></div></div></section><section id="_reverse_routing_create_your_action"><h2>Reverse Routing: Create your <code>Action</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">package controllers
import javax.inject.Inject

import play.api._
import play.api.mvc._

class Application @Inject() (cc: ControllerComponents) extends AbstractController(cc) {
  def hello(name: String) = Action {
    Ok("Hello " + name + "!")
  }
}</code></pre></div></div></div></section><section id="_apply_the_route"><h2>Apply the route</h2><div class="slide-content"><div class="listingblock"><div class="title">Applying the route as normal</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /hello/:name          controllers.Application.hello(name)</code></pre></div></div></div></section><section id="_retrieving_the_reverse_route"><h2>Retrieving the Reverse Route</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can then reverse the URL to the hello action method</p></li><li><p>Use <code>routes</code> and call the controller</p></li><li><p>The benefit is if you ever change the URL, all your code, <em>will not be affected</em>!</p></li><li><p>There is a routes sub-package for each controller package if you need better organization</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def helloBob = Action {
  Redirect(routes.Application.hello("Bob"))
}</code></pre></div></div></div></section><section id="_reverse_routing_in_detail"><h2>Reverse routing in detail</h2><div class="slide-content"><div class="ulist"><ul><li><p>The reverse action method works quite simply:</p><div class="ulist"><ul><li><p>It takes your parameters and substitutes them back into the route pattern.</p></li><li><p>In the case of path segments <code>(:foo)</code>, the value is encoded before the substitution is done.</p></li><li><p>For regex and wildcard patterns the string is substituted in raw form since the value may span multiple segments.</p></li><li><p>Make sure you escape those components as desired when passing them to the reverse route, and avoid passing unvalidated user input</p></li></ul></div></li></ul></div></div></section><section id="_relative_routes"><h2>Relative Routes</h2><div class="slide-content"><div class="ulist"><ul><li><p>There are instances where returning a relative route instead of an absolute may be useful.</p></li><li><p>The routes returned by <code>play.mvc.Call</code> are always absolute (they lead with a <code>/</code>),</p></li><li><p>This though can lead to problems when requests to your web application are rewritten by HTTP proxies, load balancers, and API gateways.</p></li></ul></div></div></section><section id="_relative_route_applications"><h2>Relative Route Applications</h2><div class="slide-content"><div class="ulist"><ul><li><p>Some examples where using a relative route would be useful include:</p><div class="ulist"><ul><li><p>Hosting an app behind a web gateway that prefixes all routes with something other than what is configured in your <em>conf/routes file</em>, and roots your application at a route it’s not expecting.</p></li><li><p>When dynamically rendering stylesheets, you need asset links to be relative because they may end up getting served from different URLs by a CDN</p></li><li><p>To be able to generate a relative route you need to know what to make the target route relative to (the start route).</p><div class="ulist"><ul><li><p>The start route can be retrieved from the current RequestHeader.</p></li><li><p>Therefore, to generate a relative route it’s required that you pass in your current RequestHeader or the start route as a String parameter.</p></li></ul></div></li></ul></div></li></ul></div></div></section><section id="_relative_routes_in_action_the_controller"><h2>Relative Routes in Action, the Controller</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">package controllers

import javax.inject._
import play.api.mvc._

@Singleton
class Relative @Inject() (cc: ControllerComponents) extends AbstractController(cc) {
  def helloview() = Action { implicit request =&gt;
    Ok(views.html.hello("Bob"))
  }

  def hello(name: String) = Action {
    Ok(s"Hello $name!")
  }
}</code></pre></div></div></div></section><section id="_relative_routes_in_action_the_route"><h2>Relative Routes in Action, the Route</h2><div class="slide-content"><div class="listingblock"><div class="title">Map the route to the Controller</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET     /foo/bar/hello              controllers.Relative.helloview
GET     /hello/:name                controllers.Relative.hello(name)</code></pre></div></div></div></section><section id="_using_the_relative_route_in_the_view"><h2>Using the relative route in the view!</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>Request</code> is decorated with <code>RequestHeader</code> and is brought into your template <em>implicitly</em></p></li><li><p>Note that it decorates the method <code>hello</code> with a <code>relative</code> method</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(name: String)(implicit request: RequestHeader)

&lt;h1&gt;Hello @name&lt;/h1&gt;

&lt;a href="@routes.Relative.hello(name)"&gt;Absolute Link&lt;/a&gt;
&lt;a href="@routes.Relative.hello(name).relative"&gt;Relative Link&lt;/a&gt;</code></pre></div></div></div></section><section id="_the_result_of_the_relative_view"><h2>The result of the relative view</h2><div class="slide-content"><div class="ulist"><ul><li><p>When requesting <code>/foo/bar/hello</code> the generated HTML will like the following sample</p></li><li><p>Notice how the relative link looks</p></li><li><p>Consider these implications when we deploy to an environment with a context-path</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;title&gt;Bob&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;a href="/hello/Bob"&gt;Absolute Link&lt;/a&gt;
      &lt;a href="../../hello/Bob"&gt;Relative Link&lt;/a&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div></section><section id="_default_controllers"><h2>Default Controllers</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Play includes a Default controller which provides a handful of useful actions</p></li><li class="fragment"><p>These can be invoked directly from the routes file</p></li></ul></div>
<div class="listingblock"><div class="title">Redirects to <a href="https://www.playframework.com/" class="bare">https://www.playframework.com/</a> with status "303 See Other"</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /about      controllers.Default.redirect(to = "https://www.playframework.com/")</code></pre></div></div>
<div class="listingblock"><div class="title">Responds with 404 Not Found</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /orders     controllers.Default.notFound</code></pre></div></div>
<div class="listingblock"><div class="title">Responds with 500 Internal Server Error</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /clients    controllers.Default.error</code></pre></div></div>
<div class="listingblock"><div class="title">Responds with 501 Not Implemented</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /posts      controllers.Default.todo</code></pre></div></div></div></section></section>
<section><section id="_twirl_templates"><h2>Twirl Templates</h2></section><section id="_what_is_twirl"><h2>What is Twirl?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play comes with Twirl, a powerful Scala-based template engine, whose design was inspired by ASP.NET Razor. Specifically it is:</p><div class="ulist"><ul><li><p><strong>compact, expressive, and fluid:</strong> it minimizes the number of characters and keystrokes required in a file, and enables a fast, fluid coding workflow.
Unlike most template syntaxes, you do not need to interrupt your coding to explicitly denote server blocks within your HTML.
The parser is smart enough to infer this from your code. This enables a really compact and expressive syntax which is clean, fast and fun to type.</p></li><li><p><strong>easy to learn:</strong> it allows you to quickly become productive, with a minimum of concepts.
You use simple Scala constructs and all your existing HTML skills.</p></li><li><p><strong>not a new language:</strong> we consciously chose not to create a new language.
Instead we wanted to enable Scala developers to use their existing Scala language skills, and deliver a template markup syntax that enables an awesome HTML construction workflow.</p></li><li><p><strong>editable in any text editor:</strong> it doesn’t require a specific tool and enables you to be productive in any plain old text editor</p></li></ul></div></li></ul></div></div></section><section id="_view_errors"><h2>View Errors</h2><div class="slide-content"><div class="paragraph"><p>Templates are compiled, so you will see any errors in your browser:</p></div>
<div class="imageblock"><img src="./images/compilation_error.png" alt="compilation error"></div></div></section><section id="_play_scala_templates"><h2>Play Scala Templates</h2><div class="slide-content"><div class="ulist"><ul><li><p>Simple Text File that can create HTML, CSV, XML</p></li><li><p>Templates are compiled as standard Scala functions</p></li><li><p>If you create a <em>views/Application/index.scala.html</em> template file, it will generate a <code>views.html.Application.index</code> class that has an <code>apply()</code> method</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(customer: Customer, orders: List[Order])

&lt;h1&gt;Welcome @customer.name!&lt;/h1&gt;

&lt;ul&gt;
@for(order &lt;- orders) {
  &lt;li&gt;@order.title&lt;/li&gt;
}
&lt;/ul&gt;</code></pre></div></div></li><li><p>You can call it just like was a method in a class</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val content = views.html.Application.index(c, o)</code></pre></div></div></li></ul></div></div></section><section id="_the_magic_character"><h2>The Magic <code>@</code> character</h2><div class="slide-content"><div class="ulist"><ul><li><p>Twirl templates use <code>@</code> as the single special character.</p></li><li><p>When this character is encountered, it indicates the beginning of a dynamic statement.</p></li><li><p>You are not required to explicitly close the code block - the end of the dynamic statement will be inferred from your code</p></li></ul></div>
<div class="listingblock"><div class="title">The <code>@customer.name</code> is dynamic code that will be interpolated</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Hello @customer.name!</code></pre></div></div></div></section><section id="_complex_code_with_twirl"><h2>Complex Code with Twirl</h2><div class="slide-content"><div class="ulist"><ul><li><p>The template engine automatically detects the end of your code block by analyzing your code</p></li><li><p>It does well with with simple statements</p></li><li><p>If you want to insert a multi-token statement, explicitly mark it using parenthesis</p></li></ul></div>
<div class="listingblock"><div class="title">Notice the parenthesis surrounding <code>customer.firstName</code> and <code>customer.lastName</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Hello @(customer.firstName + customer.lastName)!</code></pre></div></div></div></section><section id="_do_not_include_whitespace"><h2>Do not include whitespace</h2><div class="slide-content"><div class="ulist"><ul><li><p>Make sure not to include whitespaces between keywords of dynamic statements and parentheses.</p></li></ul></div>
<div class="listingblock"><div class="title">Notice the space after the <code>@for</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@for (menu <- menuList) { ... }  <span class="red">// Compilation error: '(' expected but ')' found.</span></code></pre></div></div></div></section><section id="_complex_code_using_braces"><h2>Complex Code Using Braces</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also use curly brackets, to write a multi-statement block:</p></li></ul></div>
<div class="listingblock"><div class="title">Notice the scala code with in the <code>{}</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Hello @{val name = customer.firstName + customer.lastName; name}!</code></pre></div></div></div></section><section id="_escaping_with"><h2>Escaping <code>@</code> with <code>@@</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Because <code>@</code> is a special character, you’ll sometimes need to escape it. Do this by using <code>@@</code>:</p></li></ul></div>
<div class="listingblock"><div class="title">Using <code>@@</code> within an email</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">My email is bob<span class="green">@@</span>example.com</code></pre></div></div></div></section><section id="_template_parameters"><h2>Template Parameters</h2><div class="slide-content"><div class="ulist"><ul><li><p>A template is like a function, so it needs parameters, which must be declared at the top of the template file</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(customer: Customer, orders: List[Order])</code></pre></div></div></li><li><p>Templates can also have default values in case one is not specified</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(title: String = "Home")</code></pre></div></div></li><li><p>You can also have parameter groups</p></li><li><p>This will be essential when applying <code>implicit</code> parameters</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(title: String)(body: Html)</code></pre></div></div></li></ul></div></div></section><section id="_template_constructor"><h2>Template Constructor</h2><div class="slide-content"><div class="ulist"><ul><li><p>By default, a template is generated as a static function that can be invoked in any context</p></li><li><p>If your template has dependencies on components, such as the messages API, you may find it easier to inject it with the components (and other templates) that it needs</p></li><li><p>You can then <em>inject</em> that template into the controllers that use it</p></li><li><p>Twirl supports declaring a constructor for templates, using <code>@this()</code> syntax at the start of the file, before the template parameters</p></li><li><p>The arguments to the constructor can be defined in the same way as the template parameters</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@this(myComponent: MyComponent)

@(customer: Customer, orders: List[Order])</code></pre></div></div></div></section><section id="_iterating"><h2>Iterating</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can use the <code>for</code> keyword, in a pretty standard way</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;ul&gt;
@for(p &lt;- products) {
  &lt;li&gt;@p.name ($@p.price)&lt;/li&gt;
}
&lt;/ul&gt;</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Make sure that { is on the same line with for to indicate that the expression continues to next line.</td></tr></table></div></div></section><section id="_if_blocks"><h2>If-blocks</h2><div class="slide-content"><div class="ulist"><ul><li><p>If-blocks simply use Scala’s standard <code>if</code> statement:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@if(items.isEmpty) {
  &lt;h1&gt;Nothing to display&lt;/h1&gt;
} else {
  &lt;h1&gt;@items.size items!&lt;/h1&gt;
}</code></pre></div></div></div></section><section id="_declaring_reusable_blocks"><h2>Declaring reusable blocks</h2><div class="slide-content"><div class="paragraph"><p>You can create reusable code blocks by declaring a tag using <code>@methodname</code> where method name is your reusable block</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@display(product: Product) = {
  @product.name ([email protected])
}

&lt;ul&gt;
@for(product &lt;- products) {
  @display(product)
}
&lt;/ul&gt;</code></pre></div></div></div></section><section id="_reusable_pure_code_blocks"><h2>Reusable pure code blocks:</h2><div class="slide-content"><div class="paragraph"><p>You can also create code blocks like the following <code>@title</code> block</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@title(text: String) = @{
  text.split(' ').map(_.capitalize).mkString(" ")
}

&lt;h1&gt;@title("hello world")&lt;/h1&gt;</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Declaring code block this way in a template can be sometime useful but keep in mind that a template is not the best place to write complex logic. It is often better to externalize these kind of code in a Scala class (that you can store under the <code>views/</code> package as well if you want).</td></tr></table></div></div></section><section id="_implicit_reusable_blocks"><h2><code>implicit</code> reusable blocks</h2><div class="slide-content"><div class="paragraph"><p>By convention a reusable block defined with a name starting with <strong>implicit</strong> will be marked as <code>implicit</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@implicitFieldConstructor = @{ MyFieldConstructor() }</code></pre></div></div></div></section><section id="_declaring_reusable_values"><h2>Declaring reusable values</h2><div class="slide-content"><div class="paragraph"><p>You can define scoped values using the <code>defining</code> helper</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@defining(user.firstName + " " + user.lastName) { fullName =&gt;
  &lt;div&gt;Hello @fullName&lt;/div&gt;
}</code></pre></div></div></div></section><section id="_import_statements"><h2>Import statements</h2><div class="slide-content"><div class="paragraph"><p>You can import whatever you want at the beginning of your template (or sub-template)</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(customer: Customer, orders: List[Order])

@import utils._</code></pre></div></div></div></section><section id="_import_from_root"><h2>Import from Root</h2><div class="slide-content"><div class="paragraph"><p>To make an absolute resolution, use <strong><em>root</em></strong> prefix in the import statement.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@import _root_.company.product.core._</code></pre></div></div></div></section><section id="_common_imports_for_all_templates"><h2>Common imports for all templates</h2><div class="slide-content"><div class="paragraph"><p>If you have common imports, which you need in all templates, you can declare in <code>build.sbt</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">TwirlKeys.templateImports += "org.abc.backend._"</code></pre></div></div></div></section><section id="_comments"><h2>Comments</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can write server side block comments in templates using <code>@* *@</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@*********************
* This is a comment *
*********************@</code></pre></div></div>
<div class="ulist"><ul><li><p>You can put a comment on the first line to document your template into the Scala API doc:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@*************************************
 * Home page.                        *
 *                                   *
 * @param msg The message to display *
 *************************************@
@(msg: String)

&lt;h1&gt;@msg&lt;/h1&gt;</code></pre></div></div></div></section><section id="_escaping"><h2>Escaping</h2><div class="slide-content"><div class="ulist"><ul><li><p>By default, dynamic content parts are escaped according to the template type’s (e.g. HTML or XML) rules.</p></li><li><p>If you want to output a raw content fragment, wrap it in the template content type.</p></li><li><p>For example to output raw HTML:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;p&gt;
  @Html(article.content)
&lt;/p&gt;</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">When using this feature, consider the security implications of outputting raw HTML if there is any possibility that the user can control the content. This technique is a common cause of Cross Site Scripting (XSS) vulnerabilities and is dangerous if not used with caution.</td></tr></table></div></div></section><section id="_string_interpolation"><h2>String interpolation</h2><div class="slide-content"><div class="ulist"><ul><li><p>The template engine can be used as a <a href="https://docs.scala-lang.org/overviews/core/string-interpolation.html">string interpolator</a></p></li><li><p>Basically, trade the <code>@</code> for a <code>$</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.twirl.api.StringInterpolation

val name = "Martin"
val p    = html"&lt;p&gt;Hello $name&lt;/p&gt;"</code></pre></div></div></div></section><section id="_displaying_scala_types"><h2>Displaying Scala types</h2><div class="slide-content"><div class="ulist"><ul><li><p>Twirl typically renders values of Scala types by calling <code>toString</code> method on them.</p></li><li><p>However, if values are wrapped inside <code>Option</code> or collections (<code>Seq</code>, <code>Array</code>, <code>TraversableOnce</code>)</p></li><li><p>Twirl first unwraps the values and then calls <code>toString</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;ul&gt;
  &lt;li&gt;@Option("value inside option")&lt;/li&gt;
  &lt;li&gt;@List("first", "last")&lt;/li&gt;
  &lt;li&gt;@User("Foo", "Bar")&lt;/li&gt;
  &lt;li&gt;@List("hello", User("Foo", "Bar"), Option("value inside option"), List("first", "last"))&lt;/li&gt;
&lt;/ul&gt;</code></pre></div></div>
<div class="imageblock"><img src="./images/displayScalaTypes.png" alt="displayScalaTypes"></div></div></section></section>
<section><section id="_forms"><h2>Forms</h2></section><section id="_form"><h2><code>Form</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Form handling and submission is an important part of any web application</p></li><li><p>Play comes with features that make handling simple forms easy and complex forms possible</p></li><li><p>Play’s form handling approach is based around the concept of binding data</p></li><li><p>When data comes in from a POST request</p><div class="ulist"><ul><li><p>Play will look for formatted values and bind them to a Form object</p></li><li><p>From there, Play can use the bound form to value a case class with data, call custom validations, and so on</p></li></ul></div></li><li><p>Typically forms are used directly from a <code>BaseController</code> instance</p></li><li><p><code>Form</code> definitions do not have to match up exactly with case classes or models: they are purely for handling input and it is reasonable to use a distinct Form for a distinct <code>POST</code></p></li></ul></div></div></section><section id="_form_handling"><h2>Form Handling</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Form Handling goes through</dt><dd><div class="ulist"><ul><li><p>Defining a form,</p></li><li><p>Defining constraints in the form</p></li><li><p>Validating the form in an action</p></li><li><p>Displaying the form in a view template</p></li><li><p>And finally, processing the result (or errors) of the form in a view template</p></li></ul></div></dd></dl></div></div></section><section id="_form_lifecycle"><h2>Form Lifecycle</h2><div class="slide-content"><div class="imageblock"><img src="./images/form_lifecycle.png" alt="form lifecycle"></div>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p><a href="https://www.playframework.com/documentation/2.8.x/ScalaForms" class="bare">https://www.playframework.com/documentation/2.8.x/ScalaForms</a></p></div></div></div></div></section><section id="_defining_a_form"><h2>Defining a Form</h2><div class="slide-content"><div class="paragraph"><p>Define a case class which contains the elements you want in the form.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class UserData(name: String, age: Int)</code></pre></div></div></div></section><section id="_define_the_form_structure"><h2>Define the <code>Form</code> structure</h2><div class="slide-content"><div class="ulist"><ul><li><p>Next step is to define a Form structure.</p></li><li><p>The function of a <code>Form</code> is to transform form data into a bound instance of a <code>case class</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userForm = Form(
  mapping(
    "name" -&gt; text,
    "age"  -&gt; number
  )(UserData.apply)(UserData.unapply)
)</code></pre></div></div></div></section><section id="_define_the_form_structure_2"><h2>Define the <code>Form</code> structure</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Forms object defines the mapping method.</p></li><li><p>This method takes the names and constraints of the form, and also takes two functions:</p><div class="ulist"><ul><li><p>An <code>apply</code> function</p></li><li><p>An unapply function.</p></li></ul></div></li><li><p>Because <code>UserData</code> is a case class, we can plug its <code>apply</code> and <code>unapply</code> methods directly into the mapping method.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userForm = Form(
  mapping(
    "name" -&gt; text,
    "age"  -&gt; number
  )(UserData.apply)(UserData.unapply)
)</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Maximum number of fields for a single tuple or mapping is 22 due to the way
form handling is implemented. If you have more than 22 fields in your form, you should break down your forms using lists or nested values.</td></tr></table></div></div></section><section id="_testing_how_a_form_works"><h2>Testing how a <code>Form</code> works</h2><div class="slide-content"><div class="paragraph"><p>A form will create <code>UserData</code> instance with the bound values when given a Map:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val anyData  = Map("name" -&gt; "bob", "age" -&gt; "21")
val userData = userForm.bind(anyData).get</code></pre></div></div></div></section><section id="_running_in_an_action"><h2>Running in an <code>Action</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Most of the time you’ll use forms from within an <code>Action</code>, with data provided from the request</p></li><li><p><code>Form</code> contains <code>bindFromRequest</code>, which will take a <code>request</code> as an <code>implicit</code> parameter</p></li><li><p>If you define an <code>implicit</code> request, then <code>bindFromRequest</code> will find it</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userData = userForm.bindFromRequest.get</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><code>get</code> is dangerous, a better option is to use <code>fold</code>, which we will see soon</td></tr></table></div></div></section><section id="_case_class"><h2><code>case class</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>You are not limited to using <code>case class</code>es in your form mapping.</p></li><li><p>As long as the <code>apply</code> and <code>unapply</code> methods are properly mapped, you can pass in anything you like.</p></li><li><p>Such as tuples using the Forms.tuple mapping or model case classes</p></li></ul></div></div></section><section id="_advantages_to_case_classes"><h2>Advantages to <code>case classes</code></h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Form specific case classes are convenient</dt><dd><p>Case classes are designed to be simple containers of data, and provide out of the box features that are a natural match with Form functionality.</p></dd><dt class="hdlist1">Form specific case classes are powerful</dt><dd><p>Tuples are convenient to use, but do not allow for custom <code>apply</code> or <code>unapply</code> methods, and can only reference contained data by arity (<code>_1</code>, <code>_2</code>, etc.)</p></dd><dt class="hdlist1">Form specific case classes are targeted specifically to the <code>Form</code></dt><dd><p>Reusing model case classes can be convenient, but often models will contain additional domain logic and even persistence details that can lead to tight coupling. In addition, if there is not a direct <code>1:1</code> mapping between the form and the model, then sensitive fields must be explicitly ignored to prevent a parameter tampering attack.</p></dd></dl></div></div></section><section id="_defining_constraints"><h2>Defining Constraints</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userFormConstraints2 = Form(
  mapping(
    "name" -&gt; nonEmptyText,
    "age"  -&gt; number(min = 0, max = 100)
  )(UserData.apply)(UserData.unapply)
)</code></pre></div></div></div></section><section id="_where_to_find_more_constraints"><h2>Where to find more constraints</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The out of the box constraints are defined on the <a href="https://www.playframework.com/documentation/2.8.x/api/scala/play/api/data/Forms$.html" target="_blank">Forms object</a></dt><dd><div class="ulist"><ul><li><p><code>text</code>: maps to scala.String, optionally takes <code>minLength</code> and <code>maxLength</code></p></li><li><p><code>nonEmptyText</code>: maps to scala.String, optionally takes <code>minLength</code> and <code>maxLength</code></p></li><li><p><code>number</code>: maps to <code>scala.Int</code>, optionally takes <code>min</code>, <code>max</code>, and <code>strict</code></p></li><li><p><code>longNumber</code>: maps to scala.Long, optionally takes <code>min</code>, <code>max</code>, and <code>strict</code></p></li><li><p><code>bigDecimal</code>: takes <code>precision</code> and <code>scale</code></p></li><li><p><code>date</code>, <code>sqlDate</code>: maps to <code>java.util.Date</code>, <code>java.sql.Date</code>, optionally takes <code>pattern</code> and <code>timeZone</code></p></li><li><p><code>email</code>: maps to <code>scala.String</code>, using an email regular expression.</p></li><li><p><code>boolean</code>: maps to <code>scala.Boolean</code></p></li><li><p><code>checked</code>: maps to <code>scala.Boolean</code></p></li><li><p><code>optional</code>: maps to <code>scala.Option</code></p></li></ul></div></dd></dl></div></div></section><section id="_ad_hoc_constraints"><h2>Ad-hoc Constraints</h2><div class="slide-content"><div class="paragraph"><p>You can define your own ad-hoc constraints on the case classes using the <a href="https://www.playframework.com/documentation/2.8.x/api/scala/play/api/data/validation/index.html" target="_blank">validation package</a></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userFormConstraints = Form(
  mapping(
    "name" -&gt; text.verifying(nonEmpty),
    "age"  -&gt; number.verifying(min(0), max(100))
  )(UserData.apply)(UserData.unapply)
)</code></pre></div></div></div></section><section id="_validating_in_an_action"><h2>Validating in an <code>Action</code></h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">To process errors we can use the <code>fold</code> method which takes to functions</dt><dd><div class="olist arabic"><ol class="arabic"><li><p>Error binding function</p></li><li><p>Successful binding function</p></li></ol></div></dd></dl></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">userForm.bindFromRequest.fold(
  formWithErrors =&gt; {
    // binding failure, you retrieve the form containing errors:
    BadRequest(views.html.user(formWithErrors))
  },
  userData =&gt; {
    /* binding success, you get the actual value. */
    val newUser = models.User(userData.name, userData.age)
    val id      = models.User.create(newUser)
    Redirect(routes.Application.home(id))
  }
)</code></pre></div></div></div></section><section id="_return_responses"><h2>Return Responses</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the failure case, we render the page a <code>BadRequest</code>, and pass in the form with errors as a parameter to the page</p></li><li><p>If we use the view helpers, then any errors that are bound to a field will be rendered in the page next to the field</p></li><li><p>In the success case, we’re sending a <code>Redirect</code> with a route to <em>routes</em></p></li><li><p>We can then use a <em>reverse route</em>  instead of rendering a view template.</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Using <code>Redirect</code> after <code>POST</code> is <em>an excellent way</em> to prevent duplicate form submissions</td></tr></table></div></div></section><section id="_showing_forms_in_a_view_template"><h2>Showing forms in a view template</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once you have a form, then you need to make it available to the template engine</p></li><li><p>You do this by including the form as a parameter to the view template</p></li><li><p>For <em>user.scala.html</em> the header at the top of the page will look like this:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(userForm: Form[UserData])(implicit messages: Messages)</code></pre></div></div></li></ul></div></div></section><section id="_sending_objects_to_the_view_template"><h2>Sending objects to the view template</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Because <em>user.scala.html</em> needs a form passed in, you should pass the empty userForm initially when rendering your page</dt></dl></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action { implicit request =&gt;
  Ok(views.html.user(userForm))
}</code></pre></div></div></div></section><section id="_using_view_templates"><h2>Using View Templates</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can use helper templates to render the form as needed</p></li><li><p>You can include the <em>reverse route</em> in the <code>action</code>, so that you can change the url without having to edit all the forms</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.form(action = routes.Application.userPost) {
  @helper.inputText(userForm("name"))
  @helper.inputText(userForm("age"))
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">You can use <code>@import helper._</code> in the template to avoid prefixing helpers with <code>@helper</code></td></tr></table></div></div></section><section id="_view_template_helpers"><h2>View Template Helpers</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>form</code>: renders a form element</p></li><li><p><code>inputText</code>: renders a text input element</p></li><li><p><code>inputPassword</code>: renders a password input element</p></li><li><p><code>inputDate</code>: renders a date input element</p></li><li><p><code>inputFile</code>: renders a file input element</p></li><li><p><code>inputRadioGroup</code>: renders a radio input element</p></li><li><p><code>select</code>: renders a select element</p></li><li><p><code>textarea</code>: renders a textarea element</p></li><li><p><code>checkbox</code>: renders a checkbox element</p></li><li><p><code>input</code>: renders a generic input element (which requires explicit arguments)</p></li></ul></div>
<div class="paragraph"><p>See here for the <a href="https://github.com/playframework/playframework/tree/main/core/play/src/main/scala/views/helper" target="_blank">list of helpers</a></p></div></div></section><section id="_added_extra_parameters_to_form_helpers"><h2>Added extra parameters to form helpers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.inputText(userForm("name"), Symbol("id") -&gt; "name", Symbol("size") -&gt; 30)</code></pre></div></div></div></section><section id="_using_a_generic_input_to_code_the_desired_html"><h2>Using a generic input to code the desired HTML</h2><div class="slide-content"><div class="ulist"><ul><li><p>The generic input helper mentioned above will let you code the desired HTML result</p></li><li><p>All extra parameters will be added to the generated Html if they start with the <code>_</code> character</p></li><li><p>Arguments starting with <code>_</code> are reserved for field constructor arguments.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.input(userForm("name")) { (id, name, value, args) =&gt;
    &lt;input type="text" name="@name" id="@id" @toHtmlArgs(args)&gt;
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">You can also create <a href="https://www.playframework.com/documentation/2.8.x/ScalaCustomFieldConstructors" target="_blank">Custom Field Constructors</a></td></tr></table></div></div></section><section id="_mapping_with_tuples"><h2>Mapping with Tuples</h2><div class="slide-content"><div class="paragraph"><p>You can use tuples instead of case classes</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userFormTuple = Form(
  tuple(
    "name" -&gt; text,
    "age"  -&gt; number
  ) // tuples come with built-in apply/unapply</code></pre></div></div>
<div class="paragraph"><p>Using a tuple can be more convenient than defining a case class, especially for low arity tuples:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val anyData     = Map("name" -&gt; "bob", "age" -&gt; "25")
val (name, age) = userFormTuple.bind(anyData).get</code></pre></div></div></div></section><section id="_mapping_with_single"><h2>Mapping with Single</h2><div class="slide-content"><div class="ulist"><ul><li><p>Tuples are only possible when there are multiple values</p></li><li><p>If there is only one field in the form, use <code>Forms.single</code> to map to a single value without the overhead of a <code>case class</code> or tuple</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val singleForm = Form(
  single(
    "email" -&gt; email
  )
)

val emailValue = singleForm.bind(Map("email" -&gt; "bob@example.com")).get</code></pre></div></div></div></section><section id="_filling_in_the_form"><h2>Filling in the form</h2><div class="slide-content"><div class="paragraph"><p>If you need to fill in the form, before rendering you can do so with <code>fill</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val filledForm = userForm.fill(UserData("Bob", 18))</code></pre></div></div></div></section><section id="_filling_lists_or_maps"><h2>Filling Lists or Maps</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>fill</code> is especially helpful for helpers that need lists or maps of values</p></li><li><p>Such as the <code>select</code> and <code>inputRadioGroup</code> helpers</p></li><li><p>Use <code>options</code> to value these helpers with <code>lists</code>, <code>maps</code> and pairs</p></li></ul></div>
<div class="listingblock"><div class="title">Creating the form</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val addressSelectForm: Form[AddressData] = Form(
  mapping(
    "street" -&gt; text,
    "city"   -&gt; text
  )(AddressData.apply)(AddressData.unapply)
)</code></pre></div></div>
<div class="listingblock"><div class="title">Filling in the default values</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val selectedFormValues = AddressData(street = "Main St", city = "London")
val filledForm         = addressSelectForm.fill(selectedFormValues)</code></pre></div></div></div></section><section id="_using_the_filled_in_list_in_your_template"><h2>Using the filled-in list in your template</h2><div class="slide-content"><div class="listingblock"><div class="title">Using list of pairs</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(
addressData: Form[AddressData],
cityOptions: List[(String, String)] = List("New York" -&gt; "U.S. Office", "London" -&gt; "U.K. Office", "Brussels" -&gt; "E.U. Office")
)(implicit messages: Messages)</code></pre></div></div>
<div class="ulist"><ul><li><p>Since <code>London</code> is the pre-filled in choice, that will be the one that gets displayed</p></li><li><p><code>Main St</code> will also be the default street</p></li></ul></div>
<div class="listingblock"><div class="title">Displaying the values automatically</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.select(addressData("city"), options = cityOptions)
@helper.inputText(addressData("street"))</code></pre></div></div></div></section><section id="_nested_values"><h2>Nested Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>A form mapping can define nested values by using <code>Forms.mapping</code> inside an existing mapping:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class AddressData(street: String, city: String)
case class UserAddressData(name: String, address: AddressData)</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userFormNested: Form[UserAddressData] = Form(
  mapping(
    "name" -&gt; text,
    "address" -&gt; mapping(
      "street" -&gt; text,
      "city"   -&gt; text
    )(AddressData.apply)(AddressData.unapply)
  )(UserAddressData.apply)(UserAddressData.unapply)
)</code></pre></div></div></div></section><section id="_using_nested_forms_in_your_view"><h2>Using Nested Forms in your view</h2><div class="slide-content"><div class="ulist"><ul><li><p>When you are using nested data this way, the form values sent by the browser must be named like:</p><div class="ulist"><ul><li><p><code>address.street</code></p></li><li><p><code>address.city</code>, etc.</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.inputText(userFormNested("name"))
@helper.inputText(userFormNested("address.street"))
@helper.inputText(userFormNested("address.city"))</code></pre></div></div></div></section><section id="_repeated_values"><h2>Repeated Values</h2><div class="slide-content"><div class="paragraph"><p>A form mapping can define repeated values using <code>Forms.list</code> or <code>Forms.seq</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class UserListData(name: String, emails: List[String])</code></pre></div></div>
<div class="paragraph"><p>Notice the emails are now in the form as a <code>list</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userFormRepeated = Form(
  mapping(
    "name"   -&gt; text,
    "emails" -&gt; list(email)
  )(UserListData.apply)(UserListData.unapply)
)</code></pre></div></div></div></section><section id="_processing_repeated_values"><h2>Processing Repeated Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>When you are using repeated data like this, there are two alternatives for sending the form values in the HTTP request.</p></li><li><p>First Choice:</p><div class="ulist"><ul><li><p>Suffix the parameter with an empty bracket pair, as in “emails[]”.</p></li><li><p>This parameter can then be repeated in the standard way, as in <a href="http://foo.com/request?emails" class="bare">http://foo.com/request?emails</a>=<a href="mailto:a@b.com">a@b.com</a>&amp;emails[]=<a href="mailto:c@d.com">c@d.com</a>.</p></li></ul></div></li><li><p>Second Choice:</p><div class="ulist"><ul><li><p>The client can explicitly name the parameters uniquely with array subscripts, as in <code>emails[0]</code>, <code>emails[1]</code>, <code>emails[2]</code>, and so on.</p></li><li><p>This approach also allows you to maintain the order of a sequence of inputs.</p></li></ul></div></li></ul></div></div></section><section id="_using_repeated_values_in_the_form"><h2>Using Repeated Values in the Form</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you are using Play to generate your form HTML, you can generate as many inputs for the emails field as the form contains, using the <code>repeat</code> helper:</p></li><li><p>The <code>min</code> parameter allows you to display a minimum number of fields even if the corresponding form data are empty.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.inputText(myForm("name"))
@helper.repeat(myForm("emails"), min = 1) { emailField =&gt;
    @helper.inputText(emailField)
}</code></pre></div></div>
<div class="ulist"><ul><li><p>If you want to access the index of the fields you can use the repeatWithIndex helper instead:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.repeatWithIndex(myForm("emails"), min = 1) { (emailField, index) =&gt;
    @helper.inputText(emailField, Symbol("_label") -&gt; ("email #" + index))
}</code></pre></div></div></div></section><section id="_optional_values"><h2>Optional values</h2><div class="slide-content"><div class="ulist"><ul><li><p>A form mapping can also define optional values using <code>Forms.optional</code>:</p></li><li><p>This maps to an Option[A] in output, which is None if no form value is found.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class UserOptionalData(name: String, email: Option[String])
val userFormOptional = Form(
  mapping(
    "name"  -&gt; text,
    "email" -&gt; optional(email)
  )(UserOptionalData.apply)(UserOptionalData.unapply)
)</code></pre></div></div></div></section><section id="_default_values"><h2>Default Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can populate a form with initial values using <code>Form#fill</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val filledForm = userForm.fill(UserData("Bob", 18))</code></pre></div></div>
<div class="ulist"><ul><li><p>Or you can define a default mapping on the number using <code>Forms.default</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Form(
  mapping(
    "name" -&gt; default(text, "Bob"),
    "age"  -&gt; default(number, 18)
  )(UserData.apply)(UserData.unapply)
)</code></pre></div></div></div></section><section id="_default_value_caveats"><h2>Default Value Caveats</h2><div class="slide-content"><div class="ulist"><ul><li><p>Keep in mind that default values are used only when</p><div class="olist arabic"><ol class="arabic"><li><p>Populating the Form from data, for example, from the request</p></li><li><p>And there is no corresponding data for the field</p></li></ol></div></li><li><p>The default value is not used when creating the form</p></li></ul></div></div></section><section id="_ignored_values"><h2>Ignored Values</h2><div class="slide-content"><div class="paragraph"><p>If you want a form to have a static value for a field, use <code>Forms.ignored</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val userFormStatic = Form(
  mapping(
    "id"    -&gt; ignored(23L),
    "name"  -&gt; text,
    "email" -&gt; optional(email)
  )(UserStaticData.apply)(UserStaticData.unapply)
)</code></pre></div></div></div></section></section>
<section><section id="_logging"><h2>Logging</h2></section><section id="_the_logging_api"><h2>The Logging API</h2><div class="slide-content"><div class="ulist"><ul><li><p>Using logging in your application can be useful for monitoring, debugging, error tracking, and business intelligence</p></li><li><p>Play provides an API for logging which is accessed through the <code>Logger</code> object and uses <code>Logback</code> as the default logging engine</p></li></ul></div></div></section><section id="_using_logging"><h2>Using Logging</h2><div class="slide-content"><div class="ulist"><ul><li><p>Your application can define <code>Logger</code> instances to send log message requests</p></li><li><p>Each <code>Logger</code> has a name which will appear in log messages and is used for configuration</p></li><li><p>The Logger API is based on SLF4J, and so Logger is based on the <code>org.slf4j.Logger</code> interface</p></li></ul></div></div></section><section id="_logger_naming"><h2>Logger Naming</h2><div class="slide-content"><div class="ulist"><ul><li><p>Loggers follow a hierarchical inheritance structure based on their naming</p></li><li><p>A logger is said to be an ancestor of another logger if its name followed by a dot is the prefix of descendant logger name</p></li><li><p>For example, a logger named <code>com.foo</code> is the ancestor of a logger named <code>com.foo.bar.Baz</code></p></li><li><p>All loggers inherit from a root logger</p></li><li><p>Logger inheritance allows you to configure a set of loggers by configuring a common ancestor</p></li></ul></div></div></section><section id="_separate_naming_for_each_class"><h2>Separate naming for each class</h2><div class="slide-content"><div class="ulist"><ul><li><p>Create separately-named loggers for each class</p></li><li><p>Following this convention, the Play libraries use loggers namespaced under “play”</p></li><li><p>Many third party libraries will have loggers based on their class names</p></li></ul></div></div></section><section id="_setting_of_log_levels"><h2>Setting of Log Levels</h2><div class="slide-content"><div class="ulist"><ul><li><p>Log levels are used to classify the severity of log messages</p></li><li><p>When you write a log request statement you will specify the severity and this will appear in generated log messages</p></li></ul></div></div></section><section id="_log_levels"><h2>Log Levels</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Level</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>OFF</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Used to turn off logging, not as a message classification.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>ERROR</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Runtime errors, or unexpected conditions.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>WARN</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Use of deprecated APIs, poor use of API, ‘almost’ errors, other runtime situations that are undesirable or unexpected, but not necessarily “wrong”.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>INFO</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Interesting runtime events such as application startup and shutdown.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Detailed information on the flow through the system.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRACE</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Most detailed information.</p></div></div></td></tr></table>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">A <code>Logger</code> set to level <code>INFO</code> will log any request of level <code>INFO</code> or higher (<code>INFO</code>, <code>WARN</code>, <code>ERROR</code>) but will ignore requests of lower severities (<code>DEBUG, TRACE</code>). Using <code>OFF</code> will ignore all log requests</td></tr></table></div></div></section><section id="_appenders"><h2>Appenders</h2><div class="slide-content"><div class="ulist"><ul><li><p>The logging API allows logging requests to print to one or many output destinations called “appenders”</p></li><li><p>Appenders are specified in configuration and options exist for the console, files, databases, and other outputs</p></li><li><p>Appenders combined with loggers can help you route and filter log messages</p></li><li><p>For example, you could use one appender for a logger that logs useful data for analytics and another appender for errors that is monitored by an operations team</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">For further information on architecture, see the <a href="http://logback.qos.ch/manual/architecture.html" target="_blank">Logback documentation</a></td></tr></table></div></div></section><section id="_using_the_logger_in_play"><h2>Using the <code>Logger</code> in Play</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can create a new logger using the <code>Logger.apply</code> factory method with a name argument</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val accessLogger: Logger = Logger("access")</code></pre></div></div>
<div class="ulist"><ul><li><p>A common strategy for logging application events is to use a distinct logger per class using the class name.</p></li><li><p>The logging API supports this with a factory method that takes a class argument</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val logger: Logger = Logger(this.getClass())</code></pre></div></div></div></section><section id="_logger_trait"><h2><code>Logger</code> trait</h2><div class="slide-content"><div class="paragraph"><p>There is also a <code>Logging</code> trait that does this for you automatically and exposes a <code>protected val logger</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.Logging

class MyClassWithLogging extends Logging {
  logger.info("Using the trait")
}</code></pre></div></div></div></section><section id="_more_advanced_logging_techniques_available"><h2>More advanced logging techniques available</h2><div class="slide-content"><div class="paragraph"><p>Other advanced techniques like markers and contexts are available on the <a href="https://www.playframework.com/documentation/2.8.x/ScalaLogging" target="_blank">Play Website</a></p></div></div></section></section>
<section><section id="_configuration"><h2>Configuration</h2></section><section id="_the_scala_configuration_api"><h2>The Scala Configuration API</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play uses the <a href="https://github.com/typesafehub/config">Typesafe config library</a></p></li><li><p>Play also provides a nice Scala wrapper called <code>Configuration</code> with more advanced Scala features.</p></li></ul></div></div></section><section id="_accessing_the_configuration"><h2>Accessing the configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Typically, you’ll obtain a <code>Configuration</code> object through Dependency Injection, or simply by passing an instance of <code>Configuration</code> to your component</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">class MyController @Inject() (config: Configuration, c: ControllerComponents) extends AbstractController(c) {
  def getFoo = Action {
    Ok(config.get[String]("foo"))
  }
}</code></pre></div></div></div></section><section id="_using_the_configuration"><h2>Using the Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>get</code> method is the most common one you’ll use.</p></li><li><p>This is used to get a single value at a path in the configuration file.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">// foo = bar
config.get[String]("foo")

// bar = 8
config.get[Int]("bar")

// baz = true
config.get[Boolean]("baz")

// listOfFoos = ["bar", "baz"]
config.get[Seq[String]]("listOfFoos")</code></pre></div></div></div></section><section id="_implicit_loading"><h2>Implicit Loading</h2><div class="slide-content"><div class="ulist"><ul><li><p>It accepts an implicit <code>ConfigLoader</code>, but for most common types like <code>String</code>, <code>Int</code>, and even <code>Seq[String]</code></p></li><li><p>There are <a href="api/scala/play/api/ConfigLoader$.html">already loaders defined</a> that do what you’d expect.</p></li><li><p><code>Configuration</code> also supports validating against a set of valid values:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">config.getAndValidate[String]("foo", Set("bar", "baz"))</code></pre></div></div></div></section><section id="_configloader"><h2><code>ConfigLoader</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>By defining your own <code>ConfigLoader</code>, you can easily convert configuration into a custom type.</p></li><li><p>This is used extensively in Play internally, and is a great way to bring more type safety to your use of configuration.</p></li><li><p>For example:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class AppConfig(title: String, baseUri: URI)
object AppConfig {
  implicit val configLoader: ConfigLoader[AppConfig] = new ConfigLoader[AppConfig] {
    def load(rootConfig: Config, path: String): AppConfig = {
      val config = rootConfig.getConfig(path)
      AppConfig(
        title = config.getString("title"),
        baseUri = new URI(config.getString("baseUri"))
      )
    }
  }
}</code></pre></div></div></div></section><section id="_loading_the_configuration"><h2>Loading the configuration</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-hocon hljs" data-noescape="true" data-lang="hocon">app.config = {
  title = "My App
  baseUri = "https://example.com/"
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">config.get[AppConfig]("app.config")</code></pre></div></div></div></section><section id="_optional_configuration_keys"><h2>Optional configuration keys</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play’s <code>Configuration</code> supports getting optional configuration keys using the <code>getOptional[A]</code> method</p></li><li><p>It works just like <code>get[A]</code> but will return <code>None</code> if the key does not exist</p></li><li><p>Instead of using this method, we recommend setting optional keys to <code>null</code> in your configuration file and using <code>get[Option[A]]</code></p></li><li><p>But we provide this method for convenience in case you need to interface with libraries that use configuration in a non-standard way.</p></li></ul></div></div></section></section>
<section><section id="_actions_controllers_and_results"><h2>Actions, Controllers, and Results</h2></section><section id="_what_is_an_action"><h2>What is an <code>Action</code>?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Most of the requests received by a Play application are handled by an <code>Action</code></p></li><li><p>A <code>play.api.mvc.Action</code> is basically a <code>(play.api.mvc.Request &#8658; play.api.mvc.Result)</code> function that handles a request and generates a result to be sent to the client</p></li><li><p>An action returns a <code>play.api.mvc.Result</code> value, representing the HTTP response to send to the web client.</p></li><li><p>In this example <code>Ok</code> constructs a <strong>200 OK</strong> response containing a <strong>text/plain</strong> response body</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def echo = Action { request =&gt;
  Ok("Got request [" + request + "]")
}</code></pre></div></div></div></section><section id="_building_an_action"><h2>Building an <code>Action</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Within any controller extending <code>BaseController</code>, the <code>Action</code> value is the default action builder.</p></li><li><p>This action builder contains several helpers for creating <code>Action</code>s</p></li><li><p>The first simplest one just takes as argument an expression block returning a <code>Result</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Action {
  Ok("Hello world")
}</code></pre></div></div></div></section><section id="_retrieving_the_request"><h2>Retrieving the <code>Request</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>It is often useful to access the HTTP request calling this Action</p></li><li><p>So there is another Action builder that takes as an argument a function <code>Request &#8658; Result</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Action { request =&gt;
  Ok("Got request [" + request + "]")
}</code></pre></div></div></div></section><section id="_marking_the_request_as_implicit"><h2>Marking the <code>Request</code> as <code>implicit</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>It is often useful to mark the <code>request</code> parameter as <code>implicit</code> so it can be implicitly used by other APIs that need it</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Action { implicit request =&gt;
  Ok("Got request [" + request + "]")
}</code></pre></div></div></div></section><section id="_passing_the_implicit_request"><h2>Passing the <code>implicit</code> request</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you have broken up your code into methods, then you can pass through the implicit request from the action</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def action = Action { implicit request =&gt;
  anotherMethod("Some para value")
  Ok("Got request [" + request + "]")
}

def anotherMethod(p: String)(implicit request: Request[_]) = {
  // do something that needs access to the request
}</code></pre></div></div></div></section><section id="_using_a_bodyparser"><h2>Using a <code>BodyParser</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>The last way of creating an <code>Action</code> value is to specify an additional <code>BodyParser</code> argument</p></li><li><p>For now you just need to know that the other methods of creating Action values use a default <strong>Any content body parser</strong></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Action(parse.json) { implicit request =&gt;
  Ok("Got request [" + request + "]")
}</code></pre></div></div></div></section><section id="_controllers_are_action_generators"><h2>Controllers are <code>Action</code> generators</h2><div class="slide-content"><div class="ulist"><ul><li><p>A controller in Play is nothing more than an object that generates <code>Action</code> values.</p></li><li><p>Controllers are typically defined as classes to take advantage of Dependency Injection</p></li><li><p>Using classes is the recommended approach</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">package controllers

  import javax.inject.Inject

  import play.api.mvc._

  class Application @Inject() (cc: ControllerComponents) extends AbstractController(cc) {
    def index = Action {
      Ok("It works!")
    }
  }</code></pre></div></div></div></section><section id="_an_action_with_a_parameter"><h2>An <code>Action</code> with a parameter</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def hello(name: String) = Action {
  Ok("Hello " + name)
}</code></pre></div></div></div></section><section id="_hand_coded_results"><h2>Hand-coded results</h2><div class="slide-content"><div class="ulist"><ul><li><p>For now we are just interested in simple results: an HTTP result with a status code, a set of HTTP headers and a body to be sent to the web client</p></li><li><p>These results are defined by <code>play.api.mvc.Result</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.http.HttpEntity

def index = Action {
  Result(
    header = ResponseHeader(200, Map.empty),
    body = HttpEntity.Strict(ByteString("Hello world!"), Some("text/plain"))
  )
}</code></pre></div></div></div></section><section id="_simplifying_results"><h2>Simplifying Results</h2><div class="slide-content"><div class="paragraph"><p>Of course there are several helpers available to create common results such as the <code>Ok</code> result in the sample above</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action {
  Ok("Hello world!")
}</code></pre></div></div></div></section><section id="_other_results"><h2>Other <code>Result</code>s</h2><div class="slide-content"><div class="ulist"><ul><li><p>Here are several examples to create various results</p></li><li><p>All of these helpers can be found in the <code>play.api.mvc.Results</code> trait and companion object</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val ok           = Ok("Hello world!")
val notFound     = NotFound
val pageNotFound = NotFound(&lt;h1&gt;Page not found&lt;/h1&gt;)
val badRequest   = BadRequest(views.html.form(formWithErrors))
val oops         = InternalServerError("Oops")
val anyStatus    = Status(488)("Strange response type")</code></pre></div></div></div></section><section id="_redirects_are_simple_results_too"><h2><code>Redirect</code>s are simple results too</h2><div class="slide-content"><div class="ulist"><ul><li><p>Redirecting the browser to a new URL is just another kind of simple result</p></li><li><p>However, these result types don’t take a response body</p></li><li><p>There are several helpers available to create redirect results</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action {
  Redirect("/user/home")
}</code></pre></div></div></div></section><section id="_specific_redirects"><h2>Specific <code>Redirect</code>s</h2><div class="slide-content"><div class="ulist"><ul><li><p>The default is to use a <code>303 SEE_OTHER</code> response type</p></li><li><p>You can also set a more specific status code if you need one</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action {
  Redirect("/user/home", MOVED_PERMANENTLY)
}</code></pre></div></div></div></section><section id="_todo_dummy_page"><h2><code>TODO</code> dummy page</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can use an empty <code>Action</code> implementation defined as <code>TODO</code></p></li><li><p>The result is a standard ‘Not implemented yet’ result page</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index(name: String) = TODO</code></pre></div></div></div></section></section>
<section id="_lab_running_a_basic_form"><h2>Lab: Running a Basic Form</h2></section>
<section><section id="_internationalization"><h2>Internationalization</h2></section><section id="_specifying_languages_supported_by_your_application"><h2>Specifying languages supported by your application</h2><div class="slide-content"><div class="ulist"><ul><li><p>You specify languages for your application using language tags, specially formatted strings that identify a specific language</p></li><li><p>Language tags can specify</p><div class="ulist"><ul><li><p>Simple languages, such as “en” for English,</p></li><li><p>A specific regional dialect of a language (such as “en-AU” for English as used in Australia),</p></li><li><p>A language and a script (such as “az-Latn” for Azerbaijani written in Latin script),</p></li><li><p>A combination of several of these (such as “zh-cmn-Hans-CN” for Chinese, Mandarin, Simplified script, as used in China)</p></li></ul></div></li></ul></div></div></section><section id="_setting_up_i18n"><h2>Setting up I18N</h2><div class="slide-content"><div class="ulist"><ul><li><p>To start you need to specify the languages supported by your application in the <code>conf/application.conf</code> file:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.i18n.langs = [ "en", "en-US", "fr" ]</code></pre></div></div></li><li><p>These language tags will be used to create <code>play.api.i18n.Lang</code> instances</p></li></ul></div></div></section><section id="_accessing_the_languages"><h2>Accessing the languages</h2><div class="slide-content"><div class="ulist"><ul><li><p>To access the languages supported by your application, you can inject a <code>play.api.i18n.Langs</code> component into your class:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject

import play.api.i18n.Lang
import play.api.i18n.Langs
import play.api.mvc.BaseController
import play.api.mvc.ControllerComponents

class ScalaI18nService @Inject() (langs: Langs) {
  val availableLangs: Seq[Lang] = langs.availables
}</code></pre></div></div></li></ul></div></div></section><section id="_converting_a_lang_to_locale"><h2>Converting a <code>Lang</code> to <code>Locale</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>An individual <code>play.api.i18n.Lang</code> can be converted to a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html"><code>java.util.Locale</code></a> object by using <code>lang.toLocale</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val locale: java.util.Locale = lang.toLocale</code></pre></div></div></div></section><section id="_externalizing_messages"><h2>Externalizing messages</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can externalize messages in the <code>conf/messages.xxx</code> files</p></li><li><p>The default <code>conf/messages</code> file matches all languages</p></li><li><p>Additionally you can specify language-specific message files such as <code>conf/messages.fr</code> or <code>conf/messages.en-US</code></p></li><li><p>Messages are available through the <code>MessagesApi</code> instance, which can be added via injection</p></li><li><p>You can then retrieve messages using the <code>play.api.i18n.MessagesApi</code> object:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.i18n.MessagesApi

class MyService @Inject() (langs: Langs, messagesApi: MessagesApi) {
  val lang: Lang = langs.availables.head

  val title: String = messagesApi("home.title")(lang)
}</code></pre></div></div></li></ul></div></div></section><section id="_making_language_implicit"><h2>Making language <code>implicit</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also make the language implicit rather than declare it:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">class MyOtherService @Inject() (langs: Langs, messagesApi: MessagesApi) {
  implicit val lang: Lang = langs.availables.head

  lazy val title: String = messagesApi("home.title")
}</code></pre></div></div></li></ul></div></div></section><section id="_predefined_messages"><h2>Predefined Messages</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play provides predefined messages for forms validation</p></li><li><p>You can overwrite these messages either with the default message file or any language-specific message file</p></li></ul></div></div></section><section id="_default_predefined_messages"><h2>Default Predefined Messages</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala"># --- Constraints
constraint.required=Required
constraint.min=Minimum value: {0}
constraint.max=Maximum value: {0}
constraint.minLength=Minimum length: {0}
constraint.maxLength=Maximum length: {0}
constraint.email=Email
constraint.pattern=Required pattern: {0}

# --- Formats
format.date=Date (''{0}'')
format.numeric=Numeric
format.real=Real
format.uuid=UUID

# --- Patterns for Formats
formats.date=yyyy-MM-dd

# --- Errors
error.invalid=Invalid value
error.invalid.java.util.Date=Invalid date value
error.required=This field is required
error.number=Numeric value expected
error.real=Real number value expected
error.real.precision=Real number value with no more than {0} digit(s) including {1} decimal(s) expected
error.min=Must be greater or equal to {0}
error.min.strict=Must be strictly greater than {0}
error.max=Must be less or equal to {0}
error.max.strict=Must be strictly less than {0}
error.minLength=Minimum length is {0}
error.maxLength=Maximum length is {0}
error.email=Valid email required
error.pattern=Must satisfy {0}
error.date=Valid date required
error.uuid=Valid UUID required

error.expected.date=Date value expected
error.expected.date.isoformat=Iso date value expected
error.expected.time=Time value expected
error.expected.jsarray=Array value expected
error.expected.jsboolean=Boolean value expected
error.expected.jsnumber=Number value expected
error.expected.jsobject=Object value expected
error.expected.jsstring=String value expected
error.expected.jsnumberorjsstring=String or number expected
error.expected.keypathnode=Node value expected
error.expected.uuid=UUID value expected
error.expected.validenumvalue=Valid enumeration value expected
error.expected.enumstring=String value expected

error.path.empty=Empty path
error.path.missing=Missing path
error.path.result.multiple=Multiple results for the given path</code></pre></div></div></div></section><section id="_using_messages_and_messagesprovider"><h2>Using <code>Messages</code> and <code>MessagesProvider</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Because it’s common to want to use messages without having to provide an argument, you can wrap a given <code>Lang</code> together with the <code>MessagesApi</code> to create a <code>play.api.i18n.Messages</code> instance</p></li><li><p>The <code>play.api.i18n.MessagesImpl</code> case class implements the <code>Messages</code> trait if you want to create one directly</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val messages: Messages = MessagesImpl(lang, messagesApi)
val title: String      = messages("home.title")</code></pre></div></div></li></ul></div></div></section><section id="_using_a_singleton_for_both_languages_and_messages"><h2>Using a <code>Singleton</code> for both languages and Messages</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also use Singleton object methods with an implicit <code>play.api.i18n.MessagesProvider</code>:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">implicit val messagesProvider: MessagesProvider = {
  MessagesImpl(lang, messagesApi)
}
// uses implicit messages
val title2 = Messages("home.title")</code></pre></div></div></li></ul></div></div></section><section id="_summoning_the_messagesprovider"><h2>Summoning the <code>MessagesProvider</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>A <code>play.api.i18n.MessagesProvider</code> is a trait that can provide a <code>Messages</code> object on demand</p></li><li><p>An instance of <code>Messages</code> extends <code>MessagesProvider</code> and returns itself</p></li><li><p><code>MessagesProvider</code> is most useful when extended by something that is not a <code>Messages</code>:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">implicit val customMessagesProvider: MessagesProvider = new MessagesProvider {
  // resolve messages at runtime
  override def messages: Messages = { ..
* }
}
// uses implicit messages
val title3: String = Messages("home.title")</code></pre></div></div></li></ul></div></div></section><section id="_using_messages_with_controllers"><h2>Using <code>Messages</code> with Controllers</h2><div class="slide-content"><div class="paragraph"><p>You can add <code>Messages</code> support to your request by extending <code>MessagesAbstractController</code> or <code>MessagesBaseController</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject
import play.api.i18n._

class MyMessagesController @Inject() (mcc: MessagesControllerComponents) extends MessagesAbstractController(mcc) {
  def index = Action { implicit request: MessagesRequest[AnyContent] =&gt;
    val messages: Messages = request.messages
    val message: String    = messages("info.error")
    Ok(message)
  }

  def messages2 = Action { implicit request: MessagesRequest[AnyContent] =&gt;
    val lang: Lang      = request.messages.lang
    val message: String = messagesApi("info.error")(lang)
    Ok(message)
  }

  def messages4 = Action { implicit request: MessagesRequest[AnyContent] =&gt;
    // MessagesRequest is an implicit MessagesProvider
    Ok(views.html.formpage())
  }
}</code></pre></div></div></div></section><section id="_adding_i18nsupport_trait"><h2>Adding <code>I18nSupport</code> trait</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also addthe <code>play.api.i18n.I18nSupport</code>] trait to your controller</p></li><li><p>Ensuring an instance of <code>MessagesApi</code> is in scope, which will use <code>implicit</code>s to convert a request</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject
import play.api.i18n._

class MySupportController @Inject() (val controllerComponents: ControllerComponents)
    extends BaseController
    with I18nSupport {
  def index = Action { implicit request =&gt;
    // type enrichment through I18nSupport
    val messages: Messages = request.messages
    val message: String    = messages("info.error")
    Ok(message)
  }

  def messages2 = Action { implicit request =&gt;
    // type enrichment through I18nSupport
    val lang: Lang      = request.lang
    val message: String = messagesApi("info.error")(lang)
    Ok(message)
  }

  def messages3 = Action { request =&gt;
    // direct access with no implicits required
    val messages: Messages = messagesApi.preferred(request)
    val lang               = messages.lang
    val message: String    = messages("info.error")
    Ok(message)
  }

  def messages4 = Action { implicit request =&gt;
    // takes implicit Messages, converted using request2messages
    // template defined with @()(implicit messages: Messages)
    Ok(views.html.formpage())
  }
}</code></pre></div></div></div></section><section id="_message_provider_in_templates"><h2>Message Provider in Templates</h2><div class="slide-content"><div class="ulist"><ul><li><p>All the form helpers in Twirl templates take <code>MessagesProvider</code></p></li><li><p>It is assumed that a <code>MessagesProvider</code> is passed into the template as an implicit parameter when processing a form</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@(form: Form[Foo])(implicit messages: MessagesProvider)

@helper.inputText(field = form("name")) @* &lt;- takes MessagesProvider *@</code></pre></div></div></div></section><section id="_retrieving_supported_language_from_an_http_request"><h2>Retrieving supported language from an HTTP request</h2><div class="slide-content"><div class="paragraph"><p>You can retrieve the languages supported by a specific HTTP request:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action { request =&gt;
  Ok("Languages: " + request.acceptLanguages.map(_.code).mkString(", "))
}</code></pre></div></div></div></section><section id="_request_types"><h2>Request Types</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>I18nSupport</code> trait adds the following methods to a <code>Request</code></p><div class="ulist"><ul><li><p><code>request.messages</code> returns an instance of <code>Messages</code>, using an implicit <code>MessagesApi</code></p></li><li><p><code>request.lang</code> returns the preferred <code>Lang</code>, using an implicit <code>MessagesApi</code></p></li></ul></div></li><li><p>The preferred language is extracted from the <code>Accept-Language</code> header (and optionally the language cookie) and matching one of the <code>MessagesApi</code> supported languages using <code>messagesApi.preferred</code></p></li></ul></div></div></section><section id="_language_cookie_support"><h2>Language Cookie Support</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>I18nSupport</code> also adds two convenient methods to <code>Result</code>:</p><div class="ulist"><ul><li><p><code>result.withLang(lang: Lang)</code> is used to set the language using Play’s language cookie</p></li><li><p><code>result.withoutLang</code> is used to clear the language cookie</p></li></ul></div></li></ul></div></div></section><section id="_redirect_with_cookies"><h2>Redirect with Cookies</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>withLang</code> method sets the cookie named <code>PLAY_LANG</code> for future requests</p></li><li><p>While <code>withoutLang</code> discards the cookie, and Play will choose the language based on the client’s <code>Accept-Language</code> header</p></li><li><p>The cookie name can be changed by changing the configuration parameter: <code>play.i18n.langCookieName</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def homePageInFrench = Action {
  Redirect("/user/home").withLang(Lang("fr"))
}

def homePageWithDefaultLang = Action {
  Redirect("/user/home").withoutLang
}</code></pre></div></div></div></section><section id="_implicit_lang_conversion"><h2>Implicit Lang Conversion</h2><div class="slide-content"><div class="paragraph"><p>The <code>LangImplicits</code> trait can be declared on a controller to implicitly convert a request to a <code>Messages</code> given an implicit <code>Lang</code> instance</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.i18n.LangImplicits

class MyClass @Inject() (val messagesApi: MessagesApi) extends LangImplicits {
  def convertToMessage: Unit = {
    implicit val lang      = Lang("en")
    val messages: Messages = lang2Messages // implicit conversion
  }
}</code></pre></div></div></div></section><section id="_messages_format"><h2>Messages format</h2><div class="slide-content"><div class="ulist"><ul><li><p>Messages are formatted using the <code>java.text.MessageFormat</code> library</p></li><li><p>For example, assuming you have message defined like:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">files.summary=The disk {1} contains {0} file(s)</code></pre></div></div></li><li><p>You can then specify parameters as:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Messages("files.summary", d.files.length, d.name)</code></pre></div></div></li></ul></div></div></section><section id="_notes_on_apostrophes"><h2>Notes on apostrophes</h2><div class="slide-content"><div class="ulist"><ul><li><p>Since Messages uses <code>java.text.MessageFormat</code>, please be aware that single quotes are used as a meta-character for escaping parameter substitutions</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">info.error=You aren''t logged in!</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">example.formatting=
  When using MessageFormat, '''{0}''' is replaced with the first parameter</code></pre></div></div></li><li><p>You should expect the following results:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">messagesApi("info.error") == "You aren't logged in!"</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">messagesApi("example.formatting") ==
  "When using MessageFormat, '{0}' is replaced with the first parameter."</code></pre></div></div></li></ul></div></div></section><section id="_explicit_messagesapi"><h2>Explicit MessagesApi</h2><div class="slide-content"><div class="ulist"><ul><li><p>The default implementation of <code>MessagesApi</code>] is <code>DefaultMessagesApi</code></p></li><li><p>You can see unit testing and functional testing examples in the testing section of the documentation</p></li><li><p>You can also use <code>Helpers.stubMessagesApi()</code> in testing to provide a premade empty <code>MessagesApi</code></p></li></ul></div></div></section></section>
<section><section id="_flash_scope"><h2>Flash Scope</h2></section><section id="_flash_scope_2"><h2>Flash scope</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Flash scope works exactly like the Session, but with one difference</p></li><li><p>Data are kept for only one request</p></li><li><p>The Flash scope should only be used to transport success/error messages on simple non-Ajax applications</p></li><li><p>As the data are just kept for the next request and because there are no guarantees to ensure the request order in a complex Web application, the Flash scope is subject to race conditions</p></li></ul></div></div></section><section id="_flash_example"><h2>Flash Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action { implicit request =&gt;
  Ok {
    request.flash.get("success").getOrElse("Welcome!")
  }
}

def save = Action {
  Redirect("/home").flashing("success" -&gt; "The item has been created")
}</code></pre></div></div></div></section><section id="_retrieving_the_flash_scope"><h2>Retrieving the <code>Flash</code> scope</h2><div class="slide-content"><div class="paragraph"><p>To retrieve the Flash scope value in your view, add an <code>implicit</code> Flash parameter</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@()(implicit flash: Flash)
...
@flash.get("success").getOrElse("Welcome!")
...</code></pre></div></div></div></section><section id="_adding_the_flash_in_the_action"><h2>Adding the <code>Flash</code> in the <code>Action</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Specify an <code>implicit request &#8658;</code> as shown</p></li><li><p>An implicit Flash will be provided to the view based on the implicit request</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action { implicit request =&gt;
  Ok(views.html.index())
}</code></pre></div></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">If the error ‘could not find implicit value for parameter flash: play.api.mvc.Flash’ is raised then this is because your <code>Action</code> didn’t have an <code>implicit</code> request in scope</td></tr></table></div></div></section></section>
<section><section id="_errors"><h2>Errors</h2></section><section id="_displaying_error_in_a_view_template"><h2>Displaying Error in a view template</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The errors in a form take the form of <code>Map[String,FormError]</code> where FormError has</dt><dd><div class="ulist"><ul><li><p><code>key</code>: should be the same as the field</p></li><li><p><code>message</code>: a message or a message key</p></li><li><p><code>args</code>: a list of arguments to the message</p></li></ul></div></dd></dl></div></div></section><section id="_form_errors_bindings_for_your_page"><h2>Form errors bindings for your page</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The form errors are accessed on the bound form instance as follows</dt><dd><div class="ulist"><ul><li><p><code>errors</code>: returns all errors as <code>Seq[FormError]</code></p></li><li><p><code>globalErrors</code>: returns errors without a key as <code>Seq[FormError]</code></p></li><li><p><code>error("name")</code>: returns the first error bound to key as <code>Option[FormError]</code></p></li><li><p><code>errors("name")</code>: returns all errors bound to key as <code>Seq[FormError]</code></p></li></ul></div></dd></dl></div></div></section><section id="_rendering_form_errors"><h2>Rendering Form Errors</h2><div class="slide-content"><div class="ulist"><ul><li><p>Errors attached to a field will render automatically using the form helpers</p></li><li><p><code>@helper.inputText</code> with errors can display as follows:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;dl class="error" id="age_field"&gt;
    &lt;dt&gt;&lt;label for="age"&gt;Age:&lt;/label&gt;&lt;/dt&gt;
    &lt;dd&gt;&lt;input type="text" name="age" id="age" value=""&gt;&lt;/dd&gt;
    &lt;dd class="error"&gt;This field is required!&lt;/dd&gt;
    &lt;dd class="error"&gt;Another error&lt;/dd&gt;
    &lt;dd class="info"&gt;Required&lt;/dd&gt;
    &lt;dd class="info"&gt;Another constraint&lt;/dd&gt;
&lt;/dl&gt;</code></pre></div></div></div></section><section id="_global_errors"><h2>Global Errors</h2><div class="slide-content"><div class="ulist"><ul><li><p>Errors that are not attached to a field can be converted to a string with <code>error.format</code>, which takes an <code>implicit</code> <code>play.api.i18n.Messages</code> instance.</p></li><li><p>Global errors that are not bound to a key do not have a helper and must be defined explicitly in the page:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@if(userForm.hasGlobalErrors) {
  &lt;ul&gt;
  @for(error &lt;- userForm.globalErrors) {
    &lt;li&gt;@error.format&lt;/li&gt;
  }
  &lt;/ul&gt;
}</code></pre></div></div></div></section></section>
<section id="_lab_adding_errors"><h2>Lab: Adding Errors</h2></section>
<section><section id="_mongo_integration"><h2>Mongo Integration</h2></section><section id="_mongo_provides_a_mongo_integration"><h2>Mongo Provides a Mongo Integration</h2><div class="slide-content"><div class="ulist"><ul><li><p>The recommended way to get started using the driver in your project is with a dependency management system</p></li><li><p>Include the following in SBT <em>build.sbt</em></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies += "org.mongodb.scala" %% "mongo-scala-driver" % "2.9.0"</code></pre></div></div></div></section><section id="_make_a_connection"><h2>Make a Connection</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following example shows multiple ways to connect to the database <code>mydb</code> on the local machine, using the MongoClient` companion object</p></li><li><p>The <code>database</code> object will be a connection to a MongoDB server for the specified database</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import org.mongodb.scala._

// To directly connect to the default server localhost on port 27017
val mongoClient: MongoClient = MongoClient()

// Use a Connection String
val mongoClient: MongoClient = MongoClient("mongodb://localhost")

// or provide custom MongoClientSettings
val settings: MongoClientSettings = MongoClientSettings.builder()
    .applyToClusterSettings(b =&gt; b.hosts(List(new ServerAddress("localhost")).asJava).
    .build()
val mongoClient: MongoClient = MongoClient(settings)

val database: MongoDatabase = mongoClient.getDatabase("mydb")</code></pre></div></div></div></section><section id="_observable_return_types"><h2><code>Observable</code> return types</h2><div class="slide-content"><div class="ulist"><ul><li><p>The API only returns implementations of Observable[T]` when network IO required for the operation.</p></li><li><p>For <code>getDatabase("mydb")</code> there is no network IO required.</p></li><li><p>A <code>MongoDatabase</code> instance provides methods to interact with a database but the database might not actually exist and will only be created on the insertion of data via some means:</p><div class="ulist"><ul><li><p>e.g. the creation of a collection or the insertion of documents.</p></li></ul></div></li></ul></div></div></section><section id="_mongoclient"><h2>MongoClient</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>MongoClient</code> instance actually represents a pool of connections for a given MongoDB server deployment</p></li><li><p>You will only need one instance of class <code>MongoClient</code> even with multiple concurrently executing asynchronous operations</p></li></ul></div></div></section><section id="_number_of_clients"><h2>Number of Clients</h2><div class="slide-content"><div class="ulist"><ul><li><p>Typically you only create one <code>MongoClient</code> instance for a given database cluster and use it across your application. When creating multiple instances:</p><div class="ulist"><ul><li><p>All resource usage limits (max connections, etc) apply per <code>MongoClient</code> instance</p></li><li><p>To dispose of an instance, make sure you call <code>MongoClient.close()</code> to clean up resources</p></li></ul></div></li></ul></div></div></section><section id="_get_a_collection"><h2>Get a Collection</h2><div class="slide-content"><div class="ulist"><ul><li><p>To get a collection to operate upon, specify the name of the collection to the <code>getCollection(String collectionName)</code> method</p></li><li><p>The following example gets the collection <code>test</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val collection: MongoCollection[Document] = database.getCollection("test");</code></pre></div></div></div></section><section id="_insert_a_document"><h2>Insert a Document</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once you have the collection object, you can insert documents into the collection</p></li><li><p>For example, consider the following JSON document; the document contains a field <code>info</code> which is an embedded document</p></li><li><p>To create the document using the Scala driver, use the <code>Document</code> class</p></li><li><p>You can use this class to create the embedded document as well</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript hljs" data-noescape="true" data-lang="javascript">{
   "name" : "MongoDB",
   "type" : "database",
   "count" : 1,
   "info" : {
               x : 203,
               y : 102
             }
}</code></pre></div></div></div></section><section id="_different_document_types"><h2>Different Document Types</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Scala driver provides two document types:</p><div class="ulist"><ul><li><p>An immutable <code>Document</code></p></li><li><p>and a mutable <code>Document</code></p></li></ul></div></li><li><p>When using an immutable document then you should explicitly add an <code>_id</code> value</p></li><li><p>If you need to know that <code>_id</code> value in the future.</p></li><li><p>If an <code>_id</code> is not present on insertion then driver will add one automatically create one and pass it to the server but that <code>_id</code> will not be passed back to the user.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val doc: Document = Document("_id" -&gt; 0, "name" -&gt; "MongoDB", "type" -&gt; "database",
                             "count" -&gt; 1, "info" -&gt; Document("x" -&gt; 203, "y" -&gt; 102))</code></pre></div></div></div></section><section id="_inserting_a_document"><h2>Inserting a Document</h2><div class="slide-content"><div class="ulist"><ul><li><p>To insert the document into the collection, use the <code>insertOne()</code> method</p></li><li><p>Using the <code>results()</code> implicit we block until the observer is completed:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.insertOne(doc).results();</code></pre></div></div></div></section><section id="_the_observable_type"><h2>The <code>Observable</code> type</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the API all methods returning a <code>Observables</code> are “cold” streams meaning that nothing happens until they are Subscribed to.</p></li><li><p>The example below does nothing:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val observable: Observable[Completed] = collection.insertOne(doc)</code></pre></div></div></div></section><section id="_subscribing_to_observable"><h2>Subscribing to <code>Observable</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Only when an <code>Observable</code> is subscribed to and data requested will the operation happen:</p></li><li><p>Once the document has been inserted the <code>onNext</code> method will be called and it will print “Inserted!” followed by the <code>onCompleted</code> method which will print “Completed”.</p></li><li><p>If there was an error for any reason the <code>onError</code> method would print “Failed”</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">observable.subscribe(new Observer[Completed] {

  override def onNext(result: Completed): Unit = println("Inserted")

  override def onError(e: Throwable): Unit = println("Failed")

  override def onComplete(): Unit = println("Completed")
})</code></pre></div></div></div></section><section id="_add_multiple_documents"><h2>Add Multiple Documents</h2><div class="slide-content"><div class="ulist"><ul><li><p>To add multiple documents, you can use the <code>insertMany()</code> method.</p></li><li><p>The following example will add multiple documents of the form:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript hljs" data-noescape="true" data-lang="javascript">{ "i" : value }</code></pre></div></div></li><li><p>Create the documents in a loop</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val documents = (1 to 100) map { i: Int =&gt; Document("i" -&gt; i) }</code></pre></div></div></li><li><p>To insert these documents to the collection, pass the list of documents to the <code>insertMany()</code> method.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val insertObservable = collection.insertMany(documents)</code></pre></div></div></li></ul></div></div></section><section id="_count_documents_in_a_collection"><h2>Count Documents in A <code>Collection</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>As we haven’t subscribed yet no documents have been inserted, lets chain together two operations, inserting and counting.</p></li><li><p>Once we’ve inserted the <code>documents</code> list we should, have a total of 101 documents in the collection (the 100 we did in the loop, plus the first one).</p></li><li><p>We can check to see if we have them all using the <code>count()</code> method</p></li><li><p>Lets chain the two operations together using a <a href="http://docs.scala-lang.org/tutorials/tour/sequence-comprehensions.html"><code>for</code></a> comprehension. The following code should insert the documents then count the number of documents and print the results:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val insertAndCount = for {
  insertResult &lt;- insertObservable
  countResult &lt;- collection.countDocuments()
} yield countResult

println(s"total # of documents after inserting 100 small ones (should be 101):  ${insertAndCount.headResult()}")</code></pre></div></div></div></section><section id="_query_the_collection"><h2>Query the Collection</h2><div class="slide-content"><div class="paragraph"><p>Use the <code>find()</code> method to query the collection</p></div></div></section><section id="_find_the_first_document_in_a_collection"><h2>Find the First Document in a Collection</h2><div class="slide-content"><div class="ulist"><ul><li><p>To get the first document in the collection, call the <code>first()</code> method on the <code>FindObservable</code> operation</p></li><li><p><code>collection.find().first()</code> returns the first document or if no document is found the <code>Observable</code> just completes</p></li><li><p>This is useful for queries that should only match a single document, or if you are interested in the first document only</p></li><li><p>Using the <code>printHeadResult()</code> implicit we block until the observer is completed and then print the first result</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.find().first().printHeadResult()</code></pre></div></div>
<div class="listingblock"><div class="title">The example will print the following document:</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{ "_id" : 0, "name" : "MongoDB", "type" : "database", "count" : 1, "info" : { "x" : 203, "y" : 102 } }</code></pre></div></div></div></section><section id="_id_and_internal_field_names"><h2><code>id</code> and internal field names</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>_id</code> of the document is “0” as we explicitly set one before we inserted this document</p></li><li><p>MongoDB reserves field names that start with “_” and “$” for internal use</p></li></ul></div></div></section><section id="_find_all_documents_in_a_collection"><h2>Find All Documents in a Collection</h2><div class="slide-content"><div class="ulist"><ul><li><p>To retrieve all the documents in the collection, we will use the <code>find()</code> method</p></li><li><p>The <code>find()</code> method returns a <code>FindObservable</code> instance that provides a fluent interface for chaining or controlling find operations.</p></li><li><p>The following code retrieves all documents in the collection and prints them out (101 documents)</p></li><li><p>Using the <code>printResults()</code> implicit we block until the observer is completed and then print each result</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.find().printResults()</code></pre></div></div></div></section><section id="_get_a_single_document_with_a_query_filter"><h2>Get A Single Document with a Query Filter</h2><div class="slide-content"><div class="ulist"><ul><li><p>We can create a filter to pass to the find() method to get a subset of the documents in our collection.</p></li><li><p>For example, if we wanted to find the document for which the value of the “i” field is 71, we would do the following:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import org.mongodb.scala.model.Filters._

collection.find(equal("i", 71)).first().printHeadResult()</code></pre></div></div>
<div class="listingblock"><div class="title">This will return</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{ "_id" : { "$oid" : "5515836e58c7b4fbc756320b" }, "i" : 71 }</code></pre></div></div></div></section><section id="_use_helpers_to_build_queries"><h2>Use <code>Helpers</code> to build queries</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">For simple and concise ways of building up queries, use some <code>Helpers</code></dt><dd><div class="ulist"><ul><li><p><code>Filters</code></p></li><li><p><code>Sorts</code></p></li><li><p><code>Projections</code></p></li><li><p><code>Updates</code></p></li></ul></div></dd></dl></div></div></section><section id="_get_a_set_of_documents_with_a_query"><h2>Get a Set of Documents with a Query</h2><div class="slide-content"><div class="ulist"><ul><li><p>We can use the query to get a set of documents from our collection.</p></li><li><p>For example, if we wanted to get all documents where <code>"i" &gt; 50</code>, we could write:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.find(gt("i", 50)).printResults()</code></pre></div></div></li><li><p>We could also get a range, say <code>50 &lt; i &#8656; 100</code>:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.find(and(gt("i", 50), lte("i", 100))).printResults()</code></pre></div></div></li></ul></div></div></section><section id="_sorting_documents"><h2>Sorting documents</h2><div class="slide-content"><div class="ulist"><ul><li><p>We can also use the <code>Sorts</code> helpers to sort documents</p></li><li><p>We add a sort to a find query by calling the <code>sort()</code> method on a <code>FindObservable</code></p></li><li><p>Below we use the <code>exists()</code> helper and use the sort <code>descending("i")</code> helper to sort our documents</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import org.mongodb.scala.model.Sorts._

collection.find(exists("i")).sort(descending("i")).first().printHeadResult()</code></pre></div></div></div></section><section id="_projecting_fields"><h2>Projecting fields</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sometimes we don’t need all the data contained in a document.</p></li><li><p>The <code>Projections</code> helpers can be used to build the projection parameter for the find operation and limit the fields returned</p></li><li><p>Below we’ll sort the collection, exclude the <code>_id</code> field and output the first matching document:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import org.mongodb.scala.model.Projections._

collection.find().projection(excludeId()).first().printHeadResult()</code></pre></div></div></div></section><section id="_aggregations"><h2>Aggregations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sometimes we need to aggregate the data stored in MongoDB</p></li><li><p>The <code>Aggregates</code> helper provides builders for each of type of aggregation stage</p></li><li><p>Below we’ll do a simple two step transformation that will calculate the value of <code>i * 10</code></p></li><li><p>First we find all Documents where <code>i &gt; 0</code> by using the <code>Aggregates.filter</code> helper.</p></li><li><p>Then we reshape the document by using <code>Aggregates.project</code> in conjunction with the <code>$multiply</code> operator to calculate the “<code>ITimes10</code>” value:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import org.mongodb.scala.model.Aggregates._

collection.aggregate(Seq(filter(gt("i", 0)),
  project(Document("""{ITimes10: {$multiply: ["$i", 10]}}""")))
).printResults()</code></pre></div></div></li><li><p>For <code>$group</code> operations use the <code>Accumulators</code> helper for any <a href="http://docs.mongodb.org/manual/reference/operator/aggregation/group/#accumulator-operator%0A">accumulator operations</a>.</p></li><li><p>Below we sum up all the values of <code>i</code> by using the <a href="/mongo-scala-driver/2.9/builders/aggregation/#group"><code>Aggregates.group</code></a> helper in conjunction with the <a href="/mongo-scala-driver/2.9/scaladoc/com/mongodb/client/model/Accumulators#sum-java.lang.String-TExpression-.html%0A"><code>Accumulators.sum</code></a> helper:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.aggregate(List(group(null, sum("total", "$i")))).printHeadResult()</code></pre></div></div></li></ul></div></div></section><section id="_helper_limitations"><h2>Helper Limitations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Currently, there are no helpers for <a href="http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#aggregation-expressions">aggregation expressions</a></p></li><li><p>Use the <code>Document.parse()</code> helper to quickly build aggregation expressions from extended JSON</p></li></ul></div></div></section><section id="_updating_documents"><h2>Updating documents</h2><div class="slide-content"><div class="ulist"><ul><li><p>There are numerous <a href="http://docs.mongodb.org/manual/reference/operator/update-field/">update operators</a> supported by MongoDB.</p></li><li><p>We can use the <code>Updates</code> helpers to help update documents in the database.</p></li><li><p>To update at most a single document (may be <code>0</code> if none match the filter), use the <code>updateOne</code> method to specify the filter and the update document</p></li><li><p>Here we update the first document that meets the filter <code>i</code> equals <code>10</code> and set the value of <code>i</code> to <code>110</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import org.mongodb.scala.model.Updates._

collection.updateOne(equal("i", 10), set("i", 110)).printHeadResult("Update Result: ")</code></pre></div></div></div></section><section id="_update_all_documents_matching_a_filter"><h2>Update all documents matching a filter</h2><div class="slide-content"><div class="ulist"><ul><li><p>To update all documents matching the filter use the <code>updateMany</code> method.</p></li><li><p>Here we increment the value of <code>i</code> by <code>100</code> where <code>i</code> is less than <code>100</code>.</p></li><li><p>The update methods return an <a href="http://mongodb.github.io/mongo-java-driver/3.12/javadoc?com/mongodb/client/result/UpdateResult.html%0A"><code>UpdateResult</code></a>, which provides information about the operation including the number of documents modified by the update</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.updateMany(lt("i", 100), inc("i", 100)).printHeadResult("Update Result: ")</code></pre></div></div></div></section><section id="_deleting_documents"><h2>Deleting documents</h2><div class="slide-content"><div class="ulist"><ul><li><p>To delete at most a single document (may be 0 if none match the filter) use the <code>deleteOne</code> method:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.deleteOne(equal("i", 110)).printHeadResult("Delete Result: ")</code></pre></div></div></div></section><section id="_delete_all_documents_matching_a_filter"><h2>Delete all documents matching a filter</h2><div class="slide-content"><div class="ulist"><ul><li><p>To delete all documents matching the filter use the <code>deleteMany</code> method.</p></li><li><p>Here we delete all documents where <code>i</code> is greater or equal to <code>100</code>:</p></li><li><p>The delete methods return a <a href="http://mongodb.github.io/mongo-java-driver/3.12/javadoc?com/mongodb/client/result/DeleteResult.html%0A"><code>DeleteResult</code></a>, which provides information about the operation including the number of documents deleted</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.deleteMany(gte("i", 100)).printHeadResult("Delete Result: ")</code></pre></div></div></div></section><section id="_bulk_operations"><h2>Bulk operations</h2><div class="slide-content"><div class="ulist"><ul><li><p>These commands allow for the execution of bulk insert/update/delete operations.</p></li><li><p>There are two types of bulk operations:</p><div class="ulist"><ul><li><p>Ordered bulk operations - Executes all the operation in order and error out on the first write error. Unordered bulk operations do not guarantee order of execution.</p></li><li><p>Unordered bulk operations - Executes all the operations and reports any the errors</p></li></ul></div></li></ul></div></div></section><section id="_starting_with_a_batch_set_of_operations"><h2>Starting with a batch set of operations</h2><div class="slide-content"><div class="paragraph"><p>Given the following batch operation</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val writes: List[WriteModel[_ &lt;: Document]] = List(
      InsertOneModel(Document("_id" -&gt; 4)),
      InsertOneModel(Document("_id"-&gt; 5)),
      InsertOneModel(Document("_id" -&gt; 6)),
      UpdateOneModel(Document("_id" -&gt; 1), set("x", 2)),
      DeleteOneModel(Document("_id" -&gt; 2)),
      ReplaceOneModel(Document("_id" -&gt; 3), Document("_id" -&gt; 3, "x" -&gt; 4))
    )</code></pre></div></div></div></section><section id="_ordered_bulk_write"><h2>Ordered Bulk Write</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection.bulkWrite(writes).printHeadResult("Bulk write results: ")</code></pre></div></div></div></section><section id="_unordered_bulk_operation"><h2>Unordered bulk operation</h2><div class="slide-content"><div class="paragraph"><p>Understanding there is no guarantee of order of operation</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">collection
 .bulkWrite(writes, BulkWriteOptions().ordered(false))
 .printHeadResult("Bulk write results (unordered): ")</code></pre></div></div></div></section><section id="_find_more_about_mongo_and_scala_integration"><h2>Find more about Mongo and Scala integration</h2><div class="slide-content"><div class="paragraph"><p>View More information on integration with a Mongo DB at the <a href="https://mongodb.github.io/mongo-java-driver/4.6/driver-scala/">Scala Driver Website</a></p></div></div></section></section>
<section id="_lab_mongo_database_integration"><h2>Lab: Mongo Database Integration</h2></section>
<section><section id="_session_scopes"><h2>Session Scopes</h2></section><section id="_how_it_is_different_in_play"><h2>How it is different in Play</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you have to keep data across multiple HTTP requests, you can save them in the Session or the Flash scope</p></li><li><p>Data stored in the Session are available during the whole user session, and data stored in the flash scope are only available to the next request</p></li></ul></div></div></section><section id="_working_with_cookies"><h2>Working with Cookies</h2><div class="slide-content"><div class="ulist"><ul><li><p>It’s important to understand that <code>Session</code> and <code>Flash</code> data are not stored in the server but are added to each subsequent HTTP Request, using HTTP cookies</p></li><li><p>Because Session and Flash are implemented using cookies, there are some important implications</p><div class="ulist"><ul><li><p>The data size is very limited (up to 4 KB)</p></li><li><p>You can only store string values, although you can serialize JSON to the cookie</p></li><li><p>Information in a cookie is visible to the browser, and so can expose sensitive data</p></li><li><p>Cookie information is immutable to the original request, and only available to subsequent requests</p></li></ul></div></li></ul></div></div></section><section id="_clarity_on_immutable_cookies"><h2>Clarity on immutable Cookies</h2><div class="slide-content"><div class="ulist"><ul><li><p>When you modify the cookie, you are providing information to the response, and Play must parse it again to see the updated value</p></li><li><p>If you would like to ensure the session information is current then you should always pair modification of a session with a <code>Redirect</code></p></li></ul></div></div></section><section id="_session_configuration"><h2>Session Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>The default name for the cookie is <code>PLAY_SESSION</code></p></li><li><p>This can be changed by configuring the key <code>play.http.session.cookieName</code> in application.conf</p></li><li><p>If the name of the cookie is changed, the earlier cookie can be discarded using the same methods mentioned in Setting and discarding cookies</p></li></ul></div></div></section><section id="_session_timeout_expiration"><h2>Session Timeout / Expiration</h2><div class="slide-content"><div class="ulist"><ul><li><p>By default, there is no technical timeout for the Session</p></li><li><p>It expires when the user closes the web browser</p></li><li><p>If you need a functional timeout for a specific application, you set the maximum age of the session cookie by configuring the key <code>play.http.session.maxAge</code> in <code>application.conf</code>, and this will also set <code>play.http.session.jwt.expiresAfter</code> to the same value</p></li><li><p>The <code>maxAge</code> property will remove the cookie from the browser, and the JWT <code>exp</code> claim will be set in the cookie, and will make it invalid after the given duration</p></li></ul></div></div></section><section id="_storing_data_in_the_session"><h2>Storing data in the Session</h2><div class="slide-content"><div class="ulist"><ul><li><p>As the Session is just a Cookie, it is also just an HTTP header</p></li><li><p>You can manipulate the session data the same way you manipulate other results properties</p></li><li><p>Note that this will replace the whole session</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Redirect("/home").withSession("connected" -&gt; "[email protected]")</code></pre></div></div></div></section><section id="_adding_to_an_existing_session"><h2>Adding to an existing session</h2><div class="slide-content"><div class="paragraph"><p>If you need to add an element to an existing Session, just add an element to the incoming session, and specify that as new session</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Redirect("/home").withSession(request.session + ("saidHello" -&gt; "yes"))</code></pre></div></div></div></section><section id="_removing_a_value_from_a_session"><h2>Removing a value from a session</h2><div class="slide-content"><div class="paragraph"><p>You can remove any value from the incoming session the same way</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Redirect("/home").withSession(request.session - "theme")</code></pre></div></div></div></section><section id="_reading_a_session_value"><h2>Reading a Session value</h2><div class="slide-content"><div class="paragraph"><p>You can retrieve the incoming Session from the HTTP request</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = Action { request =&gt;
  request.session
    .get("connected")
    .map { user =&gt;
      Ok("Hello " + user)
    }
    .getOrElse {
      Unauthorized("Oops, you are not connected")
    }
}</code></pre></div></div></div></section><section id="_discarding_the_whole_session"><h2>Discarding the whole session</h2><div class="slide-content"><div class="paragraph"><p>There is special operation that discards the whole session</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Redirect("/home").withNewSession</code></pre></div></div></div></section></section>
<section id="_lab_creating_the_session"><h2>Lab: Creating the Session</h2></section>
<section><section id="_json"><h2>JSON</h2></section><section id="_json_basics"><h2>JSON basics</h2><div class="slide-content"><div class="ulist"><ul><li><p>Modern web applications often need to parse and generate data in the JSON (JavaScript Object Notation) format</p></li><li><p>Play supports this via its JSON library</p></li><li><p>JSON is a lightweight data-interchange format</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">{
  "name" : "Watership Down",
  "location" : {
    "lat" : 51.235685,
    "long" : -1.309197
  },
  "residents" : [ {
    "name" : "Fiver",
    "age" : 4,
    "role" : null
  }, {
    "name" : "Bigwig",
    "age" : 6,
    "role" : "Owsla"
  } ]
}</code></pre></div></div></div></section><section id="_the_play_json_library"><h2>The Play JSON library</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>play.api.libs.json</code> package contains data structures for representing JSON data and utilities for converting between these data structures and other data representations</p></li><li><p>Some of the features of this package are:</p><div class="ulist"><ul><li><p>Automatic conversion to and from case classes with minimal boilerplate</p></li><li><p>If you want to get up and running quickly with minimal code, this is probably the place to start</p></li><li><p>Custom validation while parsing</p></li><li><p>Automatic parsing of JSON in request bodies, with auto-generated errors if content isn’t parseable or incorrect Content-type headers are supplied</p></li><li><p>Can be used outside of a Play application as a standalone library</p></li><li><p>Just add <code>libraryDependencies += "com.typesafe.play" %% "play-json" % playVersion</code> to your <code>build.sbt</code> file</p></li><li><p>Highly customizable</p></li></ul></div></li></ul></div></div></section><section id="_jsvalue"><h2><code>JsValue</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>This is a trait representing any JSON value</p></li><li><p>The JSON library has a case class extending <code>JsValue</code> to represent each valid JSON type:</p></li><li><p>Using the various <code>JsValue</code> types, you can construct a representation of any JSON structure</p><div class="ulist"><ul><li><p><code>JsString</code></p></li><li><p><code>JsNumber</code></p></li><li><p><code>JsBoolean</code></p></li><li><p><code>JsObject</code></p></li><li><p><code>JsArray</code></p></li><li><p><code>JsNull</code></p></li></ul></div></li></ul></div></div></section><section id="_json_2"><h2><code>Json</code></h2><div class="slide-content"><div class="paragraph"><p>The <code>Json</code> object provides utilities, primarily for conversion to and from <code>JsValue</code> structures</p></div></div></section><section id="_jspath"><h2><code>JsPath</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Represents a path into a <code>JsValue</code> structure, analogous to XPath for XML</p></li><li><p>This is used for traversing <code>JsValue</code> structures and in patterns for implicit converters</p></li></ul></div></div></section><section id="_converting_to_a_jsvalue"><h2>Converting to a <code>JsValue</code></h2></section><section id="_using_string_parsing"><h2>Using string parsing</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._

val json: JsValue = Json.parse("""
  {
    "name" : "Watership Down",
    "location" : {
      "lat" : 51.235685,
      "long" : -1.309197
    },
    "residents" : [ {
      "name" : "Fiver",
      "age" : 4,
      "role" : null
    }, {
      "name" : "Bigwig",
      "age" : 6,
      "role" : "Owsla"
    } ]
  }
  """)</code></pre></div></div></div></section><section id="_using_class_construction"><h2>Using class construction</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._

val json: JsValue = JsObject(
  Seq(
    "name"     -&gt; JsString("Watership Down"),
    "location" -&gt; JsObject(Seq("lat" -&gt; JsNumber(51.235685), "long" -&gt; JsNumber(-1.309197))),
    "residents" -&gt; JsArray(
      IndexedSeq(
        JsObject(
          Seq(
            "name" -&gt; JsString("Fiver"),
            "age"  -&gt; JsNumber(4),
            "role" -&gt; JsNull
          )
        ),
        JsObject(
          Seq(
            "name" -&gt; JsString("Bigwig"),
            "age"  -&gt; JsNumber(6),
            "role" -&gt; JsString("Owsla")
          )
        )
      )
    )
  )
)</code></pre></div></div>
<div class="ulist"><ul><li><p><code>Json.obj</code> and <code>Json.arr</code> can simplify construction a bit</p></li></ul></div></div></section><section id="_using_implicits_with_json"><h2>Using <code>implicits</code> with JSON</h2><div class="slide-content"><div class="ulist"><ul><li><p>Most values don’t need to be explicitly wrapped by <code>JsValue</code> classes, the factory methods use implicit conversion</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json.JsNull
import play.api.libs.json.Json
import play.api.libs.json.JsString
import play.api.libs.json.JsValue

val json: JsValue = Json.obj(
  "name"     -&gt; "Watership Down",
  "location" -&gt; Json.obj("lat" -&gt; 51.235685, "long" -&gt; -1.309197),
  "residents" -&gt; Json.arr(
    Json.obj(
      "name" -&gt; "Fiver",
      "age"  -&gt; 4,
      "role" -&gt; JsNull
    ),
    Json.obj(
      "name" -&gt; "Bigwig",
      "age"  -&gt; 6,
      "role" -&gt; "Owsla"
    )
  )
)</code></pre></div></div></div></section><section id="_using_writes_converters"><h2>Using <code>Writes</code> converters</h2><div class="slide-content"><div class="ulist"><ul><li><p>Scala to <code>JsValue</code> conversion is performed by the utility method <code>Json.toJson[T](T)(implicit writes: Writes[T])</code></p></li><li><p>This functionality depends on a converter of type <code>Writes[T]</code> which can convert a <code>T</code> to a <code>JsValue</code></p></li><li><p>The Play JSON API provides implicit <code>Writes</code> for most basic types, such as <code>Int</code>, <code>Double</code>, <code>String</code>, and <code>Boolean</code></p></li><li><p>It also supports <code>Writes</code> for collections of any type <code>T</code> that a <code>Writes[T]</code> exists</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._

// basic types
val jsonString  = Json.toJson("Fiver")
val jsonNumber  = Json.toJson(4)
val jsonBoolean = Json.toJson(false)

// collections of basic types
val jsonArrayOfInts    = Json.toJson(Seq(1, 2, 3, 4))
val jsonArrayOfStrings = Json.toJson(List("Fiver", "Bigwig"))</code></pre></div></div></div></section><section id="_converting_your_own_models"><h2>Converting your own models</h2><div class="slide-content"><div class="paragraph"><p>To convert your own models to <code>JsValue`s, you must define implicit `Writes</code> converters and provide them in scope</p></div></div></section><section id="_create_the_case_classes"><h2>Create the <code>case classes</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class Location(lat: Double, long: Double)
case class Resident(name: String, age: Int, role: Option[String])
case class Place(name: String, location: Location, residents: Seq[Resident])</code></pre></div></div></div></section><section id="_creating_the_writes"><h2>Creating the <code>Writes[_]</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._

implicit val locationWrites = new Writes[Location] {
  def writes(location: Location) = Json.obj(
    "lat"  -&gt; location.lat,
    "long" -&gt; location.long
  )
}

implicit val residentWrites = new Writes[Resident] {
  def writes(resident: Resident) = Json.obj(
    "name" -&gt; resident.name,
    "age"  -&gt; resident.age,
    "role" -&gt; resident.role
  )
}

implicit val placeWrites = new Writes[Place] {
  def writes(place: Place) = Json.obj(
    "name"      -&gt; place.name,
    "location"  -&gt; place.location,
    "residents" -&gt; place.residents
  )
}</code></pre></div></div></div></section><section id="_using_your_objects"><h2>Using your Objects</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val place = Place(
  "Watership Down",
  Location(51.235685, -1.309197),
  Seq(
    Resident("Fiver", 4, None),
    Resident("Bigwig", 6, Some("Owsla"))
  )
)

val json = Json.toJson(place)</code></pre></div></div></div></section><section id="_traversing_a_jsvalue_structure"><h2>Traversing a JsValue structure</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can traverse a <code>JsValue</code> structure and extract specific values</p></li><li><p>The syntax and functionality is similar to Scala XML processing</p></li></ul></div></div></section><section id="_simple_path"><h2>Simple path <code>\</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Applying the <code>\</code> operator to a <code>JsValue</code> will return the property corresponding to the field argument in a <code>JsObject</code>, or the item at that index in a <code>JsArray</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val lat = (json \ "location" \ "lat").get
// returns JsNumber(51.235685)
val bigwig = (json \ "residents" \ 1).get
// returns {"name":"Bigwig","age":6,"role":"Owsla"}</code></pre></div></div></div></section><section id="_information_on"><h2>Information on <code>\</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>\</code> operator returns a <code>JsLookupResult</code>, which is either <code>JsDefined</code> or <code>JsUndefined</code></p></li><li><p>You can chain multiple <code>\</code> operators, and the result will be <code>JsUndefined</code> if any intermediate value cannot be found</p></li><li><p>Calling <code>get</code> on a <code>JsLookupResult</code> attempts to get the value if it is defined and throws an exception if it is not</p></li><li><p>You can also use the Direct lookup <code>apply</code> method (below) to get a field in an object or index in an array</p></li><li><p>Like <code>get</code>, this method will throw an exception if the value does not exist</p></li></ul></div></div></section><section id="_recursive_path"><h2>Recursive path <code>\\</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Applying the <code>\\</code> operator will do a lookup for the field in the current object and all descendants</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val names = json \\ "name"
// returns Seq(JsString("Watership Down"), JsString("Fiver"), JsString("Bigwig"))</code></pre></div></div></div></section><section id="_direct_lookup"><h2>Direct lookup</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can retrieve a value in a <code>JsArray</code> or <code>JsObject</code> using an <code>.apply</code> operator, which is identical to the Simple path <code>\</code> operator except it returns the value directly (rather than wrapping it in a <code>JsLookupResult</code>)</p></li><li><p>Throws an exception if the index or key is not found:</p></li><li><p>This is useful if you are writing quick-and-dirty code and are accessing some JSON values you <em>know</em> to exist, for example in one-off scripts or in the REPL</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val name = json("name")
// returns JsString("Watership Down")

val bigwig2 = json("residents")(1)
// returns {"name":"Bigwig","age":6,"role":"Owsla"}

// (json("residents")(3)
// throws an IndexOutOfBoundsException

// json("bogus")
// throws a NoSuchElementException</code></pre></div></div></li></ul></div></div></section><section id="_converting_from_a_jsvalue"><h2>Converting from a <code>JsValue</code></h2></section><section id="_minified_string_utility"><h2>Minified String Utility</h2><div class="slide-content"><div class="paragraph"><p>Minified:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val minifiedString: String = Json.stringify(json)</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">{"name":"Watership Down","location":{"lat":51.235685,"long":-1.309197},"residents":[{"name":"Fiver","age":4,"role":null},{"name":"Bigwig","age":6,"role":"Owsla"}]}</code></pre></div></div></div></section><section id="_readable_utility"><h2>Readable Utility</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val readableString: String = Json.scala(json)</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">{
  "name" : "Watership Down",
  "location" : {
    "lat" : 51.235685,
    "long" : -1.309197
  },
  "residents" : [ {
    "name" : "Fiver",
    "age" : 4,
    "role" : null
  }, {
    "name" : "Bigwig",
    "age" : 6,
    "role" : "Owsla"
  } ]
}</code></pre></div></div></div></section><section id="_using_jsvalue_asasopt"><h2>Using JsValue.as/asOpt</h2><div class="slide-content"><div class="ulist"><ul><li><p>The simplest way to convert a <code>JsValue</code> to another type is using <code>JsValue.as[T](implicit fjs: Reads[T]): T</code></p></li><li><p>This requires an implicit converter of type <code>Reads[T]</code>] to convert a <code>JsValue</code> to <code>T</code> (the inverse of <code>Writes[T</code>)</p></li><li><p>As with <code>Writes</code>, the JSON API provides <code>Reads</code> for basic types</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val name = (json \ "name").as[String]
// "Watership Down"

val names = (json \\ "name").map(_.as[String])
// Seq("Watership Down", "Fiver", "Bigwig")</code></pre></div></div></div></section><section id="_as_method_exceptions"><h2><code>as</code> method exceptions</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>as</code> method will throw a <code>JsResultException</code> if the path is not found or the conversion is not possible</p></li><li><p>A safer method is <code>JsValue.asOpt[T](implicit fjs: Reads[T]): Option[T]</code></p></li><li><p>Although the <code>asOpt</code> method is safer, any error information is lost</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val nameOption = (json \ "name").asOpt[String]
// Some("Watership Down")

val bogusOption = (json \ "bogus").asOpt[String]
// None</code></pre></div></div></div></section><section id="_using_validation"><h2>Using validation</h2><div class="slide-content"><div class="ulist"><ul><li><p>The preferred way to convert from a <code>JsValue</code> to another type is by using its <code>validate</code> method (which takes an argument of type <code>Reads</code>)</p></li><li><p>This performs both validation and conversion, returning a type of <code>JsResult</code></p></li><li><p><code>JsResult</code> is implemented by two classes:</p><div class="ulist"><ul><li><p><code>JsSuccess</code>: Represents a successful validation/conversion and wraps the result</p></li><li><p><code>JsError</code>: Represents unsuccessful validation/conversion and contains a list of validation errors</p></li></ul></div></li></ul></div></div></section><section id="_establishing_validation"><h2>Establishing Validation</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can apply various patterns for handling a validation result:</p></li><li><p>First select the path of what you need to validate</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val json = { .. }

val nameResult: JsResult[String] = (json \ "name").validate[String]</code></pre></div></div></div></section><section id="_pattern_matching_validation"><h2>Pattern Matching Validation</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">nameResult match {
  case JsSuccess(name, _) =&gt; println(s"Name: $name")
  case e: JsError         =&gt; println(s"Errors: ${JsError.toJson(e)}")
}</code></pre></div></div></div></section><section id="_fallback_pattern_matching"><h2>Fallback Pattern Matching</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val nameOrFallback = nameResult.getOrElse("Undefined")</code></pre></div></div></div></section><section id="_using_map"><h2>Using <code>map</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val nameUpperResult: JsResult[String] = nameResult.map(_.toUpperCase)</code></pre></div></div></div></section><section id="_using_fold"><h2>Using <code>fold</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val nameOption: Option[String] = nameResult.fold(
  invalid = { fieldErrors =&gt;
    fieldErrors.foreach { x =&gt;
      println(s"field: ${x.&lt;em&gt;1}, errors: ${x._2}")
    }
    Option.empty[String]
  },
  valid = Some(&lt;/em&gt;)
)</code></pre></div></div></div></section><section id="_jsvalue_to_a_model"><h2>JsValue to a model</h2><div class="slide-content"><div class="ulist"><ul><li><p>To convert from JsValue to a model, you must define implicit <code>Reads[T]</code> where <code>T</code> is the type of your model</p></li><li><p>First the models</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class Location(lat: Double, long: Double)
case class Resident(name: String, age: Int, role: Option[String])
case class Place(name: String, location: Location, residents: Seq[Resident])</code></pre></div></div></li></ul></div></div></section><section id="_converting_the_json_to_model"><h2>Converting the JSON to Model</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._
import play.api.libs.functional.syntax._

implicit val locationReads: Reads[Location] = (
  (JsPath \ "lat").read[Double] and
    (JsPath \ "long").read[Double]
)(Location.apply _)

implicit val residentReads: Reads[Resident] = (
  (JsPath \ "name").read[String] and
    (JsPath \ "age").read[Int] and
    (JsPath \ "role").readNullable[String]
)(Resident.apply _)

implicit val placeReads: Reads[Place] = (
  (JsPath \ "name").read[String] and
    (JsPath \ "location").read[Location] and
    (JsPath \ "residents").read[Seq[Resident]]
)(Place.apply _)

val json = { .. }

val placeResult: JsResult[Place] = json.validate[Place]
// JsSuccess(Place(...),)

val residentResult: JsResult[Resident] = (json \ "residents")(1).validate[Resident]
// JsSuccess(Resident(Bigwig,6,Some(Owsla)),)</code></pre></div></div></div></section><section id="_json_with_http"><h2>JSON with HTTP</h2><div class="slide-content"><div class="paragraph"><p>Play supports HTTP requests and responses with a content type of JSON by using the HTTP API in combination with the JSON library</p></div></div></section><section id="_establishing_the_model"><h2>Establishing the Model</h2><div class="slide-content"><div class="paragraph"><p>Here’s the model we’ll use for our service:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class Location(lat: Double, long: Double)

case class Place(name: String, location: Location)

object Place {
  var list: List[Place] = {
    List(
      Place(
        "Sandleford",
        Location(51.377797, -1.318965)
      ),
      Place(
        "Watership Down",
        Location(51.235685, -1.309197)
      )
    )
  }

  def save(place: Place) = {
    list = list ::: List(place)
  }
}</code></pre></div></div></div></section><section id="_serving_a_list_of_entities_in_json"><h2>Serving a list of entities in JSON</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.mvc._

class HomeController @Inject() (cc: ControllerComponents) extends AbstractController(cc) {}</code></pre></div></div></div></section><section id="_creating_the_writes_plumbing_for_json"><h2>Creating the <code>Writes</code> plumbing for JSON</h2><div class="slide-content"><div class="ulist"><ul><li><p>Before we write our <code>Action</code>, we’ll need the plumbing for doing conversion from our model to a <code>JsValue</code> representation</p></li><li><p>This is accomplished by defining an implicit <code>Writes[Place]</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">implicit val locationWrites: Writes[Location] =
  (JsPath \ "lat").write[Double].and((JsPath \ "long").write[Double])(unlift(Location.unapply))

implicit val placeWrites: Writes[Place] =
  (JsPath \ "name").write[String].and((JsPath \ "location").write[Location])(unlift(Place.unapply))</code></pre></div></div></div></section><section id="_creating_the_action"><h2>Creating the <code>Action</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def listPlaces = Action {
  val json = Json.toJson(Place.list)
  Ok(json)
}</code></pre></div></div>
<div class="ulist"><ul><li><p>The <code>Action</code> retrieves a list of <code>Place</code> objects, converts them to a <code>JsValue</code> using <code>Json.toJson</code> with our implicit <code>Writes[Place]</code>, and returns this as the body of the result</p></li><li><p>Play will recognize the result as JSON and set the appropriate <code>Content-Type</code> header and body value for the response</p></li></ul></div></div></section><section id="_creating_the_route"><h2>Creating the <em>route</em></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET   /places               controllers.Application.listPlaces</code></pre></div></div>
<div class="ulist"><ul><li><p>We can test the action by making a request with a browser or HTTP tool</p></li><li><p>This example uses the unix command line tool <a href="https://curl.haxx.se/">cURL</a></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">curl --include http://localhost:9000/places</code></pre></div></div>
<div class="paragraph"><p>Response:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 141

[{"name":"Sandleford","location":{"lat":51.377797,"long":-1.318965}},{"name":"Watership Down","location":{"lat":51.235685,"long":-1.309197}}]</code></pre></div></div></div></section><section id="_creating_a_new_entity_instance_in_json"><h2>Creating a new entity instance in JSON</h2><div class="slide-content"><div class="paragraph"><p>For this <code>Action</code> we’ll need to define an implicit <code>Reads[Place]</code> to convert a <code>JsValue</code> to our model</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">implicit val locationReads: Reads[Location] =
  (JsPath \ "lat").read[Double].and((JsPath \ "long").read[Double])(Location.apply _)

implicit val placeReads: Reads[Place] =
  (JsPath \ "name").read[String].and((JsPath \ "location").read[Location])(Place.apply _)</code></pre></div></div></div></section><section id="_defining_the_action"><h2>Defining the <code>Action</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>This <code>Action</code> expects a request with a <code>Content-Type</code> header of <code>text/json</code> or <code>application/json</code> and a body containing a JSON representation of the entity to create</p></li><li><p>It uses a JSON specific <code>BodyParser</code> which will parse the request and provide <code>request.body</code> as a <code>JsValue</code></p></li><li><p>We used the <code>validate</code> method for conversion which will rely on our implicit <code>Reads[Place]</code></p></li><li><p>To process the validation result, we used a <code>fold</code> with error and success flows</p></li><li><p>The <code>Action</code> also sends JSON responses</p></li></ul></div></div></section><section id="_action_with_parse_json"><h2><code>Action</code> with <code>parse.json</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def savePlace = Action(parse.json) { request =&gt;
  val placeResult = request.body.validate[Place]
  placeResult.fold(
    errors =&gt; {
      BadRequest(Json.obj("message" -&gt; JsError.toJson(errors)))
    },
    place =&gt; {
      Place.save(place)
      Ok(Json.obj("message" -&gt; ("Place '" + place.name + "' saved.")))
    }
  )
}</code></pre></div></div></div></section><section id="_body_parsers"><h2>Body Parsers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Body parsers can be typed with a case class, an explicit <code>Reads</code> object or take a function</p></li><li><p>So we can offload even more of the work onto Play to make it automatically parse JSON to a case class and validate it before even calling our <code>Action</code>:</p></li></ul></div></div></section><section id="_creating_the_reads"><h2>Creating the <code>Reads</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.functional.syntax._
import play.api.libs.json.Reads._
import play.api.libs.json._

implicit val locationReads: Reads[Location] = (
  (JsPath \ "lat")
    .read[Double](min(-90.0).keepAnd(max(90.0)))
    .and((JsPath \ "long").read[Double](min(-180.0).keepAnd(max(180.0))))
  )(Location.apply _)

implicit val placeReads: Reads[Place] =
  (JsPath \ "name").read[String](minLength[String](2)).and((JsPath \ "location").read[Location])(Place.apply _)</code></pre></div></div></div></section><section id="_validating_the_json"><h2>Validating the JSON</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">// This helper parses and validates JSON using the implicit &lt;code&gt;placeReads&lt;/code&gt;
// above, returning errors if the parsed json fails validation
def validateJson[A: Reads] = parse.json.validate(
  _.validate[A].asEither.left.map(e =&gt; BadRequest(JsError.toJson(e)))
)</code></pre></div></div></div></section><section id="_creating_the_action_2"><h2>Creating the action</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">// if we don't care about validation we could replace &lt;code&gt;validateJson[Place]&lt;/code&gt;
// with &lt;code&gt;BodyParsers.parse.json[Place]&lt;/code&gt; to get an unvalidated case class
// in &lt;code&gt;request.body&lt;/code&gt; instead
def savePlaceConcise = Action(validateJson[Place]) { request =&gt;
  // &lt;code&gt;request.body&lt;/code&gt; contains a fully validated &lt;code&gt;Place&lt;/code&gt; instance
  val place = request.body
  Place.save(place)
  Ok(Json.obj("message" -&gt; ("Place '" + place.name + "' saved.")))
}</code></pre></div></div></div></section><section id="_adding_the_route"><h2>Adding the Route</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">POST  /places               controllers.Application.savePlace</code></pre></div></div></div></section><section id="_testing_the_json_payload"><h2>Testing the JSON payload</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">curl --include
  --request POST
  --header "Content-type: application/json"
  --data '{"name":"Nuthanger Farm","location":{"lat" : 51.244031,"long" : -1.263224}}'
  http://localhost:9000/places</code></pre></div></div></div></section><section id="_receiving_the_response"><h2>Receiving the Response</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 57

{"message":"Place 'Nuthanger Farm' saved."}</code></pre></div></div></div></section><section id="_testing_with_invalid_data"><h2>Testing with invalid data</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">curl --include
  --request POST
  --header "Content-type: application/json"
  --data '{"location":{"lat" : 51.244031,"long" : -1.263224}}'
  http://localhost:9000/places</code></pre></div></div></div></section><section id="_receiving_the_response_2"><h2>Receiving the Response</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">HTTP/1.1 400 Bad Request
Content-Type: application/json
Content-Length: 79

{"message":{"obj.name":[{"msg":"error.path.missing","args":[]}]}}</code></pre></div></div></div></section><section id="_testing_with_argument_invalid_data"><h2>Testing with argument invalid data</h2><div class="slide-content"><div class="paragraph"><p>Testing the action with a invalid data, wrong data type for “lat”:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">curl --include
  --request POST
  --header "Content-type: application/json"
  --data '{"name":"Nuthanger Farm","location":{"lat" : "xxx","long" : -1.263224}}'
  http://localhost:9000/places</code></pre></div></div></div></section><section id="_receiving_the_response_3"><h2>Receiving the Response</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">HTTP/1.1 400 Bad Request
Content-Type: application/json
Content-Length: 92

{"message":{"obj.location.lat":[{"msg":"error.expected.jsnumber","args":[]}]}}</code></pre></div></div></div></section></section>
<section><section id="_xml"><h2>XML</h2></section><section id="_xml_defined"><h2>XML Defined</h2><div class="slide-content"><div class="ulist"><ul><li><p>XML</p><div class="ulist"><ul><li><p>stands for eXtensible Markup Language</p></li><li><p>is a markup language much like HTML</p></li><li><p>was designed to store and transport data</p></li><li><p>was designed to be self-descriptive</p></li><li><p>is a W3C Recommendation</p></li><li><p>is the basis of the HTML or XHTML</p></li></ul></div></li></ul></div></div></section><section id="_handling_and_accepting_xml"><h2>Handling and Accepting XML</h2><div class="slide-content"><div class="ulist"><ul><li><p>An XML request is an HTTP request using a valid XML payload as the request body</p></li><li><p>It must specify the <code>application/xml</code> or <code>text/xml</code> MIME type in its <code>Content-Type</code> header</p></li><li><p>By default an <code>Action</code> uses a any content body parser</p></li><li><p>You can then retrieve the body as XML (actually as a <code>NodeSeq</code>)</p></li><li><p><code>NodeSeq</code> is a scala XML object that is "monadic" and composable</p></li></ul></div></div></section><section id="_using_nodeseq"><h2>Using <code>NodeSeq</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def sayHello = Action { request =&gt;
  request.body.asXml
    .map { xml =&gt;
      (xml \\ "name" headOption) <i class="conum" data-value="1"></i><b>(1)</b>
        .map(_.text)
        .map { name =&gt;
          Ok("Hello " + name)    <i class="conum" data-value="2"></i><b>(2)</b>
        }
        .getOrElse {
          BadRequest("Missing parameter [name]")
        }
    }
    .getOrElse {
      BadRequest("Expecting Xml data")
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Using XPath style navigation</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Using functional programming and returning a Play <code>Result</code></td></tr></table></div></div></section><section id="_using_a_bodyparser_2"><h2>Using a <code>BodyParser</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>While returning <code>Any</code> and then use <code>asXML</code> is valid solution</p></li><li><p>It is not that type-safe, if you are looking for clean programming, use a <code>BodyParser</code></p></li><li><p><code>BodyParser</code> is injectable so you can read a specific type in the block</p></li><li><p>When using an XML body parser, the <code>request.body</code> value is directly a valid <code>NodeSeq</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def sayHello = Action(parse.xml) { request =&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  (request.body \\ "name" headOption)
    .map(_.text)
    .map { name =&gt;
      Ok("Hello " + name)
    }
    .getOrElse {
      BadRequest("Missing parameter [name]")
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>parse.xml</code> is a directive to user that calling <code>request.body</code> returns a <code>NodeSeq</code></td></tr></table></div></div></section><section id="_testing_with_curl_from_the_command_line"><h2>Testing with <a href="https://curl.haxx.se/" target="_blank">cURL</a> from the command line</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">curl
  --header "Content-type: application/xml"
  --request POST
  --data '&lt;name&gt;Guillaume&lt;/name&gt;'
  http://localhost:9000/sayHello$</code></pre></div></div>
<div class="paragraph"><p>Responds with:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Content-Length: 15

Hello Guillaume</code></pre></div></div></div></section><section id="_serving_xml_responses"><h2>Serving XML Responses</h2><div class="slide-content"><div class="ulist"><ul><li><p>In our previous example we handle an XML request, but we reply with a <code>text/plain</code> response.</p></li><li><p>Let’s change that to send back a valid XML HTTP response</p><div class="listingblock"><div class="title">Notice the <code>&lt;</code> and the <code>&gt;</code> representing the embedded XML!</div><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def sayHello = Action(parse.xml) { request =&gt;
  (request.body \\ "name" headOption)
    .map(_.text)
    .map { name =&gt;
      Ok(&lt;message status="OK"&gt;Hello
      {name}
    &lt;/message&gt;)
    }
    .getOrElse {
      BadRequest(&lt;message status="KO"&gt;Missing parameter [name]&lt;/message&gt;)
    }
}</code></pre></div></div></li></ul></div></div></section><section id="_the_xml_response"><h2>The XML Response</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">HTTP/1.1 200 OK
Content-Type: application/xml; charset=utf-8
Content-Length: 46

&lt;message status="OK"&gt;Hello Guillaume&lt;/message&gt;</code></pre></div></div></div></section><section id="_lab_serving_up_xml"><h2>Lab: Serving up XML</h2></section></section>
<section id="_lab_serving_json_and_xml"><h2>Lab: Serving JSON and XML</h2></section>
<section><section id="_uploading_documents"><h2>Uploading documents</h2></section><section id="_uploading_files_in_a_form_using_multipartform_data"><h2>Uploading files in a form using <code>multipart/form-data</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>The standard way to upload files in a web application is to use a form with a special <code>multipart/form-data</code> encoding, which lets you mix standard form data with file attachment data.</p></li><li><p>The HTTP method used to submit the form must be <code>POST</code> (not <code>GET</code>).</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@helper.form(action = routes.HomeController.upload,
   Symbol("enctype") -&gt; "multipart/form-data") {
    &lt;input type="file" name="picture"&gt;
    &lt;p&gt;
        &lt;input type="submit"&gt;
    &lt;/p&gt;
}</code></pre></div></div></div></section><section id="_adding_csrf"><h2>Adding CSRF</h2><div class="slide-content"><div class="ulist"><ul><li><p>Add a CSRF token to the form, unless you have the CSRF filter disabled.</p></li><li><p>The CSRF filter checks the multi-part form in the order the fields are listed, so put the CSRF token before the file input field.</p></li><li><p>This improves efficiency and avoids a token-not-found error if the file size exceeds <code>play.filters.csrf.body.bufferSize</code>.</p></li></ul></div></div></section><section id="_defining_the_action_2"><h2>Defining the <code>Action</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def upload = Action(parse.multipartFormData) { request =&gt;
  request.body
    .file("picture")
    .map { picture =&gt;
      // only get the last part of the filename
      // otherwise someone can send a path like ../../home/foo/bar.txt to write to other files on the system
      val filename    = Paths.get(picture.filename).getFileName
      val fileSize    = picture.fileSize
      val contentType = picture.contentType

      picture.ref.copyTo(Paths.get(s"/tmp/picture/$filename"), replace = true)
      Ok("File uploaded")
    }
    .getOrElse {
      Redirect(routes.HomeController.index).flashing("error" -&gt; "Missing file")
    }
}</code></pre></div></div>
<div class="ulist"><ul><li><p>The <code>ref</code> attribute gives you a reference to a <code>TemporaryFile</code></p></li><li><p>This is the default way the <code>multipartFormData</code> parser handles file uploads.</p></li></ul></div></div></section><section id="_setting_up_the_router"><h2>Setting up the Router</h2><div class="slide-content"><div class="ulist"><ul><li><p>An empty file will be treated just like no file was uploaded at all.</p></li><li><p>The same applies if the <code>filename</code> header of a <code>multipart/form-data</code> file upload part is empty - even when the file itself would not empty.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">POST  /          democontrollers.HomeController.upload()</code></pre></div></div></div></section><section id="_direct_file_upload"><h2>Direct file upload</h2><div class="slide-content"><div class="ulist"><ul><li><p>Another way to send files to the server is to use Ajax to upload files asynchronously from a form.</p></li><li><p>In this case, the request body will not be encoded as <code>multipart/form-data</code>, but will just contain the plain file contents.</p></li><li><p>In this case we can just use a body parser to store the request body content in a file. For this example, let’s use the <code>temporaryFile</code> body parser:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def upload = Action(parse.temporaryFile) { request =&gt;
  request.body.moveTo(Paths.get("/tmp/picture/uploaded"), replace = true)
  Ok("File uploaded")
}</code></pre></div></div></div></section><section id="_cleaning_up_temporary_files"><h2>Cleaning up temporary files</h2><div class="slide-content"><div class="ulist"><ul><li><p>Uploading files uses a <code>TemporaryFile</code> API which relies on storing files in a temporary filesystem, accessible through the <code>ref</code> attribute.</p></li><li><p>Uploading files is an inherently dangerous operation, because unbounded file upload can cause the filesystem to fill up</p></li><li><p>The idea behind <code>TemporaryFile</code> is that it’s only in scope at completion and should be moved out of the temporary file system as soon as possible.</p></li><li><p>Any temporary files that are not moved are deleted.</p></li><li><p>However, under <a href="https://github.com/playframework/playframework/issues/5545">certain conditions</a>, garbage collection does not occur in a timely fashion.</p></li><li><p>There’s also a <code>play.api.libs.Files.TemporaryFileReaper</code> that can be enabled to delete temporary files on a scheduled basis using the Akka scheduler, distinct from the garbage collection method.</p></li><li><p>The reaper is disabled by default, and is enabled through configuration of <code>application.conf</code></p></li></ul></div></div></section><section id="_enacting_the_reaper"><h2>Enacting the Reaper</h2><div class="slide-content"><div class="ulist"><ul><li><p>This will delete files that are more than 30 minutes old, using the “olderThan” property.</p></li><li><p>It will start the reaper five minutes after the application starts, and will check the filesystem every 30 seconds thereafter.</p></li><li><p>The reaper is not aware of any existing file uploads, so protracted file uploads may run into the reaper if the system is not carefully configured.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.temporaryFile {
  reaper {
    enabled = true
    initialDelay = "5 minutes"
    interval = "30 seconds"
    olderThan = "30 minutes"
  }
}</code></pre></div></div></div></section></section>
<section id="_lab_upload_files"><h2>Lab: Upload Files</h2></section>
<section><section id="_caching"><h2>Caching</h2></section><section id="_caching_api"><h2>Caching API</h2><div class="slide-content"><div class="ulist"><ul><li><p>For any data stored in the cache, a regeneration strategy needs to be put in place in case the data goes missing</p></li><li><p>This philosophy is one of the fundamentals behind Play, and is different from Java EE, where the session is expected to retain values throughout its lifetime.</p></li><li><p>Play provides a CacheApi implementation based on Caffeine and a legacy implementation based on Ehcache 2.x.</p></li><li><p>For in-process caching Caffeine is typically the best choice.</p></li><li><p>If you need distributed caching, there are third-party plugins for memcached and redis.</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">An important point about the cache is that it behaves just like a cache should: the data you just stored may just go missing.</td></tr></table></div></div></section><section id="_import_caffeine_cache_api"><h2>Import Caffeine Cache API</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play provides separate dependencies for the Cache API and for the Caffeine and Ehcache implementations.</p></li><li><p>To get the Caffeine implementation, add <code>caffeine</code> to your dependencies list:</p></li><li><p>This will also automatically set up the bindings for runtime DI so the components are injectable.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies ++= Seq(
  caffeine
)</code></pre></div></div></div></section><section id="_import_ehcache_api"><h2>Import EhCache API</h2><div class="slide-content"><div class="ulist"><ul><li><p>EhCache was previous cache, if you care to use it, include it into your SBT file</p></li><li><p>This will also automatically set up the bindings for runtime DI so the components are injectable</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies ++= Seq(
  ehcache
)</code></pre></div></div></li></ul></div></div></section><section id="_adding_your_custom_caching_api"><h2>Adding your custom Caching API</h2><div class="slide-content"><div class="ulist"><ul><li><p>To add only the API, add <code>cacheApi</code> to your dependencies list</p></li><li><p>The API dependency is useful if you’d like to define your own bindings for the Cached helper and <code>AsyncCacheApi</code>, etc., without having to depend on any specific cache implementation.</p></li><li><p>If you’re writing a custom cache module you should use this</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies ++= Seq(
  cacheApi
)</code></pre></div></div></div></section><section id="_accessing_the_cache"><h2>Accessing the Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>The cache API is defined by the <code>AsyncCacheApi</code> and <code>SyncCacheApi</code> traits</p></li><li><p>They can be injected into your component like any other dependency</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.cache._
import play.api.mvc._
import javax.inject.Inject

class Application @Inject() (cache: AsyncCacheApi, cc: ControllerComponents)
  extends AbstractController(cc) {}</code></pre></div></div></li></ul></div></div></section><section id="_storing_into_your_cache"><h2>Storing into your cache</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val result: Future[Done] = cache.set("item.key", connectedUser)</code></pre></div></div></div></section><section id="_retrieving_from_the_cache"><h2>Retrieving from the cache</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val futureMaybeUser: Future[Option[User]] = cache.get[User]("item.key")</code></pre></div></div></div></section><section id="_set_or_update_from_the_cache"><h2>Set or Update from the cache</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val futureUser: Future[User] = cache.getOrElseUpdate[User]("item.key") {
  User.findById(connectedUser)
}</code></pre></div></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content"><code>getOrElseUpdate</code> is not an atomic operation in <em>EhCache</em> and is implemented as a <code>get</code> followed by computing the value, then a <code>set</code>. This means it’s possible for the value to be computed multiple times if multiple threads are calling <code>getOrElse</code> simultaneously</td></tr></table></div></div></section><section id="_setting_your_cache_with_an_expiration"><h2>Setting your cache with an expiration</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can specify an expiry duration by passing a <code>duration</code>, by default the duration is infinite:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import scala.concurrent.duration._
val result: Future[Done] = cache.set("item.key", connectedUser, 5.minutes)</code></pre></div></div></li></ul></div></div></section><section id="_removing_from_the_cache"><h2>Removing from the cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>To remove an item from the cache use the remove method:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val removeResult: Future[Done] = cache.remove("item.key")</code></pre></div></div></li></ul></div></div></section><section id="_removing_all_elements"><h2>Removing all elements</h2><div class="slide-content"><div class="ulist"><ul><li><p>To remove all element use <code>removeAll</code></p></li><li><p>This only works with <code>AsyncCacheApi</code>, since doing so synchronously is a rarity</p></li><li><p>Expectation is that this should only exposed as an admin operation</p></li><li><p><code>SyncCacheApi</code> has the same API, except it returns the values directly instead of using futures</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val removeAllResult: Future[Done] = cache.removeAll()</code></pre></div></div></li></ul></div></div></section><section id="_defining_named_caches"><h2>Defining <code>Named</code> Caches</h2><div class="slide-content"><div class="ulist"><ul><li><p>Define and use different caches with different configurations by their name</p></li><li><p>First you will need to define your <code>@NamedCache</code> in your <em>application.conf</em></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.cache.bindCaches = ["db-cache", "user-cache", "session-cache"]</code></pre></div></div></div></section><section id="_using_named_caches"><h2>Using <code>Named</code> Caches</h2><div class="slide-content"><div class="ulist"><ul><li><p>To access different caches, when you inject them, use the <code>NamedCache</code> qualifier on your dependency</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.cache._
import play.api.mvc._
import javax.inject.Inject

class Application @Inject() (
    @NamedCache("session-cache") sessionCache: AsyncCacheApi,
    cc: ControllerComponents
) extends AbstractController(cc) {}</code></pre></div></div></li></ul></div></div></section><section id="_configuring_named_caches"><h2>Configuring Named Caches</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you want to pass a default custom configuration that will be used as a fallback for all your caches you can do it by specifying those setting in your <em>application.conf</em></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.cache.caffeine.defaults = {
    initial-capacity = 200
    ...
}</code></pre></div></div></li><li><p>You can also pass custom configuration data for specific caches</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.cache.caffeine.user-cache = {
    initial-capacity = 200
    ...
}</code></pre></div></div></li></ul></div></div></section><section id="_configuring_namedcaches_with_ehcache"><h2>Configuring <code>@NamedCache</code>s with EhCache</h2><div class="slide-content"><div class="ulist"><ul><li><p>With EhCache implementation, the default cache is called <code>play</code></p></li><li><p>The cache can be configured by creating a file called <em>ehcache.xml</em>.</p></li><li><p>Additional caches may be configured with different configurations, or even implementations</p></li><li><p>By default, Play will try to create caches with names from <code>play.cache.bindCaches</code> for you.</p></li><li><p>If you would like to define them yourself in <em>ehcache.xml</em>, you can set in your <em>application.conf</em></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.cache.createBoundCaches = false</code></pre></div></div></li></ul></div></div></section><section id="_setting_a_different_executioncontext"><h2>Setting a different <code>ExecutionContext</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>By default, all Caffeine and EhCache operations are blocking</p></li><li><p>Async implementations will block threads in the default execution context</p></li><li><p>Usually this is okay if you are using Play’s default configuration, which only stores elements in memory since reads should be relatively fast.</p></li><li><p>However, depending on how cache was configured, this blocking I/O might be too costly.</p></li><li><p>For such a case you can configure a different Akka dispatcher and set it via <code>play.cache.dispatcher</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.cache.dispatcher = "contexts.blockingCacheDispatcher"

contexts {
  blockingCacheDispatcher {
    fork-join-executor {
      parallelism-factor = 3.0
    }
  }
}</code></pre></div></div></div></section><section id="_caching_http_responses"><h2>Caching HTTP Responses</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can easily create smart cached actions using standard Action composition.</p></li><li><p>Play HTTP <code>Result</code> instances are safe to cache and reuse later</p></li><li><p>First, <code>@Inject</code> the <code>Cached</code> component</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.cache.Cached
import javax.inject.Inject

class Application @Inject() (cached: Cached, cc: ControllerComponents)
  extends AbstractController(cc) {}</code></pre></div></div></li><li><p>Apply <code>cached</code> to your <code>Action</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def index = cached("homePage") {
  Action {
    Ok("Hello world")
  }
}</code></pre></div></div></li></ul></div></div></section><section id="_controlling_caching_by_url_and_status"><h2>Controlling Caching by URL and Status</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can get very fine-grained with caching</p></li><li><p>For example, you can cache only <code>200 (OK)</code> results</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def get(index: Int) = cached.status(_ =&gt; "/resource/" + index, 200) {
  Action {
    if (index &gt; 0) {
      Ok(Json.obj("id" -&gt; index))
    } else {
      NotFound
    }
  }
}</code></pre></div></div></li></ul></div></div></section><section id="_caching_errors_for_a_few_minutes"><h2>Caching Errors for a few minutes</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also cache <code>404</code> for a few minutes before having it try again</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def get(index: Int) = {
  val caching = cached
    .status(_ =&gt; "/resource/" + index, 200)
    .includeStatus(404, 600) <i class="conum" data-value="1"></i><b>(1)</b>

  caching {
    Action {
      if (index % 2 == 1) {
        Ok(Json.obj("id" -&gt; index))
      } else {
        NotFound
      }
    }
  }
}</code></pre></div></div></li></ul></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>The <code>600</code> is in seconds, therefore this will always return <code>404</code> until after 10 minutes</td></tr></table></div></div></section></section>
<section id="_lab_caching"><h2>Lab: Caching</h2></section>
<section><section id="_web_client"><h2>Web Client</h2></section><section id="_calling_rest_apis_with_play_ws"><h2>Calling REST APIs with Play WS</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sometimes we would like to call other HTTP services from within a Play application.</p></li><li><p>Play supports this via its WS (“WebService”) library which provides a way to make asynchronous HTTP calls through a WSClient instance.</p></li><li><p>There are two important parts to using the WSClient:</p><div class="ulist"><ul><li><p>Making a request</p></li><li><p>Processing the response.</p></li></ul></div></li></ul></div></div></section><section id="_adding_ws_to_project"><h2>Adding WS to project</h2><div class="slide-content"><div class="paragraph"><p>To use WSClient, first add <code>ws</code> to your <code>build.sbt</code> file:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies += ws</code></pre></div></div></div></section><section id="_enabling_http_caching_in_play_ws"><h2>Enabling HTTP Caching in Play WS</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play WS supports <a href="https://tools.ietf.org/html/rfc7234">HTTP caching</a>, but requires a JSR-107 cache implementation to enable this feature</p></li><li><p>You can add <code>ehcache</code> or <a href="https://github.com/ben-manes/caffeine/wiki/JCache">Caffeine</a></p></li><li><p>Using an HTTP cache means savings on repeated requests to backend REST services, and is especially useful when combined with resiliency features such as <a href="https://tools.ietf.org/html/rfc5861"><code>stale-on-error</code> and <code>stale-while-revalidate</code></a></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies += ehcache</code></pre></div></div></div></section><section id="_making_a_request"><h2>Making a Request</h2><div class="slide-content"><div class="paragraph"><p>Now any component that wants to use WS will have to declare a dependency on the <code>WSClient</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject

import scala.concurrent.Future
import scala.concurrent.duration._
import play.api.mvc._
import play.api.libs.ws._
import play.api.http.HttpEntity
import akka.actor.ActorSystem
import akka.stream.scaladsl._
import akka.util.ByteString

import scala.concurrent.ExecutionContext

class Application @Inject() (ws: WSClient, val controllerComponents: ControllerComponents) extends BaseController {}</code></pre></div></div></div></section><section id="_making_a_request_2"><h2>Making a Request</h2><div class="slide-content"><div class="ulist"><ul><li><p>To build an HTTP request, you start with <code>ws.url()</code> to specify the URL.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val request: WSRequest = ws.url(url)</code></pre></div></div></li><li><p>This returns <code>WSRequest</code> that you can use to specify various HTTP options, such as setting headers.</p></li><li><p>You can chain calls together to construct complex requests.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val complexRequest: WSRequest =
  request
    .addHttpHeaders("Accept" -&gt; "application/json")
    .addQueryStringParameters("search" -&gt; "play")
    .withRequestTimeout(10000.millis)</code></pre></div></div></li></ul></div></div></section><section id="_call_the_http_method"><h2>Call the HTTP Method</h2><div class="slide-content"><div class="ulist"><ul><li><p>You end by calling a method corresponding to the HTTP method you want to use.</p></li><li><p>This ends the chain, and uses all the options defined on the built request in the <code>WSRequest</code>.</p></li><li><p>The http method returns a <code>Future[WSResponse]</code> where the <code>Response</code> contains the data returned from the server</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val futureResponse: Future[WSResponse] = complexRequest.get()</code></pre></div></div></div></section><section id="_request_with_authentication"><h2>Request with authentication</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you need to use HTTP authentication, you can specify it in the builder, using a <code>username</code>, <code>password</code>, and an <code>AuthScheme</code>.</p></li><li><p>Valid case objects for the AuthScheme are <code>BASIC</code>, <code>DIGEST</code>, <code>KERBEROS</code>, <code>NTLM</code>, and <code>SPNEGO</code>.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).withAuth(user, password, WSAuthScheme.BASIC).get()</code></pre></div></div></div></section><section id="_request_with_follow_redirects"><h2>Request with follow redirects</h2><div class="slide-content"><div class="ulist"><ul><li><p>If an HTTP call results in a <code>302</code> or a <code>301</code> redirect, you can automatically follow the redirect without having to make another call.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).withFollowRedirects(true).get()</code></pre></div></div></div></section><section id="_request_with_query_parameters"><h2>Request with query parameters</h2><div class="slide-content"><div class="ulist"><ul><li><p>Parameters can be specified as a series of key/value tuples.</p></li><li><p>Use <code>addQueryStringParameters</code> to add parameters, and <code>withQueryStringParameters</code> to overwrite all query string parameters</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).addQueryStringParameters("paramKey" -&gt; "paramValue").get()</code></pre></div></div></li></ul></div></div></section><section id="_request_with_additional_headers"><h2>Request with additional headers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Headers can be specified as a series of key/value tuples.</p></li><li><p>Use <code>addHttpHeaders</code> to append additional headers, and <code>withHttpHeaders</code> to overwrite all headers.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).addHttpHeaders("headerKey" -&gt; "headerValue").get()</code></pre></div></div></div></section><section id="_calling_a_different_content_type"><h2>Calling a different content type</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you are sending plain text in a particular format, you may want to define the content type explicitly.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url)
  .addHttpHeaders("Content-Type" -&gt; "application/xml")
  .post(xmlString)</code></pre></div></div></li></ul></div></div></section><section id="_request_with_cookies"><h2>Request with cookies</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cookies can be added to the request by using <code>DefaultWSCookie</code> or by passing through <code>play.api.mvc.Cookie</code></p></li><li><p>Use <code>addCookies</code> to append cookies, and <code>withCookies</code> to overwrite all cookies</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).addCookies(DefaultWSCookie("cookieName", "cookieValue")).get()</code></pre></div></div></div></section><section id="_request_with_timeout"><h2>Request with timeout</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you wish to specify a request timeout, you can use <code>withRequestTimeout</code> to set a value.</p></li><li><p>An infinite timeout can be set by passing <code>Duration.Inf</code>.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).withRequestTimeout(5000.millis).get()</code></pre></div></div></div></section><section id="_submitting_form_data"><h2>Submitting form data</h2><div class="slide-content"><div class="ulist"><ul><li><p>To post url-form-encoded data a <code>Map[String, Seq[String]]</code> needs to be passed into <code>post</code></p></li><li><p>If the body is empty, you must pass play.api.libs.ws.EmptyBody into the post method</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">ws.url(url).post(Map("key" -&gt; Seq("value")))</code></pre></div></div></div></section><section id="_submitting_json_data"><h2>Submitting JSON data</h2><div class="slide-content"><div class="paragraph"><p>The easiest way to post JSON data is to use the <a href="ScalaJson">JSON</a> library.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._
val data = Json.obj(
  "key1" -&gt; "value1",
  "key2" -&gt; "value2"
)
val futureResponse: Future[WSResponse] = ws.url(url).post(data)</code></pre></div></div></div></section><section id="_submitting_xml_data"><h2>Submitting XML data</h2><div class="slide-content"><div class="ulist"><ul><li><p>The easiest way to post XML data is to use XML literals.</p></li><li><p>XML literals are convenient, but not very fast.</p></li><li><p>For efficiency, consider using an XML view template, or a JAXB library.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val data                               = &lt;person&gt;
  &lt;name&gt;Steve&lt;/name&gt;
  &lt;age&gt;23&lt;/age&gt;
&lt;/person&gt;
val futureResponse: Future[WSResponse] = ws.url(url).post(data)</code></pre></div></div></div></section><section id="_processing_the_response"><h2>Processing the Response</h2><div class="slide-content"><div class="ulist"><ul><li><p>Working with the <code>Response</code> is easily done by mapping inside the <a href="https://www.scala-lang.org/api/current/index.html#scala.concurrent.Future">Future</a>.</p></li><li><p>The examples given below have some common dependencies that will be shown once here for brevity.</p></li><li><p>Whenever an operation is done on a <code>Future</code>, an implicit execution context must be available - this declares which thread pool the callback to the future should run in. You can inject the default Play execution context in your DI-ed class by declaring an additional dependency to <code>ExecutionContext</code> in the class’ constructor:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">class PersonService @Inject() (ec: ExecutionContext) {
  // ...
}</code></pre></div></div></div></section><section id="_deserializing_the_response"><h2>Deserializing the Response</h2><div class="slide-content"><div class="ulist"><ul><li><p>The examples also use the following case class for serialization/deserialization:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">case class Person(name: String, age: Int)</code></pre></div></div></li><li><p>The WSResponse extends <code>play.api.libs.ws.WSBodyReadables</code> trait, which contains type classes for Play JSON and Scala XML conversion.</p></li><li><p>You can also create your own custom type classes if you would like to convert the response to your own types, or use a different JSON or XML encoding.</p></li></ul></div></div></section><section id="_processing_a_response_as_json"><h2>Processing a response as JSON</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can process the response as a <a href="https://static.javadoc.io/com.typesafe.play/play-json_2.12/2.6.9/play/api/libs/json/JsValue.html">JSON object</a> by calling <code>response.json</code>.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val futureResult: Future[String] = ws.url(url).get().map { response =&gt;
  (response.json \ "person" \ "name").as[String]
}</code></pre></div></div></li><li><p>The JSON library has a that will map an implicit <a href="https://static.javadoc.io/com.typesafe.play/play-json_2.12/2.6.9/play/api/libs/json/Reads.html"><code>Reads[T</a></code>] directly to a class:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import play.api.libs.json._

implicit val personReads = Json.reads[Person]

val futureResult: Future[JsResult[Person]] = ws.url(url).get().map { response =&gt;
  (response.json \ "person").validate[Person]
}</code></pre></div></div></li></ul></div></div></section><section id="_processing_a_response_as_xml"><h2>Processing a response as XML</h2><div class="slide-content"><div class="paragraph"><p>You can process the response as an <a href="https://www.scala-lang.org/api/current/index.html#scala.xml.NodeSeq">XML literal</a> by calling <code>response.xml</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">val futureResult: Future[scala.xml.NodeSeq] = ws.url(url).get().map { response =&gt;
  response.xml \ "message"
}</code></pre></div></div></div></section><section id="_configuring_wsclient"><h2>Configuring WSClient</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Use the following properties in <code>application.conf</code> to configure the WSClient</dt><dd><div class="ulist"><ul><li><p><code>play.ws.followRedirects</code>: Configures the client to follow 301 and 302 redirects <em>(default is <strong>true</strong>)</em>.</p></li><li><p><code>play.ws.useProxyProperties</code>: To use the JVM system’s HTTP proxy settings (http.proxyHost, http.proxyPort) <em>(default is <strong>true</strong>)</em>.</p></li><li><p><code>play.ws.useragent</code>: To configure the User-Agent header field.</p></li><li><p><code>play.ws.compressionEnabled</code>: Set it to true to use gzip/deflater encoding <em>(default is <strong>false</strong>)</em>.</p></li></ul></div></dd></dl></div></div></section><section id="_configuring_timeouts"><h2>Configuring Timeouts</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">There are 3 different timeouts in WSClient. Reaching a timeout causes the WSClient request to interrupt</dt><dd><div class="ulist"><ul><li><p><code>play.ws.timeout.connection</code>: The maximum time to wait when connecting to the remote host <em>(default is <strong>120 seconds</strong>)</em>.</p></li><li><p><code>play.ws.timeout.idle</code>: The maximum time the request can stay idle (connection is established but waiting for more data) <em>(default is <strong>120 seconds</strong>)</em>.</p></li><li><p><code>play.ws.timeout.request</code>: The total time you accept a request to take (it will be interrupted even if the remote host is still sending data) <em>(default is <strong>120 seconds</strong>)</em>.</p></li></ul></div></dd></dl></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">The request timeout can be overridden for a specific connection with <code>withRequestTimeout()</code> (see “Making a Request” section).</td></tr></table></div></div></section><section id="_configuring_asynchttpclientconfig"><h2>Configuring-AsyncHttpClientConfig</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following advanced settings can be configured on the underlying AsyncHttpClientConfig.</p></li><li><p>Please refer to the <a href="https://static.javadoc.io/org.asynchttpclient/async-http-client/2.10.0/org/asynchttpclient/DefaultAsyncHttpClientConfig.Builder.html">AsyncHttpClientConfig Documentation</a> for more information.</p><div class="ulist"><ul><li><p><code>play.ws.ahc.keepAlive</code></p></li><li><p><code>play.ws.ahc.maxConnectionsPerHost</code></p></li><li><p><code>play.ws.ahc.maxConnectionsTotal</code></p></li><li><p><code>play.ws.ahc.maxConnectionLifetime</code></p></li><li><p><code>play.ws.ahc.idleConnectionInPoolTimeout</code></p></li><li><p><code>play.ws.ahc.maxNumberOfRedirects</code></p></li><li><p><code>play.ws.ahc.maxRequestRetry</code></p></li><li><p><code>play.ws.ahc.disableUrlEncoding</code></p></li></ul></div></li></ul></div></div></section></section>
<section id="_lab_web_client"><h2>Lab: Web Client</h2></section>
<section><section id="_static_assets"><h2>Static Assets</h2></section><section id="_working_with_public_assets"><h2>Working with public assets</h2><div class="slide-content"><div class="ulist"><ul><li><p>Serving a public resource in Play is the same as serving any other HTTP request</p></li><li><p>It uses the same routing as regular resources using the controller/action path to distribute CSS, JavaScript or image files to the client</p></li></ul></div></div></section><section id="_the_public_folder"><h2>The public/ folder</h2><div class="slide-content"><div class="ulist"><ul><li><p>By convention public assets are stored in the <code>public</code> folder of your application</p></li><li><p>This folder can be organized the way that you prefer</p></li><li><p>This is the conventional layout</p></li><li><p>If you follow this structure it will be simpler to get started, but nothing stops you to modifying it once you understand how it works</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">public
 └ javascripts
 └ stylesheets
 └ images</code></pre></div></div></div></section><section id="_how_are_public_assets_packaged"><h2>How are public assets packaged?</h2><div class="slide-content"><div class="ulist"><ul><li><p>During the build process, the contents of the <code>public</code> folder are processed and added to the application classpath</p></li><li><p>When you package your application, all assets for the application, including all sub projects, are aggregated into a single jar, in <code>target/my-first-app-1.0.0-assets.jar</code></p><div class="ulist"><ul><li><p>This jar is included in the distribution so that your Play application can serve them</p></li><li><p>This jar can also be used to deploy the assets to a CDN or reverse proxy</p></li></ul></div></li></ul></div></div></section><section id="_the_assets_controller"><h2>The <code>Assets</code> controller</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play comes with a built-in controller to serve public assets</p></li><li><p>By default, this controller provides caching, ETag, gzip and compression support</p></li><li><p>There are two different styles that the Assets controller supports: the first is to use Play’s configuration, and the second is to use pass the assets path directly to the controller</p></li></ul></div></div></section><section id="_binding_the_assets_components"><h2>Binding the Assets components</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you are using runtime dependency injection, Play already provides bindings in the <code>AssetsModule</code>, which is loaded by default</p></li><li><p>(If you are not using assets, you can disable this module by adding the configuration <code>play.modules.disabled += controllers.AssetsModule</code>.)</p></li><li><p>The bindings there make <code>Assets</code> class injectable</p></li><li><p>If you are using components traits to do compile-time dependency injection, you should mix in <code>controllers.AssetsComponents</code></p></li><li><p>Then the controller will be available as <code>assets: Assets</code></p></li><li><p>You do not need to construct the controller yourself</p></li></ul></div></div></section><section id="_using_assets_with_configuration"><h2>Using assets with configuration</h2><div class="slide-content"><div class="paragraph"><p>For the most common case where you only have one place where assets are centrally located, you can use configuration to specify the location:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">play.assets {
  path = "/public"
  urlPrefix = "/assets"
}</code></pre></div></div>
<div class="paragraph"><p>And use the <code>Assets.at</code> method with one parameter:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Assets.at(file: String)</code></pre></div></div>
<div class="paragraph"><p>Then in routes:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET  /assets/*file        controllers.Assets.at(file)</code></pre></div></div></div></section><section id="_passing_the_assets_path_directly"><h2>Passing the assets path directly</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>Assets</code> controller also defines an <code>at</code> action with two parameters:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">Assets.at(path: String, file: String)</code></pre></div></div></li><li><p>The <code>path</code> parameter must be fixed and defines the directory managed by the action</p></li><li><p>The <code>file</code> parameter is usually dynamically extracted from the request path</p></li><li><p>Here is the typical mapping of the <code>Assets</code> controller in your <code>conf/routes</code> file:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET  /assets/*file        controllers.Assets.at(path="/public", file)</code></pre></div></div></li><li><p>Note that we define the <code><strong>file</code> dynamic part that will match the <code>.</strong></code> regular expression</p></li></ul></div></div></section><section id="_example_sending_the_request_to_the_server"><h2>Example: Sending the request to the server</h2><div class="slide-content"><div class="ulist"><ul><li><p>So for example, if you send this request to the server:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET /assets/javascripts/jquery.js</code></pre></div></div></li><li><p>The router will invoke the <code>Assets.at</code> action with the following parameters:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">controllers.Assets.at("/public", "javascripts/jquery.js")</code></pre></div></div></li><li><p>To route to a single static file, both the path and file have to be specified:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET  /favicon.ico        controllers.Assets.at(path="/public", file="favicon.ico")</code></pre></div></div></li></ul></div></div></section><section id="_reverse_routing_for_public_assets"><h2>Reverse routing for public assets</h2><div class="slide-content"><div class="ulist"><ul><li><p>As for any controller mapped in the routes file, a reverse controller is created in <code>controllers.routes.Assets</code></p></li><li><p>You use this to reverse the URL needed to fetch a public resource</p></li><li><p>For example, from a template:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;script src="@routes.Assets.at("javascripts/jquery.js")"&gt;&lt;/script&gt;</code></pre></div></div></li><li><p>In <code>DEV</code> mode this will by default produce the following result:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;script src="/assets/javascripts/jquery.js"&gt;&lt;/script&gt;</code></pre></div></div></li></ul></div></div></section><section id="_using_minified_javascript_assets"><h2>Using minified JavaScript assets</h2><div class="slide-content"><div class="ulist"><ul><li><p>If your app is not running in <code>DEV</code> mode <strong>and</strong> a <code>jquery.min.js</code> or <code>jquery-min.js</code> file exists then by default the minified file will be used instead:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;script src="/assets/javascripts/jquery.min.js"&gt;&lt;/script&gt;</code></pre></div></div></li><li><p>This makes debugging of JavaScript files easier during development</p></li><li><p>Of course this not only works for JavaScript files but for any file extension</p></li><li><p>If you don’t want Play to automatically resolve the <code>.min.<strong></code> or <code>-min.</strong></code> files, regardless of the mode your application is running in, you can set <code>play.assets.checkForMinified = false</code> in your <code>application.conf</code> (or to <code>true</code> to always resolve the min file, even in <code>DEV</code> mode)</p></li></ul></div></div></section><section id="_there_is_not_need_to_specify_the_folder"><h2>There is not need to specify the folder</h2><div class="slide-content"><div class="ulist"><ul><li><p>Note that we don’t specify the first <code>folder</code> parameter when we reverse the route</p></li><li><p>This is because our routes file defines a single mapping for the <code>Assets.at</code> action, where the <code>folder</code> parameter is fixed</p></li><li><p>So it doesn’t need to be specified</p></li></ul></div></div></section><section id="_unless_you_do_a_different_mapping"><h2>Unless you do a different mapping</h2><div class="slide-content"><div class="paragraph"><p>However, if you define two mappings for the <code>Assets.at</code> action, like this:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET  /javascripts/*file        controllers.Assets.at(path="/public/javascripts", file)
GET  /images/*file             controllers.Assets.at(path="/public/images", file)</code></pre></div></div>
<div class="paragraph"><p>You will then need to specify both parameters when using the reverse router:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;script src="@routes.Assets.at("/public/javascripts", "jquery.js")"&gt;&lt;/script&gt;
&lt;img src="@routes.Assets.at("/public/images", "logo.png")" /&gt;</code></pre></div></div></div></section></section>
<section><section id="_webjars"><h2>WebJars</h2></section><section id="_webjars_2"><h2>WebJars</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://www.webjars.org/">WebJars</a> provide a convenient and conventional packaging mechanism that is a part of sbt.</p></li><li><p>For example you can declare that you will be using the popular <a href="https://getbootstrap.com/">Bootstrap library</a> simply by adding the following dependency in your build file:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies += "org.webjars" % "bootstrap" % "3.3.6"</code></pre></div></div></li></ul></div></div></section><section id="_automatic_extraction"><h2>Automatic Extraction</h2><div class="slide-content"><div class="ulist"><ul><li><p>WebJars are automatically extracted into a <code>lib</code> folder relative to your public assets for convenience</p></li><li><p>If you declared a dependency on <a href="https://requirejs.org/">RequireJs</a> then you can reference it from a view using a line like below</p></li><li><p>The <code>lib</code> folder denotes the extracted WebJar assets, the <code>requirejs</code> folder corresponds to the WebJar artifactId, and the <code>require.js</code> refers to the required asset at the root of the WebJar.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;script data-main="@routes.Assets.at("javascripts/main.js")"
        type="text/javascript"
        src="@routes.Assets.at("lib/requirejs/require.js")"&gt;&lt;/script&gt;</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">libraryDependencies += "org.webjars" % "requirejs" % "2.2.0"</code></pre></div></div></li></ul></div></div></section></section>
<section><section id="_javascript_routers"><h2>JavaScript Routers</h2></section><section id="_javascript_routing"><h2>Javascript Routing</h2><div class="slide-content"><div class="ulist"><ul><li><p>The play router is able to generate Javascript code to handle routing from Javascript running client side back to your application</p></li><li><p>The Javascript router aids in refactoring your application</p></li><li><p>If you change the structure of your URLs or parameter names your Javascript gets automatically updated to use that new structure</p></li></ul></div></div></section><section id="_generating_a_javascript_router"><h2>Generating a Javascript router</h2><div class="slide-content"><div class="ulist"><ul><li><p>The first step to using Play’s Javascript router is to generate it</p></li><li><p>The router will only expose the routes that you explicitly declare thus minimizing the size of the Javascript code</p></li><li><p>There are two ways to generate a Javascript router</p><div class="ulist"><ul><li><p>One is to embed the router in the HTML page using template directives</p></li><li><p>The other is to generate Javascript resources in an action that can be downloaded, cached and shared between pages</p></li></ul></div></li></ul></div></div></section><section id="_embedded_router"><h2>Embedded router</h2><div class="slide-content"><div class="ulist"><ul><li><p>An embedded router can be generated using the <code>@javascriptRouter</code> directive inside a Scala template</p></li><li><p>This is typically done inside the main decorating template</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">@()(implicit req: play.api.mvc.RequestHeader)

@helper.javascriptRouter("jsRoutes")(
    routes.javascript.Users.list,
    routes.javascript.Users.get
)</code></pre></div></div>
<div class="ulist"><ul><li><p>The first parameter is the name of the global variable that the router will be placed in</p></li><li><p>The second parameter is the list of Javascript routes that should be included in this router</p></li><li><p>As you can see above, to use this function, your template must have an implicit <code>RequestHeader</code> in scope</p></li></ul></div></div></section><section id="_router_resource"><h2>Router resource</h2><div class="slide-content"><div class="ulist"><ul><li><p>A router resource can be generated by creating an action that invokes the router generator</p></li><li><p>It has a similar syntax to embedding the router in a template:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">import javax.inject.Inject
import play.api.http.MimeTypes
import play.api.mvc._
import play.api.routing._</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">def javascriptRoutes = Action { implicit request =&gt;
  Ok(
    JavaScriptReverseRouter("jsRoutes")(
      routes.javascript.Users.list,
      routes.javascript.Users.get
    )
  ).as(MimeTypes.JAVASCRIPT)
}</code></pre></div></div></li><li><p>Then, add the corresponding route:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">GET     /javascriptRoutes      controllers.Application.javascriptRoutes</code></pre></div></div></li></ul></div></div></section><section id="_adding_the_javascript_route_to_your_templates"><h2>Adding the JavaScript route to your templates</h2><div class="slide-content"><div class="paragraph"><p>Having implemented this action, and adding it to your routes file, you can then include it as a resource in your templates:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">&lt;script type="text/javascript" src="@routes.Application.javascriptRoutes"&gt;&lt;/script&gt;</code></pre></div></div></div></section><section id="_using_the_router"><h2>Using the router</h2><div class="slide-content"><div class="ulist"><ul><li><p>The router also makes a few other properties available including the <code>url</code> and the <code>type</code> (the HTTP method)</p></li><li><p>Using jQuery as an example, making a call is as simple as:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">$.ajax(jsRoutes.controllers.Users.get(someId))
  .done( /*...*/ )
  .fail( /*...*/ );</code></pre></div></div></li><li><p>Using the router from JavaScript</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">var r = jsRoutes.controllers.Users.get(someId);
$.ajax({url: r.url, type: r.type, success: /*...*/, error: /*...*/ });</code></pre></div></div></li></ul></div></div></section><section id="_if_you_would_like_to_use_a_websocket"><h2>If you would like to use a WebSocket</h2><div class="slide-content"><div class="ulist"><ul><li><p>The previous approach is required where other properties need setting such as <code>success</code>, <code>error</code>, <code>context</code>, etc.</p></li><li><p>The <code>absoluteURL</code> and the <code>webSocketURL</code> are methods (not properties) which return the complete url string</p></li><li><p>A Websocket connection can be made like:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">var r = jsRoutes.controllers.Users.list();
var ws = new WebSocket(r.webSocketURL());
ws.onmessage = function(msg) {
        /*...*/
};</code></pre></div></div></li></ul></div></div></section></section>
<section id="_lab_javascript_front_end"><h2>Lab: JavaScript Front-End</h2></section>
<section><section id="_containerization"><h2>Containerization</h2></section><section id="_build_your_projects_artifact"><h2>Build your project&#8217;s artifact</h2><div class="slide-content"><div class="ulist"><ul><li><p>Build your project’s artifact by running <code>sbt dist</code></p></li><li><p>This will produce <em>target/universal/&lt;application-name&gt;.zip</em></p></li><li><p>Expect a lot more output and longer build time if this is your first run</p></li></ul></div></div></section><section id="_expanding_your_production"><h2>Expanding your production</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">set -x
unzip -d app target/universal/*-1.0-SNAPSHOT.zip
mv app/*/* app/
rm app/bin/*.bat
mv app/bin/* app/bin/start</code></pre></div></div></div></section><section id="_creating_a_dockerfile"><h2>Creating a <em>Dockerfile</em></h2><div class="slide-content"><div class="ulist"><ul><li><p>Create a file called <em>Dockerfile</em> at the root of your project</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-docker hljs" data-noescape="true" data-lang="docker">FROM openjdk:11-jre
COPY app /app
EXPOSE 9000
CMD /app/bin/start</code></pre></div></div></li><li><p>Create the docker image: <code>docker build -t &lt;account-name&gt;/&lt;application-name&gt;:&lt;version&gt; .</code></p></li></ul></div></div></section><section id="_push_the_docker_container"><h2>Push the docker container</h2><div class="slide-content"><div class="ulist"><ul><li><p>Login into your repository</p></li><li><p>For Dockerhub, just run <code>docker login</code> and enter credentials</p></li><li><p>Push the docker image to a repository by running <code>docker push &lt;account-name&gt;/&lt;application-name&gt;:&lt;version&gt;</code></p></li></ul></div></div></section></section>
<section><section id="_the_application_secret"><h2>The Application Secret</h2></section><section id="_the_application_secret_2"><h2>The Application Secret</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play uses a secret key for a number of things, including::</p><div class="ulist"><ul><li><p>Signing session cookies and CSRF tokens</p></li><li><p>Built in encryption utilities</p></li></ul></div></li><li><p>It is configured in <code>application.conf</code>, with the property name <code>play.http.secret.key</code>, and defaults to <code>changeme</code>. As the default suggests, it should be changed for production</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">When started in prod mode, if Play finds that the secret is not set, or if it is set to <code>changeme</code>, Play will throw an error</td></tr></table></div></div></section><section id="Best-practices"><h2>Best practices</h2><div class="slide-content"><div class="ulist"><ul><li><p>Anyone that can get access to the secret will be able to generate any session they please, effectively allowing them to log in to your system as any user they please. Hence it is strongly recommended that you do not check your application secret into source control. Rather, it should be configured on your production server. This means that it is considered bad practice to put the production application secret in <code>application.conf</code>.</p></li><li><p>One way of configuring the application secret on a production server is to pass it as a system property to your start script. For example:</p></li><li><p>This approach is very simple, and we will use this approach in the Play documentation on running your app in production mode as a reminder that the application secret needs to be set. In some environments however, placing secrets in command line arguments is not considered good practice. There are two ways to address this.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ /path/to/yourapp/bin/yourapp -Dplay.http.secret.key='QCY?tAnfk?aZ?iwrNwnxIlR6CTf:G3gf:[email protected]`R5W:1uDFN];[email protected]'</code></pre></div></div></div></section><section id="_environment_variables"><h2>Environment variables</h2><div class="slide-content"><div class="ulist"><ul><li><p>The first is to place the application secret in an environment variable.</p></li><li><p>In this case, we recommend you place the following configuration in your <code>application.conf</code> file:</p></li><li><p>The second line in that configuration sets the secret to come from an environment variable called <code>APPLICATION_SECRET</code> if such an environment variable is set, otherwise, it leaves the secret unchanged from the previous line.</p></li><li><p>This approach works particularly well for cloud based deployment scenarios, where the normal practice is to set passwords and other secrets via environment variables that can be configured through the API for that cloud provider.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-noescape="true" data-lang="text">play.http.secret.key="changeme"
play.http.secret.key=${?APPLICATION_SECRET}</code></pre></div></div></div></section><section id="_production_configuration_file"><h2>Production configuration file</h2><div class="slide-content"><div class="ulist"><ul><li><p>Another approach is to create a <code>production.conf</code> file that lives on the server, and includes <code>application.conf</code></p></li><li><p>This also overrides any sensitive configuration, such as the application secret and passwords</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">include "application"

play.http.secret.key="QCY?tAnfk?aZ?iwrNwnxIlR6CTf:G3gf:[email protected]`R5W:1uDFN];[email protected]"</code></pre></div></div>
<div class="ulist"><ul><li><p>Then you can start Play with:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ /path/to/yourapp/bin/yourapp -Dconfig.file=/path/to/production.conf</code></pre></div></div></div></section><section id="_requirements_for_an_application_secret"><h2>Requirements for an application secret</h2><div class="slide-content"><div class="ulist"><ul><li><p>The application secret configuration <code>play.http.secret.key</code> is checked for a minimum length in production.</p></li><li><p>If the key is fifteen characters or fewer, a warning will be logged.</p></li><li><p>If the key is eight characters or fewer, then an error is thrown and the configuration is invalid.</p></li><li><p>You can resolve this error by setting the secret to at least 32 bytes of completely random input, such as <code>head -c 32 /dev/urandom | base64</code> or by the application secret generator, using <code>playGenerateSecret</code> or <code>playUpdateSecret</code> as explained below.</p></li><li><p>Also, as explained above, the application secret is used as the key for ensuring that a Play session cookie is valid, i.e. has been generated by the server as opposed to spoofed by an attacker. However, the secret only specifies a string, and does not determine the amount of entropy in that string.</p></li><li><p>Anyhow, it is possible to put an upper bound on the amount of entropy in the secret simply by measuring how short it is: if the secret is eight characters long, that is at most 64 bits of entropy, which is insufficient by modern standards.</p></li></ul></div></div></section><section id="_generating_an_application_secret"><h2>Generating an application secret</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play provides a utility that you can use to generate a new secret.</p></li><li><p>Run <code>playGenerateSecret</code> in the Play console.</p></li><li><p>This will generate a new secret that you can use in your application. For example:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">[my-first-app] $ playGenerateSecret
[info] Generated new secret: QCYtAnfkaZiwrNwnxIlR6CTfG3gf90Latabg5241ABR5W1uDFNIkn
[success] Total time: 0 s, completed 28/03/2014 2:26:09 PM</code></pre></div></div></div></section><section id="_updating_the_application_secret_in_application_conf"><h2>Updating the application secret in application.conf</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play also provides a convenient utility for updating the secret in <code>application.conf</code></p></li><li><p>Should you want to have a particular secret configured for development or test servers.</p></li><li><p>This is often useful when you have encrypted data using the application secret, and you want to ensure that the same secret is used every time the application is run in dev mode.</p></li><li><p>To update the secret in <code>application.conf</code>, run <code>playUpdateSecret</code> in the Play console:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">[my-first-app] $ playUpdateSecret
[info] Generated new secret: B4FvQWnTp718vr6AHyvdGlrHBGNcvuM4y3jUeRCgXxIwBZIbt
[info] Updating application secret in /Users/jroper/tmp/my-first-app/conf/application.conf
[info] Replacing old application secret: play.http.secret.key="changeme"
[success] Total time: 0 s, completed 28/03/2014 2:36:54 PM</code></pre></div></div></div></section></section>
<section><section id="_production"><h2>Production</h2></section><section id="_deploying_your_application"><h2>Deploying your application</h2><div class="slide-content"><div class="ulist"><ul><li><p>We have seen how to run a Play application in development mode, however the <code>run</code> command should not be used to run an application in production mode</p></li><li><p>When using <code>run</code>, on each request, Play checks with sbt to see if any files have changed, and this may have significant performance impacts on your application</p></li></ul></div></div></section><section id="_the_application_secret_3"><h2>The application secret</h2><div class="slide-content"><div class="ulist"><ul><li><p>Before you run your application in production mode, you need to generate an application secret</p></li><li><p>In the examples below, you will see the use of <code>-Dplay.http.secret.key=ad31779d4ee49d5ad5162bf1429c32e2e9933f3b</code></p></li><li><p>You must generate your own secret to use when deploying to production</p></li></ul></div></div></section><section id="_using_the_dist_task"><h2>Using the <code>dist</code> task</h2><div class="slide-content"><div class="ulist"><ul><li><p>The <code>dist</code> task builds a binary version of your application that you can deploy to a server without any dependency on sbt, the only thing the server needs is a Java installation</p></li><li><p>In the Play console, simply type <code>dist</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">[my-first-app] $ dist</code></pre></div></div></div></section><section id="_what_does_dist_do"><h2>What does <code>dist</code> do?</h2><div class="slide-content"><div class="ulist"><ul><li><p>This produces a ZIP file containing all JAR files needed to run your application in the <code>target/universal</code> folder of your application.</p></li><li><p>To run the application, unzip the file on the target server, and then run the script in the <code>bin</code> directory.</p></li><li><p>The name of the script is your application name, and it comes in two versions, a bash shell script, and a windows <code>.bat</code> script</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">$ unzip my-first-app-1.0.zip
$ my-first-app-1.0/bin/my-first-app -Dplay.http.secret.key=ad31779d4ee49d5ad5162bf1429c32e2e9933f3b</code></pre></div></div></div></section><section id="_specifying_a_different_configuration"><h2>Specifying a different configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also specify a different configuration file for a production environment, from the command line:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">$ my-first-app-1.0/bin/my-first-app -Dconfig.file=/full/path/to/conf/application-prod.conf</code></pre></div></div></li><li><p>For a full description of usage invoke the start script with a <code>-h</code> option</p></li><li><p>For Unix users, zip files do not retain Unix file permissions so when the file is expanded the start script will be required to be set as an executable:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">$ chmod +x /path/to/bin/&lt;project-name&gt;</code></pre></div></div></li></ul></div></div></section><section id="_create_a_tarball_instead"><h2>Create a tarball instead</h2><div class="slide-content"><div class="ulist"><ul><li><p>Alternatively a tar.gz file can be produced instead</p></li><li><p>Tar files retain permissions</p></li><li><p>Invoke the <code>universal:packageZipTarball</code> task instead of the <code>dist</code> task:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">sbt universal:packageZipTarball</code></pre></div></div></li></ul></div></div></section><section id="_api_documentation_inclusion"><h2>API Documentation Inclusion</h2><div class="slide-content"><div class="ulist"><ul><li><p>By default, the <code>dist</code> task will include the API documentation in the generated package</p></li><li><p>If this is not necessary, add these lines in <code>build.sbt</code>:</p></li><li><p>For builds with sub-projects, the statement below has to be applied to all sub-project definitions</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">sources in (Compile, doc) := Seq.empty

publishArtifact in (Compile, packageDoc) := false</code></pre></div></div></li></ul></div></div></section><section id="_the_native_packager"><h2>The Native Packager</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play uses the <a href="https://sbt-native-packager.readthedocs.io/en/stable/">sbt Native Packager plugin</a></p></li><li><p>The native packager plugin declares the <code>dist</code> task to create a zip file</p></li><li><p>Invoking the <code>dist</code> task is directly equivalent to invoking the following:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">[my-first-app] $ universal:packageBin</code></pre></div></div></li><li><p>Many other types of archive can be generated including:</p><div class="ulist"><ul><li><p>tar.gz</p></li><li><p>OS X disk images</p></li><li><p>Microsoft Installer (MSI)</p></li><li><p>RPMs</p></li><li><p>Debian packages</p></li><li><p>System V / init.d and Upstart services in RPM/Debian packages</p></li></ul></div></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Please consult the <a href="https://sbt-native-packager.readthedocs.io/en/stable/">documentation</a> on the native packager plugin for more information</td></tr></table></div></div></section><section id="_including_additional_files_in_your_distribution"><h2>Including additional files in your distribution</h2><div class="slide-content"><div class="ulist"><ul><li><p>Anything included in your project’s <code>dist</code> directory will be included in the distribution built by the native packager</p></li><li><p>Note that in Play, the <code>dist</code> directory is equivalent to the <code>src/universal</code> directory mentioned in the native packager’s own documentation</p></li></ul></div></div></section><section id="_play_pid_configuration"><h2>Play PID Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Play manages its own PID, which is described in the Production configuration</p></li><li><p>Since Play uses a separate pidfile, we have to provide it with a proper path, which is <code>packageName.value</code> here</p></li><li><p>The name of the pid file must be <code>play.pid</code></p></li><li><p>In order to tell the startup script where to place the PID file, put a file <code>application.ini</code> inside the <code>dist/conf</code> folder and add the following content:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">s"-Dpidfile.path=/var/run/${packageName.value}/play.pid",
# Add all other startup settings here, too</code></pre></div></div>
<div class="paragraph"><p>Please see the sbt-native-packager <a href="https://sbt-native-packager.readthedocs.io/en/stable/recipes/play.html">page on Play</a> for more details</p></div></div></section><section id="_preventing_play_from_running_a_pid"><h2>Preventing play from running a PID</h2><div class="slide-content"><div class="paragraph"><p>To prevent Play from creating a PID just set the property to <code>/dev/null</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-scala hljs" data-noescape="true" data-lang="scala">-Dpidfile.path=/dev/null</code></pre></div></div>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p>For a full list of replacements take a closer look at the <a href="https://sbt-native-packager.readthedocs.io/en/stable/archetypes/java_server/customize.html">customize java server documentation</a> and <a href="https://sbt-native-packager.readthedocs.io/en/stable/archetypes/java_app/customize.html">customize java app documentation</a></p></div></div></div></div></section></section>
<section id="_lab_containerization"><h2>Lab: Containerization</h2></section>
<section id="_lab_open_development"><h2>Lab: Open Development</h2></section></div></div><script src="node_modules/reveal.js/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: true,
  // Push each slide change to the browser history. Implies `hash: true`
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'node_modules/reveal.js/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: 'node_modules/reveal.js/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script><link rel="stylesheet" href="color-brewer.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/shell.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/scala.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/text.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/js.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function( reveal ) {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code' ) ).forEach( function( block ) {

        block.parentNode.className = 'code-wrapper';

        // Code can optionally be wrapped in script template to avoid
        // HTML being parsed by the browser (i.e. when you need to
        // include <, > or & in your code).
        let substitute = block.querySelector( 'script[type="text/template"]' );
        if( substitute ) {
          // textContent handles the HTML entity escapes for us
          block.textContent = substitute.innerHTML;
        }

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightElement( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

      // If we're printing to PDF, scroll the code highlights of
      // all blocks in the deck into view at once
      reveal.on( 'pdf-ready', function() {
        [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code[data-line-numbers].current-fragment' ) ).forEach( function( block ) {
          RevealHighlight.scrollHighlightedLineIntoView( block, {}, true );
        } );
      } );
    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightElement( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        var scrollState = { currentBlock: block };

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );

          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

            // Scroll highlights into view as we step through them
            fragmentBlock.addEventListener( 'visible', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock, scrollState ) );
            fragmentBlock.addEventListener( 'hidden', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock.previousSibling, scrollState ) );

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        // Scroll the first highlight into view when the slide
        // becomes visible. Note supported in IE11 since it lacks
        // support for Element.closest.
        var slide = typeof block.closest === 'function' ? block.closest( 'section:not(.stack)' ) : null;
        if( slide ) {
          var scrollFirstHighlightIntoView = function() {
            RevealHighlight.scrollHighlightedLineIntoView( block, scrollState, true );
            slide.removeEventListener( 'visible', scrollFirstHighlightIntoView );
          }
          slide.addEventListener( 'visible', scrollFirstHighlightIntoView );
        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Animates scrolling to the first highlighted line
     * in the given code block.
     */
    scrollHighlightedLineIntoView: function( block, scrollState, skipAnimation ) {

      cancelAnimationFrame( scrollState.animationFrameID );

      // Match the scroll position of the currently visible
      // code block
      if( scrollState.currentBlock ) {
        block.scrollTop = scrollState.currentBlock.scrollTop;
      }

      // Remember the current code block so that we can match
      // its scroll position when showing/hiding fragments
      scrollState.currentBlock = block;

      var highlightBounds = RevealHighlight.getHighlightedLineBounds( block )
      var viewportHeight = block.offsetHeight;

      // Subtract padding from the viewport height
      var blockStyles = getComputedStyle( block );
      viewportHeight -= parseInt( blockStyles.paddingTop ) + parseInt( blockStyles.paddingBottom );

      // Scroll position which centers all highlights
      var startTop = block.scrollTop;
      var targetTop = highlightBounds.top + ( Math.min( highlightBounds.bottom - highlightBounds.top, viewportHeight ) - viewportHeight ) / 2;

      // Account for offsets in position applied to the
      // <table> that holds our lines of code
      var lineTable = block.querySelector( '.hljs-ln' );
      if( lineTable ) targetTop += lineTable.offsetTop - parseInt( blockStyles.paddingTop );

      // Make sure the scroll target is within bounds
      targetTop = Math.max( Math.min( targetTop, block.scrollHeight - viewportHeight ), 0 );

      if( skipAnimation === true || startTop === targetTop ) {
        block.scrollTop = targetTop;
      }
      else {

        // Don't attempt to scroll if there is no overflow
        if( block.scrollHeight <= viewportHeight ) return;

        var time = 0;
        var animate = function() {
          time = Math.min( time + 0.02, 1 );

          // Update our eased scroll position
          block.scrollTop = startTop + ( targetTop - startTop ) * RevealHighlight.easeInOutQuart( time );

          // Keep animating unless we've reached the end
          if( time < 1 ) {
            scrollState.animationFrameID = requestAnimationFrame( animate );
          }
        };

        animate();

      }

    },

    /**
     * The easing function used when scrolling.
     */
    easeInOutQuart: function( t ) {

      // easeInOutQuart
      return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;

    },

    getHighlightedLineBounds: function( block ) {

      var highlightedLines = block.querySelectorAll( '.highlight-line' );
      if( highlightedLines.length === 0 ) {
        return { top: 0, bottom: 0 };
      }
      else {
        var firstHighlight = highlightedLines[0];
        var lastHighlight = highlightedLines[ highlightedLines.length -1 ];

        return {
          top: firstHighlight.offsetTop,
          bottom: lastHighlight.offsetTop + lastHighlight.offsetHeight
        }
      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.configure({
  ignoreUnescapedHTML: true,
});
hljs.highlightAll();
</script></body></html>